<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThermoCalculator - Thermodynamics Calculator</title>
    <meta name="description" content="Comprehensive thermodynamics calculator for engineering students. All formulas from √áengel Thermodynamics.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #60a5fa 100%); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Temperature Converter
        const TemperatureConverter = () => {
            const [values, setValues] = useState({ celsius: '', kelvin: '', fahrenheit: '', rankine: '' });
            
            const handleChange = (value, from) => {
                const newValues = { ...values, [from]: value };
                const v = parseFloat(value);
                
                if (!isNaN(v) && value !== '' && value !== '-' && !value.endsWith('.')) {
                    let celsius;
                    switch(from) {
                        case 'celsius': celsius = v; break;
                        case 'kelvin': celsius = v - 273.15; break;
                        case 'fahrenheit': celsius = (v - 32) * 5/9; break;
                        case 'rankine': celsius = (v - 491.67) * 5/9; break;
                    }
                    if (from !== 'celsius') newValues.celsius = celsius.toPrecision(6);
                    if (from !== 'kelvin') newValues.kelvin = (celsius + 273.15).toPrecision(6);
                    if (from !== 'fahrenheit') newValues.fahrenheit = (celsius * 9/5 + 32).toPrecision(6);
                    if (from !== 'rankine') newValues.rankine = ((celsius + 273.15) * 9/5).toPrecision(6);
                } else {
                    Object.keys(newValues).forEach(key => { if (key !== from) newValues[key] = ''; });
                }
                setValues(newValues);
            };
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üå°Ô∏è Temperature Converter</h3>
                    <div className="grid grid-cols-2 gap-4">
                        {[
                            { key: 'celsius', label: 'Celsius (¬∞C)' },
                            { key: 'kelvin', label: 'Kelvin (K)' },
                            { key: 'fahrenheit', label: 'Fahrenheit (¬∞F)' },
                            { key: 'rankine', label: 'Rankine (¬∞R)' }
                        ].map(({ key, label }) => (
                            <div key={key}>
                                <label className="block text-sm font-medium text-gray-600 mb-1">{label}</label>
                                <input type="text" inputMode="decimal" value={values[key]}
                                    onChange={(e) => handleChange(e.target.value, key)}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    placeholder="Enter value" />
                            </div>
                        ))}
                    </div>
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Formulas:</strong> K = ¬∞C + 273.15 | ¬∞F = ¬∞C √ó 9/5 + 32 | ¬∞R = K √ó 9/5
                    </div>
                </div>
            );
        };

        // Pressure Converter
        const PressureConverter = () => {
            const [values, setValues] = useState({ pa: '', kpa: '', mpa: '', bar: '', atm: '', psi: '', mmhg: '' });
            const conv = { pa: 1, kpa: 1000, mpa: 1e6, bar: 1e5, atm: 101325, psi: 6894.76, mmhg: 133.322 };
            
            const handleChange = (value, from) => {
                const newValues = { ...values, [from]: value };
                const v = parseFloat(value);
                if (!isNaN(v) && value !== '' && !value.endsWith('.')) {
                    const pa = v * conv[from];
                    Object.keys(conv).forEach(key => { if (key !== from) newValues[key] = (pa / conv[key]).toPrecision(6); });
                } else {
                    Object.keys(newValues).forEach(key => { if (key !== from) newValues[key] = ''; });
                }
                setValues(newValues);
            };
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚ö° Pressure Converter</h3>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                        {[
                            { key: 'pa', label: 'Pascal (Pa)' },
                            { key: 'kpa', label: 'Kilopascal (kPa)' },
                            { key: 'mpa', label: 'Megapascal (MPa)' },
                            { key: 'bar', label: 'Bar' },
                            { key: 'atm', label: 'Atmosphere (atm)' },
                            { key: 'psi', label: 'PSI' },
                            { key: 'mmhg', label: 'mmHg' }
                        ].map(({ key, label }) => (
                            <div key={key}>
                                <label className="block text-sm font-medium text-gray-600 mb-1">{label}</label>
                                <input type="text" inputMode="decimal" value={values[key]}
                                    onChange={(e) => handleChange(e.target.value, key)}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    placeholder="Enter value" />
                            </div>
                        ))}
                    </div>
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Reference:</strong> 1 atm = 101.325 kPa = 1.01325 bar = 14.696 psi
                    </div>
                </div>
            );
        };

        // Energy Converter
        const EnergyConverter = () => {
            const [values, setValues] = useState({ j: '', kj: '', cal: '', kcal: '', btu: '', kwh: '' });
            const conv = { j: 1, kj: 1000, cal: 4.184, kcal: 4184, btu: 1055.06, kwh: 3.6e6 };
            
            const handleChange = (value, from) => {
                const newValues = { ...values, [from]: value };
                const v = parseFloat(value);
                if (!isNaN(v) && value !== '' && !value.endsWith('.')) {
                    const j = v * conv[from];
                    Object.keys(conv).forEach(key => { if (key !== from) newValues[key] = (j / conv[key]).toPrecision(6); });
                } else {
                    Object.keys(newValues).forEach(key => { if (key !== from) newValues[key] = ''; });
                }
                setValues(newValues);
            };
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üî• Energy Converter</h3>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                        {[
                            { key: 'j', label: 'Joule (J)' },
                            { key: 'kj', label: 'Kilojoule (kJ)' },
                            { key: 'cal', label: 'Calorie' },
                            { key: 'kcal', label: 'Kilocalorie' },
                            { key: 'btu', label: 'BTU' },
                            { key: 'kwh', label: 'Kilowatt-hour (kWh)' }
                        ].map(({ key, label }) => (
                            <div key={key}>
                                <label className="block text-sm font-medium text-gray-600 mb-1">{label}</label>
                                <input type="text" inputMode="decimal" value={values[key]}
                                    onChange={(e) => handleChange(e.target.value, key)}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    placeholder="Enter value" />
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // Hydrostatic Pressure
        const HydrostaticPressure = () => {
            const [inputs, setInputs] = useState({ rho: '1000', g: '9.81', h: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const rho = parseFloat(inputs.rho), g = parseFloat(inputs.g), h = parseFloat(inputs.h);
                if (!isNaN(rho) && !isNaN(g) && !isNaN(h) && inputs.h !== '') {
                    const P = rho * g * h;
                    setResult({ pa: P.toPrecision(6), kpa: (P/1000).toPrecision(6), bar: (P/1e5).toPrecision(6) });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üíß Hydrostatic Pressure</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">P = œÅ √ó g √ó h</div>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Density œÅ (kg/m¬≥)</label>
                            <input type="text" inputMode="decimal" value={inputs.rho}
                                onChange={(e) => setInputs({...inputs, rho: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="1000" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Gravity g (m/s¬≤)</label>
                            <input type="text" inputMode="decimal" value={inputs.g}
                                onChange={(e) => setInputs({...inputs, g: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="9.81" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Depth h (m)</label>
                            <input type="text" inputMode="decimal" value={inputs.h}
                                onChange={(e) => setInputs({...inputs, h: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Enter depth" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            <div className="grid grid-cols-3 gap-2 text-sm">
                                <div>Pa: <strong>{result.pa}</strong></div>
                                <div>kPa: <strong>{result.kpa}</strong></div>
                                <div>bar: <strong>{result.bar}</strong></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Ideal Gas
        const IdealGas = () => {
            const [inputs, setInputs] = useState({ P: '', V: '', n: '', T: '', R: '8.314' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const P = parseFloat(inputs.P) * 1000, V = parseFloat(inputs.V);
                const n = parseFloat(inputs.n), T = parseFloat(inputs.T), R = parseFloat(inputs.R);
                let calc = {};
                
                if (inputs.P === '' && inputs.V !== '' && inputs.n !== '' && inputs.T !== '' && V > 0)
                    calc.P = (n * R * T) / V;
                if (inputs.V === '' && inputs.P !== '' && inputs.n !== '' && inputs.T !== '' && P > 0)
                    calc.V = (n * R * T) / P;
                if (inputs.n === '' && inputs.P !== '' && inputs.V !== '' && inputs.T !== '' && T > 0)
                    calc.n = (P * V) / (R * T);
                if (inputs.T === '' && inputs.P !== '' && inputs.V !== '' && inputs.n !== '' && n > 0)
                    calc.T = (P * V) / (n * R);
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üí® Ideal Gas Equation</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">PV = nRT</div>
                    <p className="text-sm text-gray-500 mb-4">Enter 3 values, leave one empty to calculate</p>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Pressure P (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P}
                                onChange={(e) => setInputs({...inputs, P: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Leave empty" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Volume V (m¬≥)</label>
                            <input type="text" inputMode="decimal" value={inputs.V}
                                onChange={(e) => setInputs({...inputs, V: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Leave empty" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Moles n (mol)</label>
                            <input type="text" inputMode="decimal" value={inputs.n}
                                onChange={(e) => setInputs({...inputs, n: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Leave empty" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Temperature T (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T}
                                onChange={(e) => setInputs({...inputs, T: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Leave empty" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">R (J/mol¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.R}
                                onChange={(e) => setInputs({...inputs, R: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="8.314" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.P && <div>P = <strong>{(result.P/1000).toPrecision(6)} kPa</strong></div>}
                            {result.V && <div>V = <strong>{result.V.toPrecision(6)} m¬≥</strong></div>}
                            {result.n && <div>n = <strong>{result.n.toPrecision(6)} mol</strong></div>}
                            {result.T && <div>T = <strong>{result.T.toPrecision(6)} K</strong></div>}
                        </div>
                    )}
                </div>
            );
        };

        // Heat Transfer Q = mcŒîT
        const HeatTransfer = () => {
            const [inputs, setInputs] = useState({ m: '', c: '', dT: '', Q: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const m = parseFloat(inputs.m), c = parseFloat(inputs.c);
                const dT = parseFloat(inputs.dT), Q = parseFloat(inputs.Q) * 1000;
                let calc = {};
                
                if (inputs.Q === '' && inputs.m !== '' && inputs.c !== '' && inputs.dT !== '')
                    calc.Q = m * c * dT;
                if (inputs.m === '' && inputs.Q !== '' && inputs.c !== '' && inputs.dT !== '' && c !== 0 && dT !== 0)
                    calc.m = Q / (c * dT);
                if (inputs.c === '' && inputs.Q !== '' && inputs.m !== '' && inputs.dT !== '' && m !== 0 && dT !== 0)
                    calc.c = Q / (m * dT);
                if (inputs.dT === '' && inputs.Q !== '' && inputs.m !== '' && inputs.c !== '' && m !== 0 && c !== 0)
                    calc.dT = Q / (m * c);
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üî• Heat Transfer (Sensible)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">Q = m √ó c √ó ŒîT</div>
                    <p className="text-sm text-gray-500 mb-4">Enter 3 values, leave one empty to calculate</p>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Mass m (kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.m}
                                onChange={(e) => setInputs({...inputs, m: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Leave empty" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Specific Heat c (J/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.c}
                                onChange={(e) => setInputs({...inputs, c: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Leave empty" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Temp Change ŒîT (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.dT}
                                onChange={(e) => setInputs({...inputs, dT: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Leave empty" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Heat Q (kJ)</label>
                            <input type="text" inputMode="decimal" value={inputs.Q}
                                onChange={(e) => setInputs({...inputs, Q: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Leave empty" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.Q && <div>Q = <strong>{(result.Q/1000).toPrecision(6)} kJ</strong></div>}
                            {result.m && <div>m = <strong>{result.m.toPrecision(6)} kg</strong></div>}
                            {result.c && <div>c = <strong>{result.c.toPrecision(6)} J/kg¬∑K</strong></div>}
                            {result.dT && <div>ŒîT = <strong>{result.dT.toPrecision(6)} K</strong></div>}
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Common values:</strong> Water: 4186 | Air: 1005 | Steel: 500 J/kg¬∑K
                    </div>
                </div>
            );
        };

        // Boundary Work
        const BoundaryWork = () => {
            const [type, setType] = useState('isobaric');
            const [inputs, setInputs] = useState({ P: '', V1: '', V2: '', P1: '', P2: '', n: '1.4' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                let W = null;
                if (type === 'isobaric') {
                    const P = parseFloat(inputs.P) * 1000, V1 = parseFloat(inputs.V1), V2 = parseFloat(inputs.V2);
                    if (!isNaN(P) && !isNaN(V1) && !isNaN(V2) && inputs.P && inputs.V1 && inputs.V2)
                        W = P * (V2 - V1);
                } else if (type === 'isothermal') {
                    const P1 = parseFloat(inputs.P1) * 1000, V1 = parseFloat(inputs.V1), V2 = parseFloat(inputs.V2);
                    if (!isNaN(P1) && !isNaN(V1) && !isNaN(V2) && V1 > 0 && V2 > 0 && inputs.P1 && inputs.V1 && inputs.V2)
                        W = P1 * V1 * Math.log(V2 / V1);
                } else if (type === 'polytropic') {
                    const P1 = parseFloat(inputs.P1)*1000, P2 = parseFloat(inputs.P2)*1000;
                    const V1 = parseFloat(inputs.V1), V2 = parseFloat(inputs.V2), n = parseFloat(inputs.n);
                    if (!isNaN(P1) && !isNaN(P2) && !isNaN(V1) && !isNaN(V2) && !isNaN(n) && n !== 1)
                        W = (P2 * V2 - P1 * V1) / (1 - n);
                }
                setResult(W !== null ? { j: W.toPrecision(6), kj: (W/1000).toPrecision(6) } : null);
            }, [inputs, type]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚öôÔ∏è Boundary Work</h3>
                    <div className="flex gap-2 mb-4 flex-wrap">
                        {['isobaric', 'isothermal', 'polytropic'].map(t => (
                            <button key={t} onClick={() => setType(t)}
                                className={`px-4 py-2 rounded-lg text-sm font-medium ${type === t ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                                {t === 'isobaric' ? 'Isobaric (P=const)' : t === 'isothermal' ? 'Isothermal (T=const)' : 'Polytropic (PV‚Åø=const)'}
                            </button>
                        ))}
                    </div>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        {type === 'isobaric' && 'W = P(V‚ÇÇ - V‚ÇÅ)'}
                        {type === 'isothermal' && 'W = P‚ÇÅV‚ÇÅ ln(V‚ÇÇ/V‚ÇÅ)'}
                        {type === 'polytropic' && 'W = (P‚ÇÇV‚ÇÇ - P‚ÇÅV‚ÇÅ)/(1-n)'}
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        {type === 'isobaric' && (
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">P (kPa)</label>
                                <input type="text" inputMode="decimal" value={inputs.P}
                                    onChange={(e) => setInputs({...inputs, P: e.target.value})}
                                    className="w-full px-4 py-2 border rounded-lg" placeholder="Pressure" />
                            </div>
                        )}
                        {(type === 'isothermal' || type === 'polytropic') && (
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÅ (kPa)</label>
                                <input type="text" inputMode="decimal" value={inputs.P1}
                                    onChange={(e) => setInputs({...inputs, P1: e.target.value})}
                                    className="w-full px-4 py-2 border rounded-lg" placeholder="Initial P" />
                            </div>
                        )}
                        {type === 'polytropic' && (
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÇ (kPa)</label>
                                <input type="text" inputMode="decimal" value={inputs.P2}
                                    onChange={(e) => setInputs({...inputs, P2: e.target.value})}
                                    className="w-full px-4 py-2 border rounded-lg" placeholder="Final P" />
                            </div>
                        )}
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">V‚ÇÅ (m¬≥)</label>
                            <input type="text" inputMode="decimal" value={inputs.V1}
                                onChange={(e) => setInputs({...inputs, V1: e.target.value})}
                                className="w-full px-4 py-2 border rounded-lg" placeholder="Initial V" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">V‚ÇÇ (m¬≥)</label>
                            <input type="text" inputMode="decimal" value={inputs.V2}
                                onChange={(e) => setInputs({...inputs, V2: e.target.value})}
                                className="w-full px-4 py-2 border rounded-lg" placeholder="Final V" />
                        </div>
                        {type === 'polytropic' && (
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">n (index)</label>
                                <input type="text" inputMode="decimal" value={inputs.n}
                                    onChange={(e) => setInputs({...inputs, n: e.target.value})}
                                    className="w-full px-4 py-2 border rounded-lg" placeholder="1.4" />
                            </div>
                        )}
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Boundary Work:</div>
                            <div>W = <strong>{result.kj} kJ</strong> ({result.j} J)</div>
                            <div className="text-xs text-gray-500 mt-1">
                                {parseFloat(result.j) > 0 ? 'System does work (expansion)' : 'Work done on system (compression)'}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ==================== CHAPTER 3: PURE SUBSTANCES ====================

        // Quality Calculator
        const QualityCalculator = () => {
            const [inputs, setInputs] = useState({ v: '', vf: '', vg: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const v = parseFloat(inputs.v), vf = parseFloat(inputs.vf), vg = parseFloat(inputs.vg);
                if (!isNaN(v) && !isNaN(vf) && !isNaN(vg) && inputs.v && inputs.vf && inputs.vg) {
                    const vfg = vg - vf;
                    if (vfg > 0) {
                        const x = (v - vf) / vfg;
                        let phase = '';
                        if (x < 0) phase = 'Compressed Liquid';
                        else if (x === 0) phase = 'Saturated Liquid';
                        else if (x > 0 && x < 1) phase = 'Saturated Mixture';
                        else if (x === 1) phase = 'Saturated Vapor';
                        else phase = 'Superheated Vapor';
                        
                        setResult({ x: x.toPrecision(6), vfg: vfg.toPrecision(6), phase, valid: x >= 0 && x <= 1 });
                    }
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üíß Quality (Dryness Fraction) Calculator</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">x = (v - v<sub>f</sub>) / v<sub>fg</sub></div>
                    <p className="text-sm text-gray-500 mb-4">Enter specific volume and saturation values from steam tables</p>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">v (m¬≥/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.v}
                                onChange={(e) => setInputs({...inputs, v: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Actual specific vol" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">v<sub>f</sub> (m¬≥/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.vf}
                                onChange={(e) => setInputs({...inputs, vf: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Sat. liquid" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">v<sub>g</sub> (m¬≥/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.vg}
                                onChange={(e) => setInputs({...inputs, vg: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Sat. vapor" />
                        </div>
                    </div>
                    {result && (
                        <div className={`p-4 rounded-lg border ${result.valid ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'}`}>
                            <div className="text-sm font-medium mb-2">{result.valid ? '‚úì' : '‚ö†Ô∏è'} Result:</div>
                            <div className="grid grid-cols-2 gap-2 text-sm">
                                <div>Quality x = <strong>{result.x}</strong></div>
                                <div>v<sub>fg</sub> = <strong>{result.vfg}</strong> m¬≥/kg</div>
                            </div>
                            <div className={`mt-2 text-sm font-medium ${result.valid ? 'text-green-700' : 'text-yellow-700'}`}>
                                Phase: {result.phase}
                            </div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Note:</strong> 0 ‚â§ x ‚â§ 1 for two-phase region. x &lt; 0 means compressed liquid, x &gt; 1 means superheated vapor.
                    </div>
                </div>
            );
        };

        // Mixture Property Calculator
        const MixtureProperty = () => {
            const [prop, setProp] = useState('v');
            const [inputs, setInputs] = useState({ x: '', pf: '', pfg: '', pg: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const x = parseFloat(inputs.x), pf = parseFloat(inputs.pf);
                const pfg = parseFloat(inputs.pfg), pg = parseFloat(inputs.pg);
                
                let calc = null;
                if (!isNaN(x) && x >= 0 && x <= 1) {
                    if (!isNaN(pf) && !isNaN(pfg) && inputs.pf && inputs.pfg) {
                        calc = pf + x * pfg;
                    } else if (!isNaN(pf) && !isNaN(pg) && inputs.pf && inputs.pg) {
                        const calcPfg = pg - pf;
                        calc = pf + x * calcPfg;
                    }
                }
                setResult(calc !== null ? calc.toPrecision(6) : null);
            }, [inputs, prop]);
            
            const labels = { v: 'Specific Volume (m¬≥/kg)', h: 'Enthalpy (kJ/kg)', s: 'Entropy (kJ/kg¬∑K)', u: 'Internal Energy (kJ/kg)' };
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üî¨ Mixture Property Calculator</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        y = y<sub>f</sub> + x ¬∑ y<sub>fg</sub>
                    </div>
                    <div className="flex gap-2 mb-4 flex-wrap">
                        {Object.keys(labels).map(p => (
                            <button key={p} onClick={() => setProp(p)}
                                className={`px-4 py-2 rounded-lg text-sm font-medium ${prop === p ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                                {p} ({labels[p].split(' ')[0]})
                            </button>
                        ))}
                    </div>
                    <p className="text-sm text-gray-500 mb-4">Enter quality and saturation values (either {prop}<sub>fg</sub> or {prop}<sub>g</sub>)</p>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Quality x</label>
                            <input type="text" inputMode="decimal" value={inputs.x}
                                onChange={(e) => setInputs({...inputs, x: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0 to 1" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">{prop}<sub>f</sub></label>
                            <input type="text" inputMode="decimal" value={inputs.pf}
                                onChange={(e) => setInputs({...inputs, pf: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Sat. liquid" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">{prop}<sub>fg</sub></label>
                            <input type="text" inputMode="decimal" value={inputs.pfg}
                                onChange={(e) => setInputs({...inputs, pfg: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Difference" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">{prop}<sub>g</sub> (optional)</label>
                            <input type="text" inputMode="decimal" value={inputs.pg}
                                onChange={(e) => setInputs({...inputs, pg: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Sat. vapor" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            <div>{prop} = <strong>{result}</strong> {labels[prop].match(/\(([^)]+)\)/)[1]}</div>
                        </div>
                    )}
                </div>
            );
        };

        // Linear Interpolation
        const Interpolation = () => {
            const [inputs, setInputs] = useState({ x1: '', y1: '', x2: '', y2: '', x: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const x1 = parseFloat(inputs.x1), y1 = parseFloat(inputs.y1);
                const x2 = parseFloat(inputs.x2), y2 = parseFloat(inputs.y2);
                const x = parseFloat(inputs.x);
                
                if (!isNaN(x1) && !isNaN(y1) && !isNaN(x2) && !isNaN(y2) && !isNaN(x) && 
                    inputs.x1 && inputs.y1 && inputs.x2 && inputs.y2 && inputs.x && x2 !== x1) {
                    const y = y1 + (y2 - y1) * (x - x1) / (x2 - x1);
                    setResult(y.toPrecision(6));
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìà Linear Interpolation</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        y = y‚ÇÅ + (y‚ÇÇ - y‚ÇÅ) √ó (x - x‚ÇÅ) / (x‚ÇÇ - x‚ÇÅ)
                    </div>
                    <p className="text-sm text-gray-500 mb-4">Interpolate between two table values</p>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div className="col-span-2 grid grid-cols-2 gap-4 p-3 bg-gray-50 rounded-lg">
                            <div className="text-sm font-medium text-gray-600 col-span-2">Point 1 (lower bound)</div>
                            <div>
                                <label className="block text-xs text-gray-500 mb-1">x‚ÇÅ</label>
                                <input type="text" inputMode="decimal" value={inputs.x1}
                                    onChange={(e) => setInputs({...inputs, x1: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="e.g., 100" />
                            </div>
                            <div>
                                <label className="block text-xs text-gray-500 mb-1">y‚ÇÅ</label>
                                <input type="text" inputMode="decimal" value={inputs.y1}
                                    onChange={(e) => setInputs({...inputs, y1: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="e.g., 2675" />
                            </div>
                        </div>
                        <div className="col-span-2 grid grid-cols-2 gap-4 p-3 bg-gray-50 rounded-lg">
                            <div className="text-sm font-medium text-gray-600 col-span-2">Point 2 (upper bound)</div>
                            <div>
                                <label className="block text-xs text-gray-500 mb-1">x‚ÇÇ</label>
                                <input type="text" inputMode="decimal" value={inputs.x2}
                                    onChange={(e) => setInputs({...inputs, x2: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="e.g., 150" />
                            </div>
                            <div>
                                <label className="block text-xs text-gray-500 mb-1">y‚ÇÇ</label>
                                <input type="text" inputMode="decimal" value={inputs.y2}
                                    onChange={(e) => setInputs({...inputs, y2: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="e.g., 2745" />
                            </div>
                        </div>
                        <div className="col-span-2 p-3 bg-blue-50 rounded-lg">
                            <label className="block text-sm font-medium text-blue-800 mb-1">Target x value</label>
                            <input type="text" inputMode="decimal" value={inputs.x}
                                onChange={(e) => setInputs({...inputs, x: e.target.value})}
                                className="w-full px-4 py-2 border border-blue-300 rounded-lg bg-white" placeholder="e.g., 120" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Interpolated Result:</div>
                            <div className="text-lg">y = <strong>{result}</strong></div>
                        </div>
                    )}
                </div>
            );
        };

        // Specific Internal Energy
        const InternalEnergy = () => {
            const [inputs, setInputs] = useState({ h: '', P: '', v: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const h = parseFloat(inputs.h), P = parseFloat(inputs.P), v = parseFloat(inputs.v);
                if (!isNaN(h) && !isNaN(P) && !isNaN(v) && inputs.h && inputs.P && inputs.v) {
                    const u = h - P * v;
                    setResult(u.toPrecision(6));
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚ö° Specific Internal Energy</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">u = h - Pv</div>
                    <p className="text-sm text-gray-500 mb-4">Calculate internal energy from enthalpy</p>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h}
                                onChange={(e) => setInputs({...inputs, h: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Enthalpy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P}
                                onChange={(e) => setInputs({...inputs, P: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Pressure" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">v (m¬≥/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.v}
                                onChange={(e) => setInputs({...inputs, v: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Specific vol" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            <div>u = <strong>{result}</strong> kJ/kg</div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Note:</strong> Ensure consistent units. P in kPa, v in m¬≥/kg gives Pv in kJ/kg.
                    </div>
                </div>
            );
        };

        // Phase Determination
        const PhaseDetermination = () => {
            const [method, setMethod] = useState('Tv');
            const [inputs, setInputs] = useState({ T: '', Tsat: '', P: '', Psat: '', v: '', vf: '', vg: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                let phase = null;
                
                if (method === 'Tv') {
                    const T = parseFloat(inputs.T), Tsat = parseFloat(inputs.Tsat);
                    if (!isNaN(T) && !isNaN(Tsat) && inputs.T && inputs.Tsat) {
                        if (T < Tsat) phase = { name: 'Compressed Liquid', color: 'blue' };
                        else if (T === Tsat) phase = { name: 'Saturated (check v or quality)', color: 'yellow' };
                        else phase = { name: 'Superheated Vapor', color: 'red' };
                    }
                } else if (method === 'Pv') {
                    const P = parseFloat(inputs.P), Psat = parseFloat(inputs.Psat);
                    if (!isNaN(P) && !isNaN(Psat) && inputs.P && inputs.Psat) {
                        if (P > Psat) phase = { name: 'Compressed Liquid', color: 'blue' };
                        else if (P === Psat) phase = { name: 'Saturated (check v or quality)', color: 'yellow' };
                        else phase = { name: 'Superheated Vapor', color: 'red' };
                    }
                } else if (method === 'vCheck') {
                    const v = parseFloat(inputs.v), vf = parseFloat(inputs.vf), vg = parseFloat(inputs.vg);
                    if (!isNaN(v) && !isNaN(vf) && !isNaN(vg) && inputs.v && inputs.vf && inputs.vg) {
                        if (v < vf) phase = { name: 'Compressed Liquid', color: 'blue' };
                        else if (v === vf) phase = { name: 'Saturated Liquid', color: 'cyan' };
                        else if (v > vf && v < vg) phase = { name: 'Saturated Mixture (Two-Phase)', color: 'yellow' };
                        else if (v === vg) phase = { name: 'Saturated Vapor', color: 'orange' };
                        else phase = { name: 'Superheated Vapor', color: 'red' };
                    }
                }
                setResult(phase);
            }, [inputs, method]);
            
            const colors = { blue: 'bg-blue-50 border-blue-200 text-blue-800', yellow: 'bg-yellow-50 border-yellow-200 text-yellow-800',
                red: 'bg-red-50 border-red-200 text-red-800', cyan: 'bg-cyan-50 border-cyan-200 text-cyan-800',
                orange: 'bg-orange-50 border-orange-200 text-orange-800' };
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üîç Phase Determination</h3>
                    <div className="flex gap-2 mb-4 flex-wrap">
                        {[{ k: 'Tv', l: 'Compare T with Tsat' }, { k: 'Pv', l: 'Compare P with Psat' }, { k: 'vCheck', l: 'Check v range' }].map(m => (
                            <button key={m.k} onClick={() => setMethod(m.k)}
                                className={`px-4 py-2 rounded-lg text-sm font-medium ${method === m.k ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                                {m.l}
                            </button>
                        ))}
                    </div>
                    
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        {method === 'Tv' && <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">T (¬∞C or K)</label>
                                <input type="text" inputMode="decimal" value={inputs.T}
                                    onChange={(e) => setInputs({...inputs, T: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Actual temp" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">T<sub>sat</sub> (at given P)</label>
                                <input type="text" inputMode="decimal" value={inputs.Tsat}
                                    onChange={(e) => setInputs({...inputs, Tsat: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Sat. temp" />
                            </div>
                        </>}
                        {method === 'Pv' && <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">P (kPa)</label>
                                <input type="text" inputMode="decimal" value={inputs.P}
                                    onChange={(e) => setInputs({...inputs, P: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Actual pressure" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">P<sub>sat</sub> (at given T)</label>
                                <input type="text" inputMode="decimal" value={inputs.Psat}
                                    onChange={(e) => setInputs({...inputs, Psat: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Sat. pressure" />
                            </div>
                        </>}
                        {method === 'vCheck' && <>
                            <div className="col-span-2">
                                <label className="block text-sm font-medium text-gray-600 mb-1">v (m¬≥/kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.v}
                                    onChange={(e) => setInputs({...inputs, v: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Actual specific volume" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">v<sub>f</sub> (m¬≥/kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.vf}
                                    onChange={(e) => setInputs({...inputs, vf: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Sat. liquid" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">v<sub>g</sub> (m¬≥/kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.vg}
                                    onChange={(e) => setInputs({...inputs, vg: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Sat. vapor" />
                            </div>
                        </>}
                    </div>
                    
                    {result && (
                        <div className={`p-4 rounded-lg border ${colors[result.color]}`}>
                            <div className="text-sm font-medium mb-1">Phase:</div>
                            <div className="text-lg font-bold">{result.name}</div>
                        </div>
                    )}
                </div>
            );
        };

        // ==================== CHAPTER 4: CLOSED SYSTEMS ====================

        // First Law Closed System
        const FirstLawClosed = () => {
            const [inputs, setInputs] = useState({ Q: '', W: '', m: '', u1: '', u2: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const Q = parseFloat(inputs.Q), W = parseFloat(inputs.W), m = parseFloat(inputs.m);
                const u1 = parseFloat(inputs.u1), u2 = parseFloat(inputs.u2);
                let calc = {};
                
                // Q - W = m(u2 - u1)
                if (inputs.Q === '' && !isNaN(W) && !isNaN(m) && !isNaN(u1) && !isNaN(u2)) {
                    calc.Q = W + m * (u2 - u1);
                }
                if (inputs.W === '' && !isNaN(Q) && !isNaN(m) && !isNaN(u1) && !isNaN(u2)) {
                    calc.W = Q - m * (u2 - u1);
                }
                if (inputs.u2 === '' && !isNaN(Q) && !isNaN(W) && !isNaN(m) && !isNaN(u1) && m !== 0) {
                    calc.u2 = u1 + (Q - W) / m;
                }
                if (inputs.u1 === '' && !isNaN(Q) && !isNaN(W) && !isNaN(m) && !isNaN(u2) && m !== 0) {
                    calc.u1 = u2 - (Q - W) / m;
                }
                if (inputs.m === '' && !isNaN(Q) && !isNaN(W) && !isNaN(u1) && !isNaN(u2) && u2 !== u1) {
                    calc.m = (Q - W) / (u2 - u1);
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚öñÔ∏è First Law - Closed System</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        Q - W = m(u‚ÇÇ - u‚ÇÅ) = ŒîU
                    </div>
                    <p className="text-sm text-gray-500 mb-4">Leave one field empty to calculate it</p>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Q (kJ)</label>
                            <input type="text" inputMode="decimal" value={inputs.Q}
                                onChange={(e) => setInputs({...inputs, Q: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Heat transfer" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">W (kJ)</label>
                            <input type="text" inputMode="decimal" value={inputs.W}
                                onChange={(e) => setInputs({...inputs, W: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Work done" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">m (kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.m}
                                onChange={(e) => setInputs({...inputs, m: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mass" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">u‚ÇÅ (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.u1}
                                onChange={(e) => setInputs({...inputs, u1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Initial int. energy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">u‚ÇÇ (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.u2}
                                onChange={(e) => setInputs({...inputs, u2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Final int. energy" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.Q !== undefined && <div>Q = <strong>{result.Q.toPrecision(6)}</strong> kJ</div>}
                            {result.W !== undefined && <div>W = <strong>{result.W.toPrecision(6)}</strong> kJ</div>}
                            {result.m !== undefined && <div>m = <strong>{result.m.toPrecision(6)}</strong> kg</div>}
                            {result.u1 !== undefined && <div>u‚ÇÅ = <strong>{result.u1.toPrecision(6)}</strong> kJ/kg</div>}
                            {result.u2 !== undefined && <div>u‚ÇÇ = <strong>{result.u2.toPrecision(6)}</strong> kJ/kg</div>}
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Sign convention:</strong> Q &gt; 0 = heat added to system, W &gt; 0 = work done by system
                    </div>
                </div>
            );
        };

        // Specific Heat Energy Change
        const SpecificHeatEnergy = () => {
            const [type, setType] = useState('u');
            const [inputs, setInputs] = useState({ m: '', c: '', T1: '', T2: '', E: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const m = parseFloat(inputs.m), c = parseFloat(inputs.c);
                const T1 = parseFloat(inputs.T1), T2 = parseFloat(inputs.T2);
                const E = parseFloat(inputs.E);
                let calc = {};
                
                const dT = T2 - T1;
                
                if (inputs.E === '' && !isNaN(m) && !isNaN(c) && !isNaN(T1) && !isNaN(T2)) {
                    calc.E = m * c * dT;
                }
                if (inputs.T2 === '' && !isNaN(m) && !isNaN(c) && !isNaN(T1) && !isNaN(E) && m !== 0 && c !== 0) {
                    calc.T2 = T1 + E / (m * c);
                }
                if (inputs.T1 === '' && !isNaN(m) && !isNaN(c) && !isNaN(T2) && !isNaN(E) && m !== 0 && c !== 0) {
                    calc.T1 = T2 - E / (m * c);
                }
                if (inputs.m === '' && !isNaN(c) && !isNaN(T1) && !isNaN(T2) && !isNaN(E) && c !== 0 && dT !== 0) {
                    calc.m = E / (c * dT);
                }
                if (inputs.c === '' && !isNaN(m) && !isNaN(T1) && !isNaN(T2) && !isNaN(E) && m !== 0 && dT !== 0) {
                    calc.c = E / (m * dT);
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs, type]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üå°Ô∏è Energy Change with Specific Heat</h3>
                    <div className="flex gap-2 mb-4">
                        <button onClick={() => setType('u')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${type === 'u' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            ŒîU = mc·µ•ŒîT
                        </button>
                        <button onClick={() => setType('h')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${type === 'h' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            ŒîH = mc‚ÇöŒîT
                        </button>
                    </div>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        {type === 'u' ? 'ŒîU = m √ó c·µ• √ó (T‚ÇÇ - T‚ÇÅ)' : 'ŒîH = m √ó c‚Çö √ó (T‚ÇÇ - T‚ÇÅ)'}
                    </div>
                    <p className="text-sm text-gray-500 mb-4">Leave one field empty to calculate it</p>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">m (kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.m}
                                onChange={(e) => setInputs({...inputs, m: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mass" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">{type === 'u' ? 'c·µ•' : 'c‚Çö'} (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.c}
                                onChange={(e) => setInputs({...inputs, c: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Specific heat" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÅ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T1}
                                onChange={(e) => setInputs({...inputs, T1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Initial temp" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÇ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T2}
                                onChange={(e) => setInputs({...inputs, T2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Final temp" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">{type === 'u' ? 'ŒîU' : 'ŒîH'} (kJ)</label>
                            <input type="text" inputMode="decimal" value={inputs.E}
                                onChange={(e) => setInputs({...inputs, E: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Energy change" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.E !== undefined && <div>{type === 'u' ? 'ŒîU' : 'ŒîH'} = <strong>{result.E.toPrecision(6)}</strong> kJ</div>}
                            {result.T1 !== undefined && <div>T‚ÇÅ = <strong>{result.T1.toPrecision(6)}</strong> K</div>}
                            {result.T2 !== undefined && <div>T‚ÇÇ = <strong>{result.T2.toPrecision(6)}</strong> K</div>}
                            {result.m !== undefined && <div>m = <strong>{result.m.toPrecision(6)}</strong> kg</div>}
                            {result.c !== undefined && <div>{type === 'u' ? 'c·µ•' : 'c‚Çö'} = <strong>{result.c.toPrecision(6)}</strong> kJ/kg¬∑K</div>}
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Ideal gas:</strong> Air c·µ• ‚âà 0.718 kJ/kg¬∑K, c‚Çö ‚âà 1.005 kJ/kg¬∑K (at 300K)
                    </div>
                </div>
            );
        };

        // Isentropic Process
        const IsentropicProcess = () => {
            const [find, setFind] = useState('T2');
            const [inputs, setInputs] = useState({ T1: '', T2: '', P1: '', P2: '', v1: '', v2: '', k: '1.4' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const T1 = parseFloat(inputs.T1), T2 = parseFloat(inputs.T2);
                const P1 = parseFloat(inputs.P1), P2 = parseFloat(inputs.P2);
                const v1 = parseFloat(inputs.v1), v2 = parseFloat(inputs.v2);
                const k = parseFloat(inputs.k);
                let calc = null;
                
                if (find === 'T2' && !isNaN(T1) && !isNaN(P1) && !isNaN(P2) && !isNaN(k)) {
                    // T2/T1 = (P2/P1)^((k-1)/k)
                    calc = { T2: T1 * Math.pow(P2/P1, (k-1)/k) };
                } else if (find === 'T2v' && !isNaN(T1) && !isNaN(v1) && !isNaN(v2) && !isNaN(k)) {
                    // T2/T1 = (v1/v2)^(k-1)
                    calc = { T2: T1 * Math.pow(v1/v2, k-1) };
                } else if (find === 'P2' && !isNaN(T1) && !isNaN(T2) && !isNaN(P1) && !isNaN(k)) {
                    // P2/P1 = (T2/T1)^(k/(k-1))
                    calc = { P2: P1 * Math.pow(T2/T1, k/(k-1)) };
                } else if (find === 'v2' && !isNaN(T1) && !isNaN(T2) && !isNaN(v1) && !isNaN(k)) {
                    // v2/v1 = (T1/T2)^(1/(k-1))
                    calc = { v2: v1 * Math.pow(T1/T2, 1/(k-1)) };
                }
                
                setResult(calc);
            }, [inputs, find]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üîÑ Isentropic Process (Ideal Gas)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        Pv<sup>k</sup> = const | Tv<sup>k-1</sup> = const | TP<sup>-(k-1)/k</sup> = const
                    </div>
                    <div className="mb-4">
                        <label className="block text-sm font-medium text-gray-600 mb-2">Find:</label>
                        <div className="flex gap-2 flex-wrap">
                            {[
                                { k: 'T2', l: 'T‚ÇÇ from P ratio' },
                                { k: 'T2v', l: 'T‚ÇÇ from v ratio' },
                                { k: 'P2', l: 'P‚ÇÇ from T ratio' },
                                { k: 'v2', l: 'v‚ÇÇ from T ratio' }
                            ].map(f => (
                                <button key={f.k} onClick={() => setFind(f.k)}
                                    className={`px-3 py-2 rounded-lg text-sm font-medium ${find === f.k ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                                    {f.l}
                                </button>
                            ))}
                        </div>
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">k (Œ≥)</label>
                            <input type="text" inputMode="decimal" value={inputs.k}
                                onChange={(e) => setInputs({...inputs, k: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="1.4" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÅ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T1}
                                onChange={(e) => setInputs({...inputs, T1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Initial T" />
                        </div>
                        {(find === 'T2' || find === 'T2v') ? null : (
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÇ (K)</label>
                                <input type="text" inputMode="decimal" value={inputs.T2}
                                    onChange={(e) => setInputs({...inputs, T2: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Final T" />
                            </div>
                        )}
                        {(find === 'T2' || find === 'P2') && (
                            <>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÅ (kPa)</label>
                                    <input type="text" inputMode="decimal" value={inputs.P1}
                                        onChange={(e) => setInputs({...inputs, P1: e.target.value})}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Initial P" />
                                </div>
                                {find === 'T2' && (
                                    <div>
                                        <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÇ (kPa)</label>
                                        <input type="text" inputMode="decimal" value={inputs.P2}
                                            onChange={(e) => setInputs({...inputs, P2: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Final P" />
                                    </div>
                                )}
                            </>
                        )}
                        {(find === 'T2v' || find === 'v2') && (
                            <>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">v‚ÇÅ (m¬≥/kg)</label>
                                    <input type="text" inputMode="decimal" value={inputs.v1}
                                        onChange={(e) => setInputs({...inputs, v1: e.target.value})}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Initial v" />
                                </div>
                                {find === 'T2v' && (
                                    <div>
                                        <label className="block text-sm font-medium text-gray-600 mb-1">v‚ÇÇ (m¬≥/kg)</label>
                                        <input type="text" inputMode="decimal" value={inputs.v2}
                                            onChange={(e) => setInputs({...inputs, v2: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Final v" />
                                    </div>
                                )}
                            </>
                        )}
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.T2 && <div>T‚ÇÇ = <strong>{result.T2.toPrecision(6)}</strong> K</div>}
                            {result.P2 && <div>P‚ÇÇ = <strong>{result.P2.toPrecision(6)}</strong> kPa</div>}
                            {result.v2 && <div>v‚ÇÇ = <strong>{result.v2.toPrecision(6)}</strong> m¬≥/kg</div>}
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>k values:</strong> Air = 1.4 | CO‚ÇÇ = 1.289 | Steam ‚âà 1.3 | Monatomic = 1.667
                    </div>
                </div>
            );
        };

        // Polytropic Work for Closed System
        const PolytropicWorkClosed = () => {
            const [inputs, setInputs] = useState({ P1: '', V1: '', P2: '', V2: '', n: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const P1 = parseFloat(inputs.P1) * 1000, P2 = parseFloat(inputs.P2) * 1000;
                const V1 = parseFloat(inputs.V1), V2 = parseFloat(inputs.V2);
                const n = parseFloat(inputs.n);
                
                if (!isNaN(P1) && !isNaN(P2) && !isNaN(V1) && !isNaN(V2) && !isNaN(n) && 
                    inputs.P1 && inputs.P2 && inputs.V1 && inputs.V2 && inputs.n) {
                    let W, processName;
                    
                    if (n === 1) {
                        // Isothermal: W = P1*V1*ln(V2/V1)
                        W = P1 * V1 * Math.log(V2 / V1);
                        processName = 'Isothermal (n=1)';
                    } else {
                        // Polytropic: W = (P2*V2 - P1*V1)/(1-n)
                        W = (P2 * V2 - P1 * V1) / (1 - n);
                        if (n === 0) processName = 'Isobaric (n=0)';
                        else if (n === 1.4) processName = 'Isentropic (n‚âàk for air)';
                        else if (n === Infinity) processName = 'Isochoric (n=‚àû)';
                        else processName = `Polytropic (n=${n})`;
                    }
                    
                    setResult({ W: W/1000, processName });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìä Polytropic Process Work</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        W = (P‚ÇÇV‚ÇÇ - P‚ÇÅV‚ÇÅ)/(1-n) &nbsp;|&nbsp; n=1: W = P‚ÇÅV‚ÇÅ ln(V‚ÇÇ/V‚ÇÅ)
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÅ (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P1}
                                onChange={(e) => setInputs({...inputs, P1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Initial P" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">V‚ÇÅ (m¬≥)</label>
                            <input type="text" inputMode="decimal" value={inputs.V1}
                                onChange={(e) => setInputs({...inputs, V1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Initial V" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÇ (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P2}
                                onChange={(e) => setInputs({...inputs, P2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Final P" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">V‚ÇÇ (m¬≥)</label>
                            <input type="text" inputMode="decimal" value={inputs.V2}
                                onChange={(e) => setInputs({...inputs, V2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Final V" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">n (index)</label>
                            <input type="text" inputMode="decimal" value={inputs.n}
                                onChange={(e) => setInputs({...inputs, n: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Polytropic n" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">{result.processName}</div>
                            <div>W = <strong>{result.W.toPrecision(6)}</strong> kJ</div>
                            <div className="text-xs text-gray-500 mt-1">
                                {result.W > 0 ? 'Work done by system (expansion)' : 'Work done on system (compression)'}
                            </div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Special cases:</strong> n=0 (isobaric) | n=1 (isothermal) | n=k (isentropic) | n=‚àû (isochoric, W=0)
                    </div>
                </div>
            );
        };

        // ==================== CHAPTER 5: OPEN SYSTEMS ====================

        // Steady Flow Energy Equation
        const SteadyFlowEnergy = () => {
            const [inputs, setInputs] = useState({ mdot: '', h1: '', h2: '', V1: '0', V2: '0', z1: '0', z2: '0', Qdot: '0', Wdot: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const mdot = parseFloat(inputs.mdot), h1 = parseFloat(inputs.h1), h2 = parseFloat(inputs.h2);
                const V1 = parseFloat(inputs.V1), V2 = parseFloat(inputs.V2);
                const z1 = parseFloat(inputs.z1), z2 = parseFloat(inputs.z2);
                const Qdot = parseFloat(inputs.Qdot), Wdot = parseFloat(inputs.Wdot);
                const g = 9.81;
                
                // QÃá - ·∫Ü = ·πÅ[(h2-h1) + (V2¬≤-V1¬≤)/2000 + g(z2-z1)/1000]
                let calc = {};
                const ke = (V2*V2 - V1*V1) / 2000; // kJ/kg
                const pe = g * (z2 - z1) / 1000; // kJ/kg
                
                if (inputs.Wdot === '' && !isNaN(mdot) && !isNaN(h1) && !isNaN(h2) && !isNaN(Qdot)) {
                    calc.Wdot = Qdot - mdot * ((h2 - h1) + ke + pe);
                }
                if (inputs.Qdot === '' && !isNaN(mdot) && !isNaN(h1) && !isNaN(h2) && !isNaN(Wdot)) {
                    calc.Qdot = Wdot + mdot * ((h2 - h1) + ke + pe);
                }
                if (inputs.h2 === '' && !isNaN(mdot) && !isNaN(h1) && !isNaN(Qdot) && !isNaN(Wdot) && mdot !== 0) {
                    calc.h2 = h1 + (Qdot - Wdot) / mdot - ke - pe;
                }
                if (inputs.mdot === '' && !isNaN(h1) && !isNaN(h2) && !isNaN(Qdot) && !isNaN(Wdot)) {
                    const denom = (h2 - h1) + ke + pe;
                    if (denom !== 0) calc.mdot = (Qdot - Wdot) / denom;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üîÑ Steady-Flow Energy Equation</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        QÃá - ·∫Ü = ·πÅ[(h‚ÇÇ-h‚ÇÅ) + (V‚ÇÇ¬≤-V‚ÇÅ¬≤)/2 + g(z‚ÇÇ-z‚ÇÅ)]
                    </div>
                    <p className="text-sm text-gray-500 mb-4">Leave one field empty to calculate. Set QÃá=0 for adiabatic, velocities=0 if negligible.</p>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">·πÅ (kg/s)</label>
                            <input type="text" inputMode="decimal" value={inputs.mdot}
                                onChange={(e) => setInputs({...inputs, mdot: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mass flow rate" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÅ (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h1}
                                onChange={(e) => setInputs({...inputs, h1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Inlet enthalpy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÇ (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h2}
                                onChange={(e) => setInputs({...inputs, h2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Outlet enthalpy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">V‚ÇÅ (m/s)</label>
                            <input type="text" inputMode="decimal" value={inputs.V1}
                                onChange={(e) => setInputs({...inputs, V1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">V‚ÇÇ (m/s)</label>
                            <input type="text" inputMode="decimal" value={inputs.V2}
                                onChange={(e) => setInputs({...inputs, V2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">QÃá (kW)</label>
                            <input type="text" inputMode="decimal" value={inputs.Qdot}
                                onChange={(e) => setInputs({...inputs, Qdot: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0 for adiabatic" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">·∫Ü (kW)</label>
                            <input type="text" inputMode="decimal" value={inputs.Wdot}
                                onChange={(e) => setInputs({...inputs, Wdot: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Power" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.Wdot !== undefined && <div>·∫Ü = <strong>{result.Wdot.toPrecision(6)}</strong> kW</div>}
                            {result.Qdot !== undefined && <div>QÃá = <strong>{result.Qdot.toPrecision(6)}</strong> kW</div>}
                            {result.h2 !== undefined && <div>h‚ÇÇ = <strong>{result.h2.toPrecision(6)}</strong> kJ/kg</div>}
                            {result.mdot !== undefined && <div>·πÅ = <strong>{result.mdot.toPrecision(6)}</strong> kg/s</div>}
                        </div>
                    )}
                </div>
            );
        };

        // Turbine Calculator
        const TurbineCalc = () => {
            const [inputs, setInputs] = useState({ mdot: '', h1: '', h2: '', eta: '100' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const mdot = parseFloat(inputs.mdot), h1 = parseFloat(inputs.h1), h2 = parseFloat(inputs.h2);
                const eta = parseFloat(inputs.eta) / 100;
                
                if (!isNaN(mdot) && !isNaN(h1) && !isNaN(h2) && !isNaN(eta) && inputs.mdot && inputs.h1 && inputs.h2) {
                    const Wdot_ideal = mdot * (h1 - h2);
                    const Wdot_actual = Wdot_ideal * eta;
                    setResult({ Wdot_ideal, Wdot_actual, eta: eta * 100 });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚ö° Turbine Power Output</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        ·∫Ü = ·πÅ(h‚ÇÅ - h‚ÇÇ) √ó Œ∑
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° For turbines: h‚ÇÅ &gt; h‚ÇÇ (fluid expands, loses enthalpy)
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">·πÅ (kg/s)</label>
                            <input type="text" inputMode="decimal" value={inputs.mdot}
                                onChange={(e) => setInputs({...inputs, mdot: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mass flow rate" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÅ inlet (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h1}
                                onChange={(e) => setInputs({...inputs, h1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Inlet enthalpy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÇ outlet (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h2}
                                onChange={(e) => setInputs({...inputs, h2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Outlet enthalpy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Œ∑ isentropic (%)</label>
                            <input type="text" inputMode="decimal" value={inputs.eta}
                                onChange={(e) => setInputs({...inputs, eta: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="100" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Power Output:</div>
                            <div>·∫Ü_ideal = <strong>{result.Wdot_ideal.toPrecision(6)}</strong> kW</div>
                            {result.eta < 100 && <div>·∫Ü_actual = <strong>{result.Wdot_actual.toPrecision(6)}</strong> kW (at {result.eta}% efficiency)</div>}
                        </div>
                    )}
                </div>
            );
        };

        // Compressor/Pump Calculator
        const CompressorCalc = () => {
            const [type, setType] = useState('compressor');
            const [inputs, setInputs] = useState({ mdot: '', h1: '', h2: '', eta: '100', v: '0.001', P1: '', P2: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const mdot = parseFloat(inputs.mdot), h1 = parseFloat(inputs.h1), h2 = parseFloat(inputs.h2);
                const eta = parseFloat(inputs.eta) / 100;
                const v = parseFloat(inputs.v), P1 = parseFloat(inputs.P1), P2 = parseFloat(inputs.P2);
                
                let calc = null;
                
                if (type === 'compressor' && !isNaN(mdot) && !isNaN(h1) && !isNaN(h2) && !isNaN(eta) && inputs.mdot && inputs.h1 && inputs.h2) {
                    const Wdot_ideal = mdot * (h2 - h1);
                    const Wdot_actual = Wdot_ideal / eta;
                    calc = { Wdot_ideal, Wdot_actual, eta: eta * 100 };
                } else if (type === 'pump' && !isNaN(mdot) && !isNaN(v) && !isNaN(P1) && !isNaN(P2) && !isNaN(eta) && inputs.mdot && inputs.P1 && inputs.P2) {
                    // Pump: ·∫Ü = ·πÅv(P2-P1)
                    const Wdot_ideal = mdot * v * (P2 - P1); // kW
                    const Wdot_actual = Wdot_ideal / eta;
                    calc = { Wdot_ideal, Wdot_actual, eta: eta * 100 };
                }
                
                setResult(calc);
            }, [inputs, type]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üîß Compressor / Pump Power Input</h3>
                    <div className="flex gap-2 mb-4">
                        <button onClick={() => setType('compressor')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${type === 'compressor' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Compressor (gas)
                        </button>
                        <button onClick={() => setType('pump')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${type === 'pump' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Pump (liquid)
                        </button>
                    </div>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        {type === 'compressor' ? '·∫Ü = ·πÅ(h‚ÇÇ - h‚ÇÅ) / Œ∑' : '·∫Ü = ·πÅv(P‚ÇÇ - P‚ÇÅ) / Œ∑'}
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">·πÅ (kg/s)</label>
                            <input type="text" inputMode="decimal" value={inputs.mdot}
                                onChange={(e) => setInputs({...inputs, mdot: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mass flow rate" />
                        </div>
                        {type === 'compressor' ? (
                            <>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÅ inlet (kJ/kg)</label>
                                    <input type="text" inputMode="decimal" value={inputs.h1}
                                        onChange={(e) => setInputs({...inputs, h1: e.target.value})}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Inlet enthalpy" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÇ outlet (kJ/kg)</label>
                                    <input type="text" inputMode="decimal" value={inputs.h2}
                                        onChange={(e) => setInputs({...inputs, h2: e.target.value})}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Outlet enthalpy" />
                                </div>
                            </>
                        ) : (
                            <>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">v (m¬≥/kg)</label>
                                    <input type="text" inputMode="decimal" value={inputs.v}
                                        onChange={(e) => setInputs({...inputs, v: e.target.value})}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0.001 for water" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÅ (kPa)</label>
                                    <input type="text" inputMode="decimal" value={inputs.P1}
                                        onChange={(e) => setInputs({...inputs, P1: e.target.value})}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Inlet pressure" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÇ (kPa)</label>
                                    <input type="text" inputMode="decimal" value={inputs.P2}
                                        onChange={(e) => setInputs({...inputs, P2: e.target.value})}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Outlet pressure" />
                                </div>
                            </>
                        )}
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Œ∑ isentropic (%)</label>
                            <input type="text" inputMode="decimal" value={inputs.eta}
                                onChange={(e) => setInputs({...inputs, eta: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="100" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Power Input (required):</div>
                            <div>·∫Ü_ideal = <strong>{result.Wdot_ideal.toPrecision(6)}</strong> kW</div>
                            {result.eta < 100 && <div>·∫Ü_actual = <strong>{result.Wdot_actual.toPrecision(6)}</strong> kW (at {result.eta}% efficiency)</div>}
                        </div>
                    )}
                </div>
            );
        };

        // Nozzle/Diffuser
        const NozzleDiffuser = () => {
            const [type, setType] = useState('nozzle');
            const [inputs, setInputs] = useState({ h1: '', h2: '', V1: '0', V2: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const h1 = parseFloat(inputs.h1), h2 = parseFloat(inputs.h2);
                const V1 = parseFloat(inputs.V1), V2 = parseFloat(inputs.V2);
                
                // h1 + V1¬≤/2000 = h2 + V2¬≤/2000
                let calc = {};
                
                if (inputs.V2 === '' && !isNaN(h1) && !isNaN(h2) && !isNaN(V1) && inputs.h1 && inputs.h2) {
                    const V2sq = V1*V1 + 2000*(h1 - h2);
                    if (V2sq >= 0) calc.V2 = Math.sqrt(V2sq);
                }
                if (inputs.h2 === '' && !isNaN(h1) && !isNaN(V1) && !isNaN(V2) && inputs.h1 && inputs.V2) {
                    calc.h2 = h1 + (V1*V1 - V2*V2) / 2000;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs, type]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üí® Nozzle / Diffuser</h3>
                    <div className="flex gap-2 mb-4">
                        <button onClick={() => setType('nozzle')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${type === 'nozzle' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Nozzle (accelerate)
                        </button>
                        <button onClick={() => setType('diffuser')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${type === 'diffuser' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Diffuser (decelerate)
                        </button>
                    </div>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        h‚ÇÅ + V‚ÇÅ¬≤/2 = h‚ÇÇ + V‚ÇÇ¬≤/2
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° {type === 'nozzle' ? 'Nozzle: V‚ÇÇ > V‚ÇÅ, h‚ÇÇ < h‚ÇÅ (enthalpy converts to kinetic energy)' : 'Diffuser: V‚ÇÇ < V‚ÇÅ, h‚ÇÇ > h‚ÇÅ (kinetic energy converts to enthalpy)'}
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÅ (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h1}
                                onChange={(e) => setInputs({...inputs, h1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Inlet enthalpy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÇ (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h2}
                                onChange={(e) => setInputs({...inputs, h2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Outlet enthalpy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">V‚ÇÅ (m/s)</label>
                            <input type="text" inputMode="decimal" value={inputs.V1}
                                onChange={(e) => setInputs({...inputs, V1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Inlet velocity" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">V‚ÇÇ (m/s)</label>
                            <input type="text" inputMode="decimal" value={inputs.V2}
                                onChange={(e) => setInputs({...inputs, V2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Outlet velocity" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.V2 !== undefined && <div>V‚ÇÇ = <strong>{result.V2.toPrecision(6)}</strong> m/s</div>}
                            {result.h2 !== undefined && <div>h‚ÇÇ = <strong>{result.h2.toPrecision(6)}</strong> kJ/kg</div>}
                        </div>
                    )}
                </div>
            );
        };

        // Throttling Valve
        const ThrottlingValve = () => {
            const [inputs, setInputs] = useState({ h1: '', P1: '', P2: '', T1: '', x2: '' });
            const [result, setResult] = useState(null);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üîΩ Throttling Valve (Expansion)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        h‚ÇÅ = h‚ÇÇ (isenthalpic process)
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° No work, no heat transfer, no change in KE/PE. Pressure drops, enthalpy stays constant.
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÅ inlet (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h1}
                                onChange={(e) => setInputs({...inputs, h1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Inlet enthalpy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÅ (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P1}
                                onChange={(e) => setInputs({...inputs, P1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Inlet pressure" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÇ (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P2}
                                onChange={(e) => setInputs({...inputs, P2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Outlet pressure" />
                        </div>
                    </div>
                    {inputs.h1 && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            <div>h‚ÇÇ = h‚ÇÅ = <strong>{inputs.h1}</strong> kJ/kg</div>
                            <div className="text-xs text-gray-500 mt-2">Use steam tables at P‚ÇÇ to find state 2 (likely two-phase mixture)</div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Common use:</strong> Refrigeration cycles, flash evaporators. If h‚ÇÅ = h_f at high P, then at lower P the fluid becomes a two-phase mixture.
                    </div>
                </div>
            );
        };

        // Heat Exchanger
        const HeatExchanger = () => {
            const [inputs, setInputs] = useState({ mdot_h: '', h_h1: '', h_h2: '', mdot_c: '', h_c1: '', h_c2: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const mdot_h = parseFloat(inputs.mdot_h), h_h1 = parseFloat(inputs.h_h1), h_h2 = parseFloat(inputs.h_h2);
                const mdot_c = parseFloat(inputs.mdot_c), h_c1 = parseFloat(inputs.h_c1), h_c2 = parseFloat(inputs.h_c2);
                
                // Energy balance: ·πÅ_h(h_h1 - h_h2) = ·πÅ_c(h_c2 - h_c1)
                let calc = {};
                
                if (inputs.h_c2 === '' && !isNaN(mdot_h) && !isNaN(h_h1) && !isNaN(h_h2) && !isNaN(mdot_c) && !isNaN(h_c1) && mdot_c !== 0) {
                    const Q = mdot_h * (h_h1 - h_h2);
                    calc.h_c2 = h_c1 + Q / mdot_c;
                    calc.Qdot = Q;
                }
                if (inputs.h_h2 === '' && !isNaN(mdot_h) && !isNaN(h_h1) && !isNaN(mdot_c) && !isNaN(h_c1) && !isNaN(h_c2) && mdot_h !== 0) {
                    const Q = mdot_c * (h_c2 - h_c1);
                    calc.h_h2 = h_h1 - Q / mdot_h;
                    calc.Qdot = Q;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üî• Heat Exchanger</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        ·πÅ_hot(h‚ÇÅ - h‚ÇÇ)_hot = ·πÅ_cold(h‚ÇÇ - h‚ÇÅ)_cold
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div className="p-3 bg-red-50 rounded-lg">
                            <div className="text-sm font-medium text-red-800 mb-2">Hot Stream</div>
                            <div className="space-y-2">
                                <div>
                                    <label className="block text-xs text-gray-600 mb-1">·πÅ_hot (kg/s)</label>
                                    <input type="text" inputMode="decimal" value={inputs.mdot_h}
                                        onChange={(e) => setInputs({...inputs, mdot_h: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="Flow rate" />
                                </div>
                                <div>
                                    <label className="block text-xs text-gray-600 mb-1">h‚ÇÅ_hot (kJ/kg)</label>
                                    <input type="text" inputMode="decimal" value={inputs.h_h1}
                                        onChange={(e) => setInputs({...inputs, h_h1: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="Inlet" />
                                </div>
                                <div>
                                    <label className="block text-xs text-gray-600 mb-1">h‚ÇÇ_hot (kJ/kg)</label>
                                    <input type="text" inputMode="decimal" value={inputs.h_h2}
                                        onChange={(e) => setInputs({...inputs, h_h2: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="Outlet (leave empty)" />
                                </div>
                            </div>
                        </div>
                        <div className="p-3 bg-blue-50 rounded-lg">
                            <div className="text-sm font-medium text-blue-800 mb-2">Cold Stream</div>
                            <div className="space-y-2">
                                <div>
                                    <label className="block text-xs text-gray-600 mb-1">·πÅ_cold (kg/s)</label>
                                    <input type="text" inputMode="decimal" value={inputs.mdot_c}
                                        onChange={(e) => setInputs({...inputs, mdot_c: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="Flow rate" />
                                </div>
                                <div>
                                    <label className="block text-xs text-gray-600 mb-1">h‚ÇÅ_cold (kJ/kg)</label>
                                    <input type="text" inputMode="decimal" value={inputs.h_c1}
                                        onChange={(e) => setInputs({...inputs, h_c1: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="Inlet" />
                                </div>
                                <div>
                                    <label className="block text-xs text-gray-600 mb-1">h‚ÇÇ_cold (kJ/kg)</label>
                                    <input type="text" inputMode="decimal" value={inputs.h_c2}
                                        onChange={(e) => setInputs({...inputs, h_c2: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="Outlet (leave empty)" />
                                </div>
                            </div>
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.h_c2 !== undefined && <div>h‚ÇÇ_cold = <strong>{result.h_c2.toPrecision(6)}</strong> kJ/kg</div>}
                            {result.h_h2 !== undefined && <div>h‚ÇÇ_hot = <strong>{result.h_h2.toPrecision(6)}</strong> kJ/kg</div>}
                            {result.Qdot !== undefined && <div>QÃá = <strong>{result.Qdot.toPrecision(6)}</strong> kW</div>}
                        </div>
                    )}
                </div>
            );
        };

        // ==================== CHAPTER 6: SECOND LAW ====================

        // Heat Engine
        const HeatEngine = () => {
            const [inputs, setInputs] = useState({ QH: '', QL: '', W: '', eta: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const QH = parseFloat(inputs.QH), QL = parseFloat(inputs.QL);
                const W = parseFloat(inputs.W), eta = parseFloat(inputs.eta) / 100;
                let calc = {};
                
                // W = QH - QL, Œ∑ = W/QH = 1 - QL/QH
                if (inputs.W === '' && !isNaN(QH) && !isNaN(QL)) {
                    calc.W = QH - QL;
                    calc.eta = (calc.W / QH) * 100;
                }
                if (inputs.QL === '' && !isNaN(QH) && !isNaN(W)) {
                    calc.QL = QH - W;
                    calc.eta = (W / QH) * 100;
                }
                if (inputs.QH === '' && !isNaN(QL) && !isNaN(W)) {
                    calc.QH = QL + W;
                    calc.eta = (W / calc.QH) * 100;
                }
                if (inputs.eta === '' && !isNaN(QH) && !isNaN(W) && QH !== 0) {
                    calc.eta = (W / QH) * 100;
                }
                if (!isNaN(eta) && !isNaN(QH) && inputs.eta !== '') {
                    calc.W = eta * QH;
                    calc.QL = QH - calc.W;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üî• Heat Engine</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        Œ∑ = W/Q_H = 1 - Q_L/Q_H &nbsp;|&nbsp; W = Q_H - Q_L
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Q_H (kJ or kW)</label>
                            <input type="text" inputMode="decimal" value={inputs.QH}
                                onChange={(e) => setInputs({...inputs, QH: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Heat from hot source" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Q_L (kJ or kW)</label>
                            <input type="text" inputMode="decimal" value={inputs.QL}
                                onChange={(e) => setInputs({...inputs, QL: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Heat to cold sink" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">W (kJ or kW)</label>
                            <input type="text" inputMode="decimal" value={inputs.W}
                                onChange={(e) => setInputs({...inputs, W: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Work output" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Œ∑ (%)</label>
                            <input type="text" inputMode="decimal" value={inputs.eta}
                                onChange={(e) => setInputs({...inputs, eta: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Efficiency" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.W !== undefined && <div>W = <strong>{result.W.toPrecision(6)}</strong></div>}
                            {result.QH !== undefined && <div>Q_H = <strong>{result.QH.toPrecision(6)}</strong></div>}
                            {result.QL !== undefined && <div>Q_L = <strong>{result.QL.toPrecision(6)}</strong></div>}
                            {result.eta !== undefined && <div>Œ∑ = <strong>{result.eta.toPrecision(4)}%</strong></div>}
                        </div>
                    )}
                </div>
            );
        };

        // Carnot Efficiency
        const CarnotEfficiency = () => {
            const [type, setType] = useState('engine');
            const [inputs, setInputs] = useState({ TH: '', TL: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const TH = parseFloat(inputs.TH), TL = parseFloat(inputs.TL);
                
                if (!isNaN(TH) && !isNaN(TL) && TH > 0 && TL > 0 && inputs.TH && inputs.TL) {
                    const eta_carnot = 1 - TL / TH;
                    const COP_R = TL / (TH - TL);
                    const COP_HP = TH / (TH - TL);
                    setResult({ eta: eta_carnot * 100, COP_R, COP_HP });
                } else setResult(null);
            }, [inputs, type]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚ö° Carnot Efficiency / COP</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        Œ∑_carnot = 1 - T_L/T_H &nbsp;|&nbsp; COP_R = T_L/(T_H-T_L) &nbsp;|&nbsp; COP_HP = T_H/(T_H-T_L)
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° Temperatures must be in Kelvin (absolute temperature)
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T_H (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.TH}
                                onChange={(e) => setInputs({...inputs, TH: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Hot reservoir temp" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T_L (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.TL}
                                onChange={(e) => setInputs({...inputs, TL: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Cold reservoir temp" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Maximum (Carnot) Performance:</div>
                            <div className="grid grid-cols-3 gap-4 text-sm">
                                <div className="p-2 bg-white rounded">
                                    <div className="text-xs text-gray-500">Heat Engine</div>
                                    <div className="font-bold">Œ∑ = {result.eta.toPrecision(4)}%</div>
                                </div>
                                <div className="p-2 bg-white rounded">
                                    <div className="text-xs text-gray-500">Refrigerator</div>
                                    <div className="font-bold">COP_R = {result.COP_R.toPrecision(4)}</div>
                                </div>
                                <div className="p-2 bg-white rounded">
                                    <div className="text-xs text-gray-500">Heat Pump</div>
                                    <div className="font-bold">COP_HP = {result.COP_HP.toPrecision(4)}</div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Refrigerator
        const Refrigerator = () => {
            const [inputs, setInputs] = useState({ QL: '', QH: '', W: '', COP: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const QL = parseFloat(inputs.QL), QH = parseFloat(inputs.QH);
                const W = parseFloat(inputs.W), COP = parseFloat(inputs.COP);
                let calc = {};
                
                // COP_R = QL/W, W = QH - QL
                if (inputs.W === '' && !isNaN(QH) && !isNaN(QL)) {
                    calc.W = QH - QL;
                    calc.COP = QL / calc.W;
                }
                if (inputs.COP === '' && !isNaN(QL) && !isNaN(W) && W !== 0) {
                    calc.COP = QL / W;
                    calc.QH = QL + W;
                }
                if (inputs.QL === '' && !isNaN(COP) && !isNaN(W)) {
                    calc.QL = COP * W;
                    calc.QH = calc.QL + W;
                }
                if (inputs.W === '' && !isNaN(COP) && !isNaN(QL) && COP !== 0) {
                    calc.W = QL / COP;
                    calc.QH = QL + calc.W;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚ùÑÔ∏è Refrigerator</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        COP_R = Q_L / W &nbsp;|&nbsp; W = Q_H - Q_L
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Q_L (cooling capacity)</label>
                            <input type="text" inputMode="decimal" value={inputs.QL}
                                onChange={(e) => setInputs({...inputs, QL: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Heat removed from cold" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Q_H (heat rejected)</label>
                            <input type="text" inputMode="decimal" value={inputs.QH}
                                onChange={(e) => setInputs({...inputs, QH: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Heat to hot side" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">W (work input)</label>
                            <input type="text" inputMode="decimal" value={inputs.W}
                                onChange={(e) => setInputs({...inputs, W: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Compressor work" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">COP_R</label>
                            <input type="text" inputMode="decimal" value={inputs.COP}
                                onChange={(e) => setInputs({...inputs, COP: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Coefficient of performance" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.W !== undefined && <div>W = <strong>{result.W.toPrecision(6)}</strong></div>}
                            {result.QL !== undefined && <div>Q_L = <strong>{result.QL.toPrecision(6)}</strong></div>}
                            {result.QH !== undefined && <div>Q_H = <strong>{result.QH.toPrecision(6)}</strong></div>}
                            {result.COP !== undefined && <div>COP_R = <strong>{result.COP.toPrecision(4)}</strong></div>}
                        </div>
                    )}
                </div>
            );
        };

        // Heat Pump
        const HeatPump = () => {
            const [inputs, setInputs] = useState({ QL: '', QH: '', W: '', COP: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const QL = parseFloat(inputs.QL), QH = parseFloat(inputs.QH);
                const W = parseFloat(inputs.W), COP = parseFloat(inputs.COP);
                let calc = {};
                
                // COP_HP = QH/W, W = QH - QL
                if (inputs.W === '' && !isNaN(QH) && !isNaN(QL)) {
                    calc.W = QH - QL;
                    calc.COP = QH / calc.W;
                }
                if (inputs.COP === '' && !isNaN(QH) && !isNaN(W) && W !== 0) {
                    calc.COP = QH / W;
                    calc.QL = QH - W;
                }
                if (inputs.QH === '' && !isNaN(COP) && !isNaN(W)) {
                    calc.QH = COP * W;
                    calc.QL = calc.QH - W;
                }
                if (inputs.W === '' && !isNaN(COP) && !isNaN(QH) && COP !== 0) {
                    calc.W = QH / COP;
                    calc.QL = QH - calc.W;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üè† Heat Pump</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        COP_HP = Q_H / W &nbsp;|&nbsp; W = Q_H - Q_L
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Q_H (heating capacity)</label>
                            <input type="text" inputMode="decimal" value={inputs.QH}
                                onChange={(e) => setInputs({...inputs, QH: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Heat delivered to hot" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Q_L (heat absorbed)</label>
                            <input type="text" inputMode="decimal" value={inputs.QL}
                                onChange={(e) => setInputs({...inputs, QL: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Heat from cold side" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">W (work input)</label>
                            <input type="text" inputMode="decimal" value={inputs.W}
                                onChange={(e) => setInputs({...inputs, W: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Compressor work" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">COP_HP</label>
                            <input type="text" inputMode="decimal" value={inputs.COP}
                                onChange={(e) => setInputs({...inputs, COP: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Coefficient of performance" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.W !== undefined && <div>W = <strong>{result.W.toPrecision(6)}</strong></div>}
                            {result.QH !== undefined && <div>Q_H = <strong>{result.QH.toPrecision(6)}</strong></div>}
                            {result.QL !== undefined && <div>Q_L = <strong>{result.QL.toPrecision(6)}</strong></div>}
                            {result.COP !== undefined && <div>COP_HP = <strong>{result.COP.toPrecision(4)}</strong></div>}
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Note:</strong> COP_HP = COP_R + 1 (always &gt; 1 for any real heat pump)
                    </div>
                </div>
            );
        };

        // Second Law Efficiency
        const SecondLawEfficiency = () => {
            const [type, setType] = useState('engine');
            const [inputs, setInputs] = useState({ eta_actual: '', eta_carnot: '', COP_actual: '', COP_carnot: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                let calc = null;
                
                if (type === 'engine') {
                    const eta_actual = parseFloat(inputs.eta_actual);
                    const eta_carnot = parseFloat(inputs.eta_carnot);
                    if (!isNaN(eta_actual) && !isNaN(eta_carnot) && eta_carnot !== 0) {
                        calc = { eta_II: (eta_actual / eta_carnot) * 100 };
                    }
                } else {
                    const COP_actual = parseFloat(inputs.COP_actual);
                    const COP_carnot = parseFloat(inputs.COP_carnot);
                    if (!isNaN(COP_actual) && !isNaN(COP_carnot) && COP_carnot !== 0) {
                        calc = { eta_II: (COP_actual / COP_carnot) * 100 };
                    }
                }
                
                setResult(calc);
            }, [inputs, type]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìä Second Law Efficiency</h3>
                    <div className="flex gap-2 mb-4">
                        <button onClick={() => setType('engine')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${type === 'engine' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Heat Engine
                        </button>
                        <button onClick={() => setType('refrigerator')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${type === 'refrigerator' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Refrigerator / Heat Pump
                        </button>
                    </div>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        {type === 'engine' ? 'Œ∑_II = Œ∑_actual / Œ∑_carnot' : 'Œ∑_II = COP_actual / COP_carnot'}
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        {type === 'engine' ? (
                            <>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">Œ∑_actual (%)</label>
                                    <input type="text" inputMode="decimal" value={inputs.eta_actual}
                                        onChange={(e) => setInputs({...inputs, eta_actual: e.target.value})}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Actual efficiency" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">Œ∑_carnot (%)</label>
                                    <input type="text" inputMode="decimal" value={inputs.eta_carnot}
                                        onChange={(e) => setInputs({...inputs, eta_carnot: e.target.value})}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Carnot efficiency" />
                                </div>
                            </>
                        ) : (
                            <>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">COP_actual</label>
                                    <input type="text" inputMode="decimal" value={inputs.COP_actual}
                                        onChange={(e) => setInputs({...inputs, COP_actual: e.target.value})}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Actual COP" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-600 mb-1">COP_carnot</label>
                                    <input type="text" inputMode="decimal" value={inputs.COP_carnot}
                                        onChange={(e) => setInputs({...inputs, COP_carnot: e.target.value})}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Carnot COP" />
                                </div>
                            </>
                        )}
                    </div>
                    {result && (
                        <div className={`p-4 rounded-lg border ${result.eta_II > 100 ? 'bg-red-50 border-red-200' : 'bg-green-50 border-green-200'}`}>
                            <div className="text-sm font-medium mb-2">{result.eta_II > 100 ? '‚ö†Ô∏è Impossible!' : '‚úì'} Second Law Efficiency:</div>
                            <div className="text-lg">Œ∑_II = <strong>{result.eta_II.toPrecision(4)}%</strong></div>
                            {result.eta_II > 100 && <div className="text-sm text-red-600 mt-1">Cannot exceed 100% (Carnot limit)</div>}
                        </div>
                    )}
                </div>
            );
        };

        // ==================== CHAPTER 7: ENTROPY ====================

        // Entropy Change Ideal Gas
        const EntropyIdealGas = () => {
            const [formula, setFormula] = useState('TP');
            const [inputs, setInputs] = useState({ T1: '', T2: '', P1: '', P2: '', v1: '', v2: '', cp: '1.005', cv: '0.718', R: '0.287' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const T1 = parseFloat(inputs.T1), T2 = parseFloat(inputs.T2);
                const P1 = parseFloat(inputs.P1), P2 = parseFloat(inputs.P2);
                const v1 = parseFloat(inputs.v1), v2 = parseFloat(inputs.v2);
                const cp = parseFloat(inputs.cp), cv = parseFloat(inputs.cv), R = parseFloat(inputs.R);
                let ds = null;
                
                if (formula === 'TP' && !isNaN(T1) && !isNaN(T2) && !isNaN(P1) && !isNaN(P2) && !isNaN(cp) && !isNaN(R) && T1 > 0 && T2 > 0 && P1 > 0 && P2 > 0) {
                    ds = cp * Math.log(T2/T1) - R * Math.log(P2/P1);
                } else if (formula === 'Tv' && !isNaN(T1) && !isNaN(T2) && !isNaN(v1) && !isNaN(v2) && !isNaN(cv) && !isNaN(R) && T1 > 0 && T2 > 0 && v1 > 0 && v2 > 0) {
                    ds = cv * Math.log(T2/T1) + R * Math.log(v2/v1);
                } else if (formula === 'Pv' && !isNaN(P1) && !isNaN(P2) && !isNaN(v1) && !isNaN(v2) && !isNaN(cp) && !isNaN(cv) && P1 > 0 && P2 > 0 && v1 > 0 && v2 > 0) {
                    ds = cp * Math.log(v2/v1) + cv * Math.log(P2/P1);
                }
                
                setResult(ds !== null ? { ds } : null);
            }, [inputs, formula]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üîÑ Entropy Change (Ideal Gas)</h3>
                    <div className="flex gap-2 mb-4 flex-wrap">
                        <button onClick={() => setFormula('TP')}
                            className={`px-3 py-2 rounded-lg text-sm font-medium ${formula === 'TP' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            T and P
                        </button>
                        <button onClick={() => setFormula('Tv')}
                            className={`px-3 py-2 rounded-lg text-sm font-medium ${formula === 'Tv' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            T and v
                        </button>
                        <button onClick={() => setFormula('Pv')}
                            className={`px-3 py-2 rounded-lg text-sm font-medium ${formula === 'Pv' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            P and v
                        </button>
                    </div>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        {formula === 'TP' && 'Œîs = c‚Çö ln(T‚ÇÇ/T‚ÇÅ) - R ln(P‚ÇÇ/P‚ÇÅ)'}
                        {formula === 'Tv' && 'Œîs = c·µ• ln(T‚ÇÇ/T‚ÇÅ) + R ln(v‚ÇÇ/v‚ÇÅ)'}
                        {formula === 'Pv' && 'Œîs = c‚Çö ln(v‚ÇÇ/v‚ÇÅ) + c·µ• ln(P‚ÇÇ/P‚ÇÅ)'}
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        {(formula === 'TP' || formula === 'Tv') && <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÅ (K)</label>
                                <input type="text" inputMode="decimal" value={inputs.T1}
                                    onChange={(e) => setInputs({...inputs, T1: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Initial T" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÇ (K)</label>
                                <input type="text" inputMode="decimal" value={inputs.T2}
                                    onChange={(e) => setInputs({...inputs, T2: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Final T" />
                            </div>
                        </>}
                        {(formula === 'TP' || formula === 'Pv') && <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÅ (kPa)</label>
                                <input type="text" inputMode="decimal" value={inputs.P1}
                                    onChange={(e) => setInputs({...inputs, P1: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Initial P" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÇ (kPa)</label>
                                <input type="text" inputMode="decimal" value={inputs.P2}
                                    onChange={(e) => setInputs({...inputs, P2: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Final P" />
                            </div>
                        </>}
                        {(formula === 'Tv' || formula === 'Pv') && <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">v‚ÇÅ (m¬≥/kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.v1}
                                    onChange={(e) => setInputs({...inputs, v1: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Initial v" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">v‚ÇÇ (m¬≥/kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.v2}
                                    onChange={(e) => setInputs({...inputs, v2: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Final v" />
                            </div>
                        </>}
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">c‚Çö (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.cp}
                                onChange={(e) => setInputs({...inputs, cp: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="1.005" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">c·µ• (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.cv}
                                onChange={(e) => setInputs({...inputs, cv: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0.718" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">R (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.R}
                                onChange={(e) => setInputs({...inputs, R: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0.287" />
                        </div>
                    </div>
                    {result && (
                        <div className={`p-4 rounded-lg border ${result.ds >= 0 ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'}`}>
                            <div className="text-sm font-medium mb-2">Entropy Change:</div>
                            <div className="text-lg">Œîs = <strong>{result.ds.toPrecision(6)}</strong> kJ/kg¬∑K</div>
                            <div className="text-xs text-gray-500 mt-1">
                                {result.ds > 0 ? 'Entropy increases' : result.ds < 0 ? 'Entropy decreases (possible in open systems)' : 'Isentropic process'}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Entropy Change Incompressible
        const EntropyIncompressible = () => {
            const [inputs, setInputs] = useState({ T1: '', T2: '', c: '4.186' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const T1 = parseFloat(inputs.T1), T2 = parseFloat(inputs.T2), c = parseFloat(inputs.c);
                
                if (!isNaN(T1) && !isNaN(T2) && !isNaN(c) && T1 > 0 && T2 > 0 && inputs.T1 && inputs.T2) {
                    const ds = c * Math.log(T2 / T1);
                    setResult({ ds });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üíß Entropy Change (Liquids & Solids)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        Œîs = c ¬∑ ln(T‚ÇÇ/T‚ÇÅ)
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° For incompressible substances, entropy is independent of pressure
                    </div>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÅ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T1}
                                onChange={(e) => setInputs({...inputs, T1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Initial T" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÇ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T2}
                                onChange={(e) => setInputs({...inputs, T2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Final T" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">c (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.c}
                                onChange={(e) => setInputs({...inputs, c: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="4.186" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Entropy Change:</div>
                            <div>Œîs = <strong>{result.ds.toPrecision(6)}</strong> kJ/kg¬∑K</div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Common c values:</strong> Water: 4.186 | Ice: 2.09 | Copper: 0.386 | Iron: 0.45 kJ/kg¬∑K
                    </div>
                </div>
            );
        };

        // Isentropic Efficiency Turbine
        const IsentropicEfficiencyTurbine = () => {
            const [inputs, setInputs] = useState({ h1: '', h2_actual: '', h2s: '', eta: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const h1 = parseFloat(inputs.h1), h2a = parseFloat(inputs.h2_actual), h2s = parseFloat(inputs.h2s);
                const eta = parseFloat(inputs.eta) / 100;
                let calc = {};
                
                if (inputs.eta === '' && !isNaN(h1) && !isNaN(h2a) && !isNaN(h2s) && (h1 - h2s) !== 0) {
                    calc.eta = ((h1 - h2a) / (h1 - h2s)) * 100;
                    calc.W_actual = h1 - h2a;
                    calc.W_ideal = h1 - h2s;
                }
                if (inputs.h2_actual === '' && !isNaN(h1) && !isNaN(h2s) && !isNaN(eta)) {
                    calc.h2_actual = h1 - eta * (h1 - h2s);
                    calc.W_actual = h1 - calc.h2_actual;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚ö° Isentropic Efficiency (Turbine)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        Œ∑_t = (h‚ÇÅ - h‚ÇÇ‚Çê) / (h‚ÇÅ - h‚ÇÇ‚Çõ) = W_actual / W_ideal
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÅ inlet (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h1}
                                onChange={(e) => setInputs({...inputs, h1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Inlet enthalpy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÇ‚Çõ isentropic (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h2s}
                                onChange={(e) => setInputs({...inputs, h2s: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Ideal exit (s‚ÇÇ=s‚ÇÅ)" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÇ‚Çê actual (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h2_actual}
                                onChange={(e) => setInputs({...inputs, h2_actual: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Actual exit" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Œ∑_t (%)</label>
                            <input type="text" inputMode="decimal" value={inputs.eta}
                                onChange={(e) => setInputs({...inputs, eta: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Efficiency" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.eta !== undefined && <div>Œ∑_t = <strong>{result.eta.toPrecision(4)}%</strong></div>}
                            {result.h2_actual !== undefined && <div>h‚ÇÇ‚Çê = <strong>{result.h2_actual.toPrecision(6)}</strong> kJ/kg</div>}
                            {result.W_actual !== undefined && <div>W_actual = <strong>{result.W_actual.toPrecision(6)}</strong> kJ/kg</div>}
                            {result.W_ideal !== undefined && <div>W_ideal = <strong>{result.W_ideal.toPrecision(6)}</strong> kJ/kg</div>}
                        </div>
                    )}
                </div>
            );
        };

        // Isentropic Efficiency Compressor
        const IsentropicEfficiencyCompressor = () => {
            const [inputs, setInputs] = useState({ h1: '', h2_actual: '', h2s: '', eta: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const h1 = parseFloat(inputs.h1), h2a = parseFloat(inputs.h2_actual), h2s = parseFloat(inputs.h2s);
                const eta = parseFloat(inputs.eta) / 100;
                let calc = {};
                
                if (inputs.eta === '' && !isNaN(h1) && !isNaN(h2a) && !isNaN(h2s) && (h2a - h1) !== 0) {
                    calc.eta = ((h2s - h1) / (h2a - h1)) * 100;
                    calc.W_actual = h2a - h1;
                    calc.W_ideal = h2s - h1;
                }
                if (inputs.h2_actual === '' && !isNaN(h1) && !isNaN(h2s) && !isNaN(eta) && eta !== 0) {
                    calc.h2_actual = h1 + (h2s - h1) / eta;
                    calc.W_actual = calc.h2_actual - h1;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üîß Isentropic Efficiency (Compressor/Pump)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        Œ∑_c = (h‚ÇÇ‚Çõ - h‚ÇÅ) / (h‚ÇÇ‚Çê - h‚ÇÅ) = W_ideal / W_actual
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÅ inlet (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h1}
                                onChange={(e) => setInputs({...inputs, h1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Inlet enthalpy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÇ‚Çõ isentropic (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h2s}
                                onChange={(e) => setInputs({...inputs, h2s: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Ideal exit (s‚ÇÇ=s‚ÇÅ)" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÇ‚Çê actual (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h2_actual}
                                onChange={(e) => setInputs({...inputs, h2_actual: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Actual exit" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Œ∑_c (%)</label>
                            <input type="text" inputMode="decimal" value={inputs.eta}
                                onChange={(e) => setInputs({...inputs, eta: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Efficiency" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.eta !== undefined && <div>Œ∑_c = <strong>{result.eta.toPrecision(4)}%</strong></div>}
                            {result.h2_actual !== undefined && <div>h‚ÇÇ‚Çê = <strong>{result.h2_actual.toPrecision(6)}</strong> kJ/kg</div>}
                            {result.W_actual !== undefined && <div>W_actual = <strong>{result.W_actual.toPrecision(6)}</strong> kJ/kg</div>}
                            {result.W_ideal !== undefined && <div>W_ideal = <strong>{result.W_ideal.toPrecision(6)}</strong> kJ/kg</div>}
                        </div>
                    )}
                </div>
            );
        };

        // Entropy Generation
        const EntropyGeneration = () => {
            const [type, setType] = useState('heatTransfer');
            const [inputs, setInputs] = useState({ Q: '', TH: '', TL: '', m: '', s1: '', s2: '', T_surr: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                let Sgen = null;
                
                if (type === 'heatTransfer') {
                    const Q = parseFloat(inputs.Q), TH = parseFloat(inputs.TH), TL = parseFloat(inputs.TL);
                    if (!isNaN(Q) && !isNaN(TH) && !isNaN(TL) && TH > 0 && TL > 0) {
                        Sgen = Q/TL - Q/TH;
                    }
                } else if (type === 'closedSystem') {
                    const m = parseFloat(inputs.m), s1 = parseFloat(inputs.s1), s2 = parseFloat(inputs.s2);
                    const Q = parseFloat(inputs.Q), T_surr = parseFloat(inputs.T_surr);
                    if (!isNaN(m) && !isNaN(s1) && !isNaN(s2) && !isNaN(Q) && !isNaN(T_surr) && T_surr > 0) {
                        const dS_sys = m * (s2 - s1);
                        const dS_surr = -Q / T_surr;
                        Sgen = dS_sys + dS_surr;
                    }
                }
                
                setResult(Sgen !== null ? { Sgen } : null);
            }, [inputs, type]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìà Entropy Generation</h3>
                    <div className="flex gap-2 mb-4">
                        <button onClick={() => setType('heatTransfer')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${type === 'heatTransfer' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Heat Transfer
                        </button>
                        <button onClick={() => setType('closedSystem')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${type === 'closedSystem' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Closed System
                        </button>
                    </div>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        {type === 'heatTransfer' && 'S_gen = Q/T_L - Q/T_H'}
                        {type === 'closedSystem' && 'S_gen = m(s‚ÇÇ-s‚ÇÅ) + Q_out/T_surr'}
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        {type === 'heatTransfer' && <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">Q (kJ)</label>
                                <input type="text" inputMode="decimal" value={inputs.Q}
                                    onChange={(e) => setInputs({...inputs, Q: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Heat transferred" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">T_H (K)</label>
                                <input type="text" inputMode="decimal" value={inputs.TH}
                                    onChange={(e) => setInputs({...inputs, TH: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Hot temp" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">T_L (K)</label>
                                <input type="text" inputMode="decimal" value={inputs.TL}
                                    onChange={(e) => setInputs({...inputs, TL: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Cold temp" />
                            </div>
                        </>}
                        {type === 'closedSystem' && <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">m (kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.m}
                                    onChange={(e) => setInputs({...inputs, m: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mass" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">s‚ÇÅ (kJ/kg¬∑K)</label>
                                <input type="text" inputMode="decimal" value={inputs.s1}
                                    onChange={(e) => setInputs({...inputs, s1: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Initial entropy" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">s‚ÇÇ (kJ/kg¬∑K)</label>
                                <input type="text" inputMode="decimal" value={inputs.s2}
                                    onChange={(e) => setInputs({...inputs, s2: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Final entropy" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">Q (kJ, + = in)</label>
                                <input type="text" inputMode="decimal" value={inputs.Q}
                                    onChange={(e) => setInputs({...inputs, Q: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Heat transfer" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">T_surr (K)</label>
                                <input type="text" inputMode="decimal" value={inputs.T_surr}
                                    onChange={(e) => setInputs({...inputs, T_surr: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Surrounding temp" />
                            </div>
                        </>}
                    </div>
                    {result && (
                        <div className={`p-4 rounded-lg border ${result.Sgen >= 0 ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`}>
                            <div className="text-sm font-medium mb-2">
                                {result.Sgen >= 0 ? '‚úì' : '‚ö†Ô∏è Impossible!'} Entropy Generation:
                            </div>
                            <div className="text-lg">S_gen = <strong>{result.Sgen.toPrecision(6)}</strong> kJ/K</div>
                            {result.Sgen < 0 && <div className="text-sm text-red-600 mt-1">S_gen must be ‚â• 0 (Second Law violation)</div>}
                            {result.Sgen === 0 && <div className="text-sm text-green-600 mt-1">Reversible process</div>}
                            {result.Sgen > 0 && <div className="text-sm text-green-600 mt-1">Irreversible process</div>}
                        </div>
                    )}
                </div>
            );
        };

        // ==================== CHAPTER 8: EXERGY ====================

        // Dead State Reference
        const DeadState = () => {
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üåç Dead State (Reference)</h3>
                    <div className="p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <div className="text-sm text-blue-800 mb-3">
                            <strong>Standard Dead State Conditions:</strong>
                        </div>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div className="bg-white p-3 rounded">
                                <div className="text-gray-500">Temperature</div>
                                <div className="font-bold">T‚ÇÄ = 298.15 K</div>
                                <div className="text-xs text-gray-400">(25¬∞C)</div>
                            </div>
                            <div className="bg-white p-3 rounded">
                                <div className="text-gray-500">Pressure</div>
                                <div className="font-bold">P‚ÇÄ = 101.325 kPa</div>
                                <div className="text-xs text-gray-400">(1 atm)</div>
                            </div>
                            <div className="bg-white p-3 rounded">
                                <div className="text-gray-500">For Water</div>
                                <div className="font-bold">h‚ÇÄ ‚âà 104.9 kJ/kg</div>
                                <div className="text-xs text-gray-400">s‚ÇÄ ‚âà 0.367 kJ/kg¬∑K</div>
                            </div>
                            <div className="bg-white p-3 rounded">
                                <div className="text-gray-500">For Air</div>
                                <div className="font-bold">h‚ÇÄ ‚âà 298.2 kJ/kg</div>
                                <div className="text-xs text-gray-400">s‚ÇÄ ‚âà 1.70 kJ/kg¬∑K</div>
                            </div>
                        </div>
                    </div>
                    <div className="mt-4 text-sm text-gray-600">
                        üí° Exergy is always measured relative to the dead state - the state of equilibrium with the environment.
                    </div>
                </div>
            );
        };

        // Closed System Exergy
        const ClosedSystemExergy = () => {
            const [inputs, setInputs] = useState({ u: '', u0: '104.9', v: '', v0: '0.001003', s: '', s0: '0.367', T0: '298.15', P0: '101.325' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const u = parseFloat(inputs.u), u0 = parseFloat(inputs.u0);
                const v = parseFloat(inputs.v), v0 = parseFloat(inputs.v0);
                const s = parseFloat(inputs.s), s0 = parseFloat(inputs.s0);
                const T0 = parseFloat(inputs.T0), P0 = parseFloat(inputs.P0);
                
                if (!isNaN(u) && !isNaN(u0) && !isNaN(v) && !isNaN(v0) && !isNaN(s) && !isNaN(s0) && !isNaN(T0) && !isNaN(P0) && inputs.u && inputs.v && inputs.s) {
                    const phi = (u - u0) + P0 * (v - v0) - T0 * (s - s0);
                    setResult({ phi });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üì¶ Closed System Exergy</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        Œ¶ = (u - u‚ÇÄ) + P‚ÇÄ(v - v‚ÇÄ) - T‚ÇÄ(s - s‚ÇÄ)
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">u (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.u}
                                onChange={(e) => setInputs({...inputs, u: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Internal energy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">v (m¬≥/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.v}
                                onChange={(e) => setInputs({...inputs, v: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Specific volume" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">s (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.s}
                                onChange={(e) => setInputs({...inputs, s: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Entropy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">u‚ÇÄ (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.u0}
                                onChange={(e) => setInputs({...inputs, u0: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">v‚ÇÄ (m¬≥/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.v0}
                                onChange={(e) => setInputs({...inputs, v0: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">s‚ÇÄ (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.s0}
                                onChange={(e) => setInputs({...inputs, s0: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÄ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T0}
                                onChange={(e) => setInputs({...inputs, T0: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÄ (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P0}
                                onChange={(e) => setInputs({...inputs, P0: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Closed System Exergy:</div>
                            <div className="text-lg">Œ¶ = <strong>{result.phi.toPrecision(6)}</strong> kJ/kg</div>
                        </div>
                    )}
                </div>
            );
        };

        // Flow Exergy
        const FlowExergy = () => {
            const [inputs, setInputs] = useState({ h: '', h0: '104.9', s: '', s0: '0.367', V: '0', z: '0', T0: '298.15' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const h = parseFloat(inputs.h), h0 = parseFloat(inputs.h0);
                const s = parseFloat(inputs.s), s0 = parseFloat(inputs.s0);
                const V = parseFloat(inputs.V), z = parseFloat(inputs.z);
                const T0 = parseFloat(inputs.T0);
                const g = 9.81;
                
                if (!isNaN(h) && !isNaN(h0) && !isNaN(s) && !isNaN(s0) && !isNaN(V) && !isNaN(z) && !isNaN(T0) && inputs.h && inputs.s) {
                    const ke = (V * V) / 2000; // kJ/kg
                    const pe = (g * z) / 1000; // kJ/kg
                    const psi = (h - h0) - T0 * (s - s0) + ke + pe;
                    setResult({ psi, ke, pe });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üîÑ Flow Exergy (Stream Exergy)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        œà = (h - h‚ÇÄ) - T‚ÇÄ(s - s‚ÇÄ) + V¬≤/2 + gz
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h}
                                onChange={(e) => setInputs({...inputs, h: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Enthalpy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">s (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.s}
                                onChange={(e) => setInputs({...inputs, s: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Entropy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">V (m/s)</label>
                            <input type="text" inputMode="decimal" value={inputs.V}
                                onChange={(e) => setInputs({...inputs, V: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">z (m)</label>
                            <input type="text" inputMode="decimal" value={inputs.z}
                                onChange={(e) => setInputs({...inputs, z: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÄ (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h0}
                                onChange={(e) => setInputs({...inputs, h0: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">s‚ÇÄ (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.s0}
                                onChange={(e) => setInputs({...inputs, s0: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÄ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T0}
                                onChange={(e) => setInputs({...inputs, T0: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Flow Exergy:</div>
                            <div className="text-lg">œà = <strong>{result.psi.toPrecision(6)}</strong> kJ/kg</div>
                            <div className="text-xs text-gray-500 mt-2">
                                KE contribution: {result.ke.toPrecision(4)} kJ/kg | PE contribution: {result.pe.toPrecision(4)} kJ/kg
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Exergy Destruction
        const ExergyDestruction = () => {
            const [inputs, setInputs] = useState({ Sgen: '', T0: '298.15', mdot: '1' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const Sgen = parseFloat(inputs.Sgen), T0 = parseFloat(inputs.T0), mdot = parseFloat(inputs.mdot);
                
                if (!isNaN(Sgen) && !isNaN(T0) && !isNaN(mdot) && inputs.Sgen) {
                    const Xdest = T0 * Sgen;
                    const Xdest_rate = T0 * Sgen * mdot;
                    setResult({ Xdest, Xdest_rate });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üí• Exergy Destruction (Irreversibility)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        X_destroyed = T‚ÇÄ √ó S_gen
                    </div>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">S_gen (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.Sgen}
                                onChange={(e) => setInputs({...inputs, Sgen: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Entropy generation" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÄ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T0}
                                onChange={(e) => setInputs({...inputs, T0: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">·πÅ (kg/s)</label>
                            <input type="text" inputMode="decimal" value={inputs.mdot}
                                onChange={(e) => setInputs({...inputs, mdot: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="1" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Exergy Destruction:</div>
                            <div>x_destroyed = <strong>{result.Xdest.toPrecision(6)}</strong> kJ/kg</div>
                            <div>·∫ä_destroyed = <strong>{result.Xdest_rate.toPrecision(6)}</strong> kW</div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Note:</strong> Exergy destruction represents the lost potential to do useful work due to irreversibilities.
                    </div>
                </div>
            );
        };

        // Exergy Efficiency
        const ExergyEfficiency = () => {
            const [type, setType] = useState('turbine');
            const [inputs, setInputs] = useState({ X_in: '', X_out: '', W: '', X_dest: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const X_in = parseFloat(inputs.X_in), X_out = parseFloat(inputs.X_out);
                const W = parseFloat(inputs.W), X_dest = parseFloat(inputs.X_dest);
                let calc = {};
                
                if (type === 'turbine') {
                    // Œ∑_II = W / (X_in - X_out)
                    if (!isNaN(W) && !isNaN(X_in) && !isNaN(X_out) && (X_in - X_out) !== 0) {
                        calc.eta_II = (W / (X_in - X_out)) * 100;
                        calc.X_recovered = W;
                        calc.X_supplied = X_in - X_out;
                    }
                } else if (type === 'heatExchanger') {
                    // Œ∑_II = X_out_cold / X_in_hot
                    if (!isNaN(X_in) && !isNaN(X_out) && X_in !== 0) {
                        calc.eta_II = (X_out / X_in) * 100;
                    }
                } else if (type === 'general') {
                    // Œ∑_II = 1 - X_dest / X_in
                    if (!isNaN(X_dest) && !isNaN(X_in) && X_in !== 0) {
                        calc.eta_II = (1 - X_dest / X_in) * 100;
                    }
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs, type]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìä Exergy (Second Law) Efficiency</h3>
                    <div className="flex gap-2 mb-4 flex-wrap">
                        <button onClick={() => setType('turbine')}
                            className={`px-3 py-2 rounded-lg text-sm font-medium ${type === 'turbine' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Turbine/Compressor
                        </button>
                        <button onClick={() => setType('heatExchanger')}
                            className={`px-3 py-2 rounded-lg text-sm font-medium ${type === 'heatExchanger' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Heat Exchanger
                        </button>
                        <button onClick={() => setType('general')}
                            className={`px-3 py-2 rounded-lg text-sm font-medium ${type === 'general' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            General
                        </button>
                    </div>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        {type === 'turbine' && 'Œ∑_II = W / (œà_in - œà_out)'}
                        {type === 'heatExchanger' && 'Œ∑_II = ŒîX_cold / ŒîX_hot'}
                        {type === 'general' && 'Œ∑_II = 1 - X_destroyed / X_supplied'}
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        {type === 'turbine' && <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">œà_in (kJ/kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.X_in}
                                    onChange={(e) => setInputs({...inputs, X_in: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Inlet flow exergy" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">œà_out (kJ/kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.X_out}
                                    onChange={(e) => setInputs({...inputs, X_out: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Outlet flow exergy" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">W (kJ/kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.W}
                                    onChange={(e) => setInputs({...inputs, W: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Work output" />
                            </div>
                        </>}
                        {type === 'heatExchanger' && <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">ŒîX_hot (kJ/kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.X_in}
                                    onChange={(e) => setInputs({...inputs, X_in: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Exergy decrease (hot)" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">ŒîX_cold (kJ/kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.X_out}
                                    onChange={(e) => setInputs({...inputs, X_out: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Exergy increase (cold)" />
                            </div>
                        </>}
                        {type === 'general' && <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">X_supplied (kJ)</label>
                                <input type="text" inputMode="decimal" value={inputs.X_in}
                                    onChange={(e) => setInputs({...inputs, X_in: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Total exergy input" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">X_destroyed (kJ)</label>
                                <input type="text" inputMode="decimal" value={inputs.X_dest}
                                    onChange={(e) => setInputs({...inputs, X_dest: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Exergy destruction" />
                            </div>
                        </>}
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Exergy Efficiency:</div>
                            <div className="text-lg">Œ∑_II = <strong>{result.eta_II.toPrecision(4)}%</strong></div>
                            {result.X_recovered && <div className="text-xs text-gray-500 mt-2">
                                Exergy recovered: {result.X_recovered.toPrecision(4)} | Exergy supplied: {result.X_supplied.toPrecision(4)}
                            </div>}
                        </div>
                    )}
                </div>
            );
        };

        // Heat Transfer Exergy
        const HeatTransferExergy = () => {
            const [inputs, setInputs] = useState({ Q: '', T: '', T0: '298.15' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const Q = parseFloat(inputs.Q), T = parseFloat(inputs.T), T0 = parseFloat(inputs.T0);
                
                if (!isNaN(Q) && !isNaN(T) && !isNaN(T0) && T > 0 && inputs.Q && inputs.T) {
                    const X_heat = Q * (1 - T0 / T);
                    const carnotFactor = 1 - T0 / T;
                    setResult({ X_heat, carnotFactor });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üî• Exergy of Heat Transfer</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        X_heat = Q √ó (1 - T‚ÇÄ/T)
                    </div>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Q (kJ or kW)</label>
                            <input type="text" inputMode="decimal" value={inputs.Q}
                                onChange={(e) => setInputs({...inputs, Q: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Heat transfer" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T}
                                onChange={(e) => setInputs({...inputs, T: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Source temp" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÄ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T0}
                                onChange={(e) => setInputs({...inputs, T0: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            <div>X_heat = <strong>{result.X_heat.toPrecision(6)}</strong></div>
                            <div className="text-sm text-gray-500 mt-2">Carnot factor (1 - T‚ÇÄ/T) = {result.carnotFactor.toPrecision(4)}</div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Note:</strong> As T ‚Üí T‚ÇÄ, exergy ‚Üí 0. Heat at ambient temperature has no work potential.
                    </div>
                </div>
            );
        };

        // ==================== CHAPTER 9: GAS POWER CYCLES ====================

        // Otto Cycle
        const OttoCycle = () => {
            const [inputs, setInputs] = useState({ r: '', k: '1.4', T1: '', T3: '', P1: '', cv: '0.718' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const r = parseFloat(inputs.r), k = parseFloat(inputs.k);
                const T1 = parseFloat(inputs.T1), T3 = parseFloat(inputs.T3);
                const P1 = parseFloat(inputs.P1), cv = parseFloat(inputs.cv);
                
                if (!isNaN(r) && !isNaN(k) && r > 1 && inputs.r) {
                    const eta = 1 - Math.pow(1/r, k-1);
                    let calc = { eta: eta * 100 };
                    
                    if (!isNaN(T1) && !isNaN(T3) && !isNaN(cv)) {
                        const T2 = T1 * Math.pow(r, k-1);
                        const T4 = T3 * Math.pow(1/r, k-1);
                        const qin = cv * (T3 - T2);
                        const qout = cv * (T4 - T1);
                        const wnet = qin - qout;
                        calc = { ...calc, T2, T4, qin, qout, wnet };
                    }
                    
                    setResult(calc);
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üöó Otto Cycle (Spark-Ignition)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        Œ∑_Otto = 1 - 1/r^(k-1)
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">r (compression ratio)</label>
                            <input type="text" inputMode="decimal" value={inputs.r}
                                onChange={(e) => setInputs({...inputs, r: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="8-12 typical" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">k (Œ≥ = c‚Çö/c·µ•)</label>
                            <input type="text" inputMode="decimal" value={inputs.k}
                                onChange={(e) => setInputs({...inputs, k: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">c·µ• (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.cv}
                                onChange={(e) => setInputs({...inputs, cv: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÅ (K) - intake</label>
                            <input type="text" inputMode="decimal" value={inputs.T1}
                                onChange={(e) => setInputs({...inputs, T1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="~300 K" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÉ (K) - after combustion</label>
                            <input type="text" inputMode="decimal" value={inputs.T3}
                                onChange={(e) => setInputs({...inputs, T3: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="~2000 K" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Otto Cycle Results:</div>
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
                                <div className="bg-white p-2 rounded">Œ∑ = <strong>{result.eta.toPrecision(4)}%</strong></div>
                                {result.T2 && <div className="bg-white p-2 rounded">T‚ÇÇ = <strong>{result.T2.toPrecision(5)} K</strong></div>}
                                {result.T4 && <div className="bg-white p-2 rounded">T‚ÇÑ = <strong>{result.T4.toPrecision(5)} K</strong></div>}
                                {result.qin && <div className="bg-white p-2 rounded">q_in = <strong>{result.qin.toPrecision(5)} kJ/kg</strong></div>}
                                {result.qout && <div className="bg-white p-2 rounded">q_out = <strong>{result.qout.toPrecision(5)} kJ/kg</strong></div>}
                                {result.wnet && <div className="bg-white p-2 rounded">w_net = <strong>{result.wnet.toPrecision(5)} kJ/kg</strong></div>}
                            </div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Processes:</strong> 1‚Üí2 Isentropic compression | 2‚Üí3 Constant-V heat addition | 3‚Üí4 Isentropic expansion | 4‚Üí1 Constant-V heat rejection
                    </div>
                </div>
            );
        };

        // Diesel Cycle
        const DieselCycle = () => {
            const [inputs, setInputs] = useState({ r: '', rc: '', k: '1.4', T1: '', T3: '', cv: '0.718', cp: '1.005' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const r = parseFloat(inputs.r), rc = parseFloat(inputs.rc), k = parseFloat(inputs.k);
                const T1 = parseFloat(inputs.T1), T3 = parseFloat(inputs.T3);
                const cv = parseFloat(inputs.cv), cp = parseFloat(inputs.cp);
                
                if (!isNaN(r) && !isNaN(rc) && !isNaN(k) && r > 1 && rc >= 1 && inputs.r && inputs.rc) {
                    const eta = 1 - (1/Math.pow(r, k-1)) * ((Math.pow(rc, k) - 1) / (k * (rc - 1)));
                    let calc = { eta: eta * 100 };
                    
                    if (!isNaN(T1)) {
                        const T2 = T1 * Math.pow(r, k-1);
                        const T3_calc = T2 * rc;
                        const T4 = T3_calc * Math.pow(rc/r, k-1);
                        const qin = cp * (T3_calc - T2);
                        const qout = cv * (T4 - T1);
                        const wnet = qin - qout;
                        calc = { ...calc, T2, T3: T3_calc, T4, qin, qout, wnet };
                    }
                    
                    setResult(calc);
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üöõ Diesel Cycle (Compression-Ignition)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        Œ∑_Diesel = 1 - (1/r^(k-1)) √ó [(r_c^k - 1) / (k(r_c - 1))]
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">r (compression ratio)</label>
                            <input type="text" inputMode="decimal" value={inputs.r}
                                onChange={(e) => setInputs({...inputs, r: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="14-24 typical" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">r_c (cutoff ratio)</label>
                            <input type="text" inputMode="decimal" value={inputs.rc}
                                onChange={(e) => setInputs({...inputs, rc: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="2-4 typical" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">k (Œ≥)</label>
                            <input type="text" inputMode="decimal" value={inputs.k}
                                onChange={(e) => setInputs({...inputs, k: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÅ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T1}
                                onChange={(e) => setInputs({...inputs, T1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="~300 K" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Diesel Cycle Results:</div>
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
                                <div className="bg-white p-2 rounded">Œ∑ = <strong>{result.eta.toPrecision(4)}%</strong></div>
                                {result.T2 && <div className="bg-white p-2 rounded">T‚ÇÇ = <strong>{result.T2.toPrecision(5)} K</strong></div>}
                                {result.T3 && <div className="bg-white p-2 rounded">T‚ÇÉ = <strong>{result.T3.toPrecision(5)} K</strong></div>}
                                {result.T4 && <div className="bg-white p-2 rounded">T‚ÇÑ = <strong>{result.T4.toPrecision(5)} K</strong></div>}
                                {result.wnet && <div className="bg-white p-2 rounded">w_net = <strong>{result.wnet.toPrecision(5)} kJ/kg</strong></div>}
                            </div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Note:</strong> Cutoff ratio r_c = V‚ÇÉ/V‚ÇÇ. As r_c ‚Üí 1, Diesel ‚Üí Otto efficiency.
                    </div>
                </div>
            );
        };

        // Brayton Cycle
        const BraytonCycle = () => {
            const [inputs, setInputs] = useState({ rp: '', k: '1.4', T1: '', T3: '', cp: '1.005' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const rp = parseFloat(inputs.rp), k = parseFloat(inputs.k);
                const T1 = parseFloat(inputs.T1), T3 = parseFloat(inputs.T3);
                const cp = parseFloat(inputs.cp);
                
                if (!isNaN(rp) && !isNaN(k) && rp > 1 && inputs.rp) {
                    const eta = 1 - Math.pow(1/rp, (k-1)/k);
                    let calc = { eta: eta * 100 };
                    
                    if (!isNaN(T1) && !isNaN(T3) && !isNaN(cp)) {
                        const T2 = T1 * Math.pow(rp, (k-1)/k);
                        const T4 = T3 * Math.pow(1/rp, (k-1)/k);
                        const wcomp = cp * (T2 - T1);
                        const wturb = cp * (T3 - T4);
                        const wnet = wturb - wcomp;
                        const qin = cp * (T3 - T2);
                        const bwr = wcomp / wturb;
                        calc = { ...calc, T2, T4, wcomp, wturb, wnet, qin, bwr: bwr * 100 };
                    }
                    
                    setResult(calc);
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚úàÔ∏è Brayton Cycle (Gas Turbine)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        Œ∑_Brayton = 1 - 1/r_p^((k-1)/k)
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">r_p (pressure ratio)</label>
                            <input type="text" inputMode="decimal" value={inputs.rp}
                                onChange={(e) => setInputs({...inputs, rp: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="8-20 typical" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">k (Œ≥)</label>
                            <input type="text" inputMode="decimal" value={inputs.k}
                                onChange={(e) => setInputs({...inputs, k: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">c‚Çö (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.cp}
                                onChange={(e) => setInputs({...inputs, cp: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÅ (K) - compressor inlet</label>
                            <input type="text" inputMode="decimal" value={inputs.T1}
                                onChange={(e) => setInputs({...inputs, T1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="~300 K" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÉ (K) - turbine inlet</label>
                            <input type="text" inputMode="decimal" value={inputs.T3}
                                onChange={(e) => setInputs({...inputs, T3: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="~1200 K" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Brayton Cycle Results:</div>
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
                                <div className="bg-white p-2 rounded">Œ∑ = <strong>{result.eta.toPrecision(4)}%</strong></div>
                                {result.T2 && <div className="bg-white p-2 rounded">T‚ÇÇ = <strong>{result.T2.toPrecision(5)} K</strong></div>}
                                {result.T4 && <div className="bg-white p-2 rounded">T‚ÇÑ = <strong>{result.T4.toPrecision(5)} K</strong></div>}
                                {result.wcomp && <div className="bg-white p-2 rounded">w_comp = <strong>{result.wcomp.toPrecision(5)} kJ/kg</strong></div>}
                                {result.wturb && <div className="bg-white p-2 rounded">w_turb = <strong>{result.wturb.toPrecision(5)} kJ/kg</strong></div>}
                                {result.wnet && <div className="bg-white p-2 rounded">w_net = <strong>{result.wnet.toPrecision(5)} kJ/kg</strong></div>}
                                {result.bwr && <div className="bg-white p-2 rounded">BWR = <strong>{result.bwr.toPrecision(3)}%</strong></div>}
                            </div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>BWR</strong> = Back Work Ratio = w_comp/w_turb (typically 40-80% for gas turbines)
                    </div>
                </div>
            );
        };

        // Brayton with Regeneration
        const BraytonRegen = () => {
            const [inputs, setInputs] = useState({ rp: '', k: '1.4', T1: '', T3: '', epsilon: '80', cp: '1.005' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const rp = parseFloat(inputs.rp), k = parseFloat(inputs.k);
                const T1 = parseFloat(inputs.T1), T3 = parseFloat(inputs.T3);
                const epsilon = parseFloat(inputs.epsilon) / 100, cp = parseFloat(inputs.cp);
                
                if (!isNaN(rp) && !isNaN(k) && !isNaN(T1) && !isNaN(T3) && !isNaN(epsilon) && !isNaN(cp) && rp > 1 && inputs.rp && inputs.T1 && inputs.T3) {
                    const T2 = T1 * Math.pow(rp, (k-1)/k);
                    const T4 = T3 * Math.pow(1/rp, (k-1)/k);
                    
                    // With regenerator
                    const T5 = T2 + epsilon * (T4 - T2); // actual regen outlet (cold side)
                    const qin = cp * (T3 - T5);
                    const wcomp = cp * (T2 - T1);
                    const wturb = cp * (T3 - T4);
                    const wnet = wturb - wcomp;
                    const eta_regen = wnet / qin;
                    
                    // Without regen for comparison
                    const qin_noregen = cp * (T3 - T2);
                    const eta_noregen = wnet / qin_noregen;
                    
                    setResult({ eta_regen: eta_regen * 100, eta_noregen: eta_noregen * 100, T2, T4, T5, wnet, qin });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚ôªÔ∏è Brayton with Regeneration</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        Œµ = (T‚ÇÖ - T‚ÇÇ) / (T‚ÇÑ - T‚ÇÇ) ‚Üí Œ∑ increases as exhaust preheats compressed air
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">r_p (pressure ratio)</label>
                            <input type="text" inputMode="decimal" value={inputs.rp}
                                onChange={(e) => setInputs({...inputs, rp: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="8-20" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Œµ (effectiveness %)</label>
                            <input type="text" inputMode="decimal" value={inputs.epsilon}
                                onChange={(e) => setInputs({...inputs, epsilon: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="80" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">k (Œ≥)</label>
                            <input type="text" inputMode="decimal" value={inputs.k}
                                onChange={(e) => setInputs({...inputs, k: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÅ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T1}
                                onChange={(e) => setInputs({...inputs, T1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="~300 K" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÉ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T3}
                                onChange={(e) => setInputs({...inputs, T3: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="~1200 K" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Results:</div>
                            <div className="grid grid-cols-2 gap-2 text-sm">
                                <div className="bg-white p-2 rounded">Œ∑ (with regen) = <strong>{result.eta_regen.toPrecision(4)}%</strong></div>
                                <div className="bg-white p-2 rounded">Œ∑ (no regen) = <strong>{result.eta_noregen.toPrecision(4)}%</strong></div>
                                <div className="bg-white p-2 rounded">T‚ÇÖ (regen outlet) = <strong>{result.T5.toPrecision(5)} K</strong></div>
                                <div className="bg-white p-2 rounded">w_net = <strong>{result.wnet.toPrecision(5)} kJ/kg</strong></div>
                            </div>
                            <div className="mt-2 text-sm text-green-700">
                                Efficiency improvement: +{(result.eta_regen - result.eta_noregen).toPrecision(3)}%
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Mean Effective Pressure
        const MeanEffectivePressure = () => {
            const [inputs, setInputs] = useState({ wnet: '', v1: '', v2: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const wnet = parseFloat(inputs.wnet), v1 = parseFloat(inputs.v1), v2 = parseFloat(inputs.v2);
                
                if (!isNaN(wnet) && !isNaN(v1) && !isNaN(v2) && v1 !== v2 && inputs.wnet && inputs.v1 && inputs.v2) {
                    const MEP = wnet / (v1 - v2);
                    setResult({ MEP });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìä Mean Effective Pressure (MEP)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        MEP = w_net / (v‚ÇÅ - v‚ÇÇ) = w_net / (v_max - v_min)
                    </div>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">w_net (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.wnet}
                                onChange={(e) => setInputs({...inputs, wnet: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Net work" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">v‚ÇÅ = v_max (m¬≥/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.v1}
                                onChange={(e) => setInputs({...inputs, v1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Max volume" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">v‚ÇÇ = v_min (m¬≥/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.v2}
                                onChange={(e) => setInputs({...inputs, v2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Min volume" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            <div>MEP = <strong>{result.MEP.toPrecision(6)}</strong> kPa</div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Interpretation:</strong> MEP is the constant pressure that would produce the same net work over the same volume change. Higher MEP = more power from same displacement.
                    </div>
                </div>
            );
        };

        // Cycle Comparison
        const CycleComparison = () => {
            const [inputs, setInputs] = useState({ r: '10', rc: '2', rp: '10', k: '1.4' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const r = parseFloat(inputs.r), rc = parseFloat(inputs.rc);
                const rp = parseFloat(inputs.rp), k = parseFloat(inputs.k);
                
                if (!isNaN(r) && !isNaN(rc) && !isNaN(rp) && !isNaN(k) && r > 1 && rc >= 1 && rp > 1) {
                    const eta_otto = (1 - Math.pow(1/r, k-1)) * 100;
                    const eta_diesel = (1 - (1/Math.pow(r, k-1)) * ((Math.pow(rc, k) - 1) / (k * (rc - 1)))) * 100;
                    const eta_brayton = (1 - Math.pow(1/rp, (k-1)/k)) * 100;
                    
                    setResult({ eta_otto, eta_diesel, eta_brayton });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚öñÔ∏è Cycle Efficiency Comparison</h3>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">r (Otto/Diesel)</label>
                            <input type="text" inputMode="decimal" value={inputs.r}
                                onChange={(e) => setInputs({...inputs, r: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="10" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">r_c (Diesel)</label>
                            <input type="text" inputMode="decimal" value={inputs.rc}
                                onChange={(e) => setInputs({...inputs, rc: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="2" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">r_p (Brayton)</label>
                            <input type="text" inputMode="decimal" value={inputs.rp}
                                onChange={(e) => setInputs({...inputs, rp: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="10" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">k (Œ≥)</label>
                            <input type="text" inputMode="decimal" value={inputs.k}
                                onChange={(e) => setInputs({...inputs, k: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="1.4" />
                        </div>
                    </div>
                    {result && (
                        <div className="grid grid-cols-3 gap-3">
                            <div className="p-4 bg-red-50 rounded-lg border border-red-200 text-center">
                                <div className="text-xs text-red-600 mb-1">Otto</div>
                                <div className="text-xl font-bold text-red-800">{result.eta_otto.toPrecision(4)}%</div>
                            </div>
                            <div className="p-4 bg-blue-50 rounded-lg border border-blue-200 text-center">
                                <div className="text-xs text-blue-600 mb-1">Diesel</div>
                                <div className="text-xl font-bold text-blue-800">{result.eta_diesel.toPrecision(4)}%</div>
                            </div>
                            <div className="p-4 bg-green-50 rounded-lg border border-green-200 text-center">
                                <div className="text-xs text-green-600 mb-1">Brayton</div>
                                <div className="text-xl font-bold text-green-800">{result.eta_brayton.toPrecision(4)}%</div>
                            </div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Note:</strong> For same compression ratio, Otto > Diesel. In practice, Diesel engines use higher r, so they can be more efficient.
                    </div>
                </div>
            );
        };

        // ==================== CHAPTER 10: VAPOR POWER CYCLES ====================

        // Basic Rankine Cycle
        const RankineCycle = () => {
            const [inputs, setInputs] = useState({ h1: '', h2: '', h3: '', h4: '', mdot: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const h1 = parseFloat(inputs.h1), h2 = parseFloat(inputs.h2);
                const h3 = parseFloat(inputs.h3), h4 = parseFloat(inputs.h4);
                const mdot = parseFloat(inputs.mdot);
                
                if (!isNaN(h1) && !isNaN(h2) && !isNaN(h3) && !isNaN(h4) && inputs.h1 && inputs.h2 && inputs.h3 && inputs.h4) {
                    const wturb = h1 - h2;
                    const wpump = h4 - h3;
                    const wnet = wturb - wpump;
                    const qin = h1 - h4;
                    const qout = h2 - h3;
                    const eta = wnet / qin * 100;
                    const bwr = wpump / wturb * 100;
                    
                    let calc = { wturb, wpump, wnet, qin, qout, eta, bwr };
                    
                    if (!isNaN(mdot) && inputs.mdot) {
                        calc.Wdot_net = wnet * mdot;
                        calc.Qdot_in = qin * mdot;
                        calc.steamRate = 3600 / wnet;
                    }
                    
                    setResult(calc);
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚ô®Ô∏è Rankine Cycle (Basic)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        Œ∑ = w_net / q_in = [(h‚ÇÅ-h‚ÇÇ) - (h‚ÇÑ-h‚ÇÉ)] / (h‚ÇÅ-h‚ÇÑ)
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° States: 1=turbine inlet, 2=turbine outlet, 3=pump inlet, 4=pump outlet (boiler inlet)
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÅ turbine in (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h1}
                                onChange={(e) => setInputs({...inputs, h1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Superheated steam" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÇ turbine out (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h2}
                                onChange={(e) => setInputs({...inputs, h2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Wet or sat steam" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÉ pump in (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h3}
                                onChange={(e) => setInputs({...inputs, h3: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Sat liquid (h_f)" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÑ pump out (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h4}
                                onChange={(e) => setInputs({...inputs, h4: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Compressed liquid" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">·πÅ (kg/s) - optional</label>
                            <input type="text" inputMode="decimal" value={inputs.mdot}
                                onChange={(e) => setInputs({...inputs, mdot: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mass flow rate" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Results:</div>
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
                                <div>Œ∑_thermal = <strong>{result.eta.toPrecision(4)}%</strong></div>
                                <div>w_turb = <strong>{result.wturb.toPrecision(5)}</strong> kJ/kg</div>
                                <div>w_pump = <strong>{result.wpump.toPrecision(5)}</strong> kJ/kg</div>
                                <div>w_net = <strong>{result.wnet.toPrecision(5)}</strong> kJ/kg</div>
                                <div>q_in = <strong>{result.qin.toPrecision(5)}</strong> kJ/kg</div>
                                <div>BWR = <strong>{result.bwr.toPrecision(3)}%</strong></div>
                                {result.Wdot_net && <div>·∫Ü_net = <strong>{result.Wdot_net.toPrecision(5)}</strong> kW</div>}
                                {result.steamRate && <div>Steam rate = <strong>{result.steamRate.toPrecision(4)}</strong> kg/kWh</div>}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Pump Work Calculator
        const PumpWork = () => {
            const [inputs, setInputs] = useState({ v: '0.001', P1: '', P2: '', eta: '100' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const v = parseFloat(inputs.v), P1 = parseFloat(inputs.P1), P2 = parseFloat(inputs.P2);
                const eta = parseFloat(inputs.eta) / 100;
                
                if (!isNaN(v) && !isNaN(P1) && !isNaN(P2) && !isNaN(eta) && inputs.P1 && inputs.P2) {
                    const wpump_ideal = v * (P2 - P1);
                    const wpump_actual = wpump_ideal / eta;
                    const h4 = parseFloat(inputs.h3) + wpump_actual;
                    setResult({ wpump_ideal, wpump_actual, dh: wpump_actual });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üîß Pump Work</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        w_pump = v(P‚ÇÇ - P‚ÇÅ) / Œ∑
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">v (m¬≥/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.v}
                                onChange={(e) => setInputs({...inputs, v: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0.001 for water" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÅ condenser (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P1}
                                onChange={(e) => setInputs({...inputs, P1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Low pressure" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÇ boiler (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P2}
                                onChange={(e) => setInputs({...inputs, P2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="High pressure" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Œ∑_pump (%)</label>
                            <input type="text" inputMode="decimal" value={inputs.eta}
                                onChange={(e) => setInputs({...inputs, eta: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="100" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Results:</div>
                            <div>w_pump,ideal = <strong>{result.wpump_ideal.toPrecision(5)}</strong> kJ/kg</div>
                            <div>w_pump,actual = <strong>{result.wpump_actual.toPrecision(5)}</strong> kJ/kg</div>
                            <div className="text-xs text-gray-500 mt-2">Œîh = h‚ÇÑ - h‚ÇÉ ‚âà w_pump,actual</div>
                        </div>
                    )}
                </div>
            );
        };

        // Rankine with Reheat
        const RankineReheat = () => {
            const [inputs, setInputs] = useState({ h1: '', h2: '', h3: '', h4: '', h5: '', h6: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const h1 = parseFloat(inputs.h1), h2 = parseFloat(inputs.h2), h3 = parseFloat(inputs.h3);
                const h4 = parseFloat(inputs.h4), h5 = parseFloat(inputs.h5), h6 = parseFloat(inputs.h6);
                
                if (!isNaN(h1) && !isNaN(h2) && !isNaN(h3) && !isNaN(h4) && !isNaN(h5) && !isNaN(h6)) {
                    const wturb_hp = h1 - h2;
                    const wturb_lp = h3 - h4;
                    const wturb_total = wturb_hp + wturb_lp;
                    const wpump = h6 - h5;
                    const wnet = wturb_total - wpump;
                    const qin = (h1 - h6) + (h3 - h2);
                    const eta = wnet / qin * 100;
                    
                    setResult({ wturb_hp, wturb_lp, wturb_total, wpump, wnet, qin, eta });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üîÑ Rankine with Reheat</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        q_in = (h‚ÇÅ-h‚ÇÜ) + (h‚ÇÉ-h‚ÇÇ) | w_turb = (h‚ÇÅ-h‚ÇÇ) + (h‚ÇÉ-h‚ÇÑ)
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° 1=HP turb in, 2=HP turb out/reheat in, 3=reheat out/LP turb in, 4=LP turb out, 5=pump in, 6=pump out
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÅ HP turb in (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h1}
                                onChange={(e) => setInputs({...inputs, h1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÇ HP turb out (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h2}
                                onChange={(e) => setInputs({...inputs, h2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÉ LP turb in (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h3}
                                onChange={(e) => setInputs({...inputs, h3: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÑ LP turb out (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h4}
                                onChange={(e) => setInputs({...inputs, h4: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÖ pump in (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h5}
                                onChange={(e) => setInputs({...inputs, h5: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÜ pump out (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h6}
                                onChange={(e) => setInputs({...inputs, h6: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Results:</div>
                            <div className="grid grid-cols-2 gap-2 text-sm">
                                <div>Œ∑_thermal = <strong>{result.eta.toPrecision(4)}%</strong></div>
                                <div>w_turb,HP = <strong>{result.wturb_hp.toPrecision(5)}</strong> kJ/kg</div>
                                <div>w_turb,LP = <strong>{result.wturb_lp.toPrecision(5)}</strong> kJ/kg</div>
                                <div>w_net = <strong>{result.wnet.toPrecision(5)}</strong> kJ/kg</div>
                                <div>q_in = <strong>{result.qin.toPrecision(5)}</strong> kJ/kg</div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Feedwater Heater (Open)
        const FeedwaterHeater = () => {
            const [type, setType] = useState('open');
            const [inputs, setInputs] = useState({ h_ext: '', h_fw_in: '', h_fw_out: '', y: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const h_ext = parseFloat(inputs.h_ext), h_fw_in = parseFloat(inputs.h_fw_in);
                const h_fw_out = parseFloat(inputs.h_fw_out), y = parseFloat(inputs.y);
                
                // Energy balance: y*h_ext + (1-y)*h_fw_in = h_fw_out
                // y = (h_fw_out - h_fw_in) / (h_ext - h_fw_in)
                
                let calc = {};
                
                if (inputs.y === '' && !isNaN(h_ext) && !isNaN(h_fw_in) && !isNaN(h_fw_out) && (h_ext - h_fw_in) !== 0) {
                    calc.y = (h_fw_out - h_fw_in) / (h_ext - h_fw_in);
                }
                if (inputs.h_fw_out === '' && !isNaN(h_ext) && !isNaN(h_fw_in) && !isNaN(y)) {
                    calc.h_fw_out = y * h_ext + (1 - y) * h_fw_in;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs, type]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üí® Feedwater Heater</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        y¬∑h_extraction + (1-y)¬∑h_fw,in = h_fw,out
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° y = extraction fraction (mass extracted / total mass)
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h_extraction (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h_ext}
                                onChange={(e) => setInputs({...inputs, h_ext: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="From turbine" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h_fw,in (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h_fw_in}
                                onChange={(e) => setInputs({...inputs, h_fw_in: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Feedwater inlet" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h_fw,out (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h_fw_out}
                                onChange={(e) => setInputs({...inputs, h_fw_out: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Leave empty to calc" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">y (extraction fraction)</label>
                            <input type="text" inputMode="decimal" value={inputs.y}
                                onChange={(e) => setInputs({...inputs, y: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Leave empty to calc" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.y !== undefined && <div>y = <strong>{result.y.toPrecision(4)}</strong> ({(result.y*100).toPrecision(3)}% extracted)</div>}
                            {result.h_fw_out !== undefined && <div>h_fw,out = <strong>{result.h_fw_out.toPrecision(5)}</strong> kJ/kg</div>}
                        </div>
                    )}
                </div>
            );
        };

        // Steam Quality at Turbine Exit
        const TurbineExitQuality = () => {
            const [inputs, setInputs] = useState({ h2: '', hf: '', hfg: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const h2 = parseFloat(inputs.h2), hf = parseFloat(inputs.hf), hfg = parseFloat(inputs.hfg);
                
                if (!isNaN(h2) && !isNaN(hf) && !isNaN(hfg) && hfg !== 0 && inputs.h2 && inputs.hf && inputs.hfg) {
                    const x = (h2 - hf) / hfg;
                    let status = '';
                    if (x < 0) status = 'Subcooled liquid';
                    else if (x >= 0 && x < 0.88) status = '‚ö†Ô∏è Low quality - turbine blade erosion risk!';
                    else if (x >= 0.88 && x <= 1) status = '‚úì Acceptable quality';
                    else status = 'Superheated vapor';
                    
                    setResult({ x: x * 100, status });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üíß Turbine Exit Quality</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        x = (h‚ÇÇ - h_f) / h_fg
                    </div>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÇ turbine exit (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h2}
                                onChange={(e) => setInputs({...inputs, h2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Exit enthalpy" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h_f at P‚ÇÇ (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.hf}
                                onChange={(e) => setInputs({...inputs, hf: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Sat liquid" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h_fg at P‚ÇÇ (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.hfg}
                                onChange={(e) => setInputs({...inputs, hfg: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Evaporation" />
                        </div>
                    </div>
                    {result && (
                        <div className={`p-4 rounded-lg border ${result.x >= 88 ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'}`}>
                            <div className="text-sm font-medium mb-2">Turbine Exit Quality:</div>
                            <div className="text-lg">x = <strong>{result.x.toPrecision(4)}%</strong></div>
                            <div className="text-sm mt-2">{result.status}</div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Design target:</strong> x ‚â• 88% at turbine exit to prevent blade erosion from water droplets
                    </div>
                </div>
            );
        };

        // ==================== CHAPTER 11: REFRIGERATION CYCLES ====================

        // Vapor Compression Refrigeration
        const VaporCompression = () => {
            const [inputs, setInputs] = useState({ h1: '', h2: '', h3: '', h4: '', mdot: '', Qdot_L: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const h1 = parseFloat(inputs.h1), h2 = parseFloat(inputs.h2);
                const h3 = parseFloat(inputs.h3), h4 = parseFloat(inputs.h4);
                const mdot = parseFloat(inputs.mdot), Qdot_L = parseFloat(inputs.Qdot_L);
                
                if (!isNaN(h1) && !isNaN(h2) && !isNaN(h3) && !isNaN(h4) && inputs.h1 && inputs.h2 && inputs.h3 && inputs.h4) {
                    const wcomp = h2 - h1;
                    const qL = h1 - h4;
                    const qH = h2 - h3;
                    const COP_R = qL / wcomp;
                    const COP_HP = qH / wcomp;
                    
                    let calc = { wcomp, qL, qH, COP_R, COP_HP };
                    
                    if (!isNaN(mdot) && inputs.mdot) {
                        calc.Wdot = wcomp * mdot;
                        calc.Qdot_L = qL * mdot;
                        calc.Qdot_H = qH * mdot;
                        calc.tons = calc.Qdot_L / 3.517;
                    }
                    
                    if (!isNaN(Qdot_L) && inputs.Qdot_L && qL !== 0) {
                        calc.mdot_calc = Qdot_L / qL;
                        calc.Wdot = wcomp * calc.mdot_calc;
                    }
                    
                    setResult(calc);
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚ùÑÔ∏è Vapor Compression Refrigeration</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        COP_R = q_L / w_comp = (h‚ÇÅ-h‚ÇÑ) / (h‚ÇÇ-h‚ÇÅ)
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° States: 1=compressor in (sat vapor), 2=compressor out, 3=condenser out (sat liquid), 4=evaporator in (h‚ÇÑ=h‚ÇÉ)
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÅ comp in (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h1}
                                onChange={(e) => setInputs({...inputs, h1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Sat vapor @ P_evap" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÇ comp out (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h2}
                                onChange={(e) => setInputs({...inputs, h2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Superheated @ P_cond" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÉ cond out (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h3}
                                onChange={(e) => setInputs({...inputs, h3: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Sat liquid @ P_cond" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÑ evap in (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h4}
                                onChange={(e) => setInputs({...inputs, h4: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="= h‚ÇÉ (throttling)" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">·πÅ (kg/s)</label>
                            <input type="text" inputMode="decimal" value={inputs.mdot}
                                onChange={(e) => setInputs({...inputs, mdot: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Optional" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">or QÃá_L (kW)</label>
                            <input type="text" inputMode="decimal" value={inputs.Qdot_L}
                                onChange={(e) => setInputs({...inputs, Qdot_L: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Cooling capacity" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Results:</div>
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
                                <div>COP_R = <strong>{result.COP_R.toPrecision(4)}</strong></div>
                                <div>COP_HP = <strong>{result.COP_HP.toPrecision(4)}</strong></div>
                                <div>w_comp = <strong>{result.wcomp.toPrecision(5)}</strong> kJ/kg</div>
                                <div>q_L = <strong>{result.qL.toPrecision(5)}</strong> kJ/kg</div>
                                <div>q_H = <strong>{result.qH.toPrecision(5)}</strong> kJ/kg</div>
                                {result.Wdot && <div>·∫Ü_comp = <strong>{result.Wdot.toPrecision(5)}</strong> kW</div>}
                                {result.mdot_calc && <div>·πÅ = <strong>{result.mdot_calc.toPrecision(4)}</strong> kg/s</div>}
                                {result.tons && <div>Capacity = <strong>{result.tons.toPrecision(4)}</strong> tons</div>}
                            </div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Note:</strong> 1 ton of refrigeration = 3.517 kW = 12,000 BTU/hr
                    </div>
                </div>
            );
        };

        // Refrigeration with Isentropic Efficiency
        const RefrigerationEfficiency = () => {
            const [inputs, setInputs] = useState({ h1: '', h2s: '', eta_c: '80', COP_ideal: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const h1 = parseFloat(inputs.h1), h2s = parseFloat(inputs.h2s);
                const eta_c = parseFloat(inputs.eta_c) / 100;
                
                if (!isNaN(h1) && !isNaN(h2s) && !isNaN(eta_c) && eta_c > 0 && inputs.h1 && inputs.h2s) {
                    const wcomp_ideal = h2s - h1;
                    const wcomp_actual = wcomp_ideal / eta_c;
                    const h2_actual = h1 + wcomp_actual;
                    
                    setResult({ wcomp_ideal, wcomp_actual, h2_actual });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚öôÔ∏è Compressor Efficiency</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        w_actual = w_ideal / Œ∑_c = (h‚ÇÇ‚Çõ - h‚ÇÅ) / Œ∑_c
                    </div>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÅ (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h1}
                                onChange={(e) => setInputs({...inputs, h1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Compressor inlet" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h‚ÇÇ‚Çõ isentropic (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.h2s}
                                onChange={(e) => setInputs({...inputs, h2s: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Ideal exit" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Œ∑_compressor (%)</label>
                            <input type="text" inputMode="decimal" value={inputs.eta_c}
                                onChange={(e) => setInputs({...inputs, eta_c: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="80" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Results:</div>
                            <div>w_comp,ideal = <strong>{result.wcomp_ideal.toPrecision(5)}</strong> kJ/kg</div>
                            <div>w_comp,actual = <strong>{result.wcomp_actual.toPrecision(5)}</strong> kJ/kg</div>
                            <div>h‚ÇÇ,actual = <strong>{result.h2_actual.toPrecision(5)}</strong> kJ/kg</div>
                        </div>
                    )}
                </div>
            );
        };

        // Cascade Refrigeration
        const CascadeRefrigeration = () => {
            const [inputs, setInputs] = useState({ qL: '', wA: '', wB: '', qH_A: '', qL_B: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const qL = parseFloat(inputs.qL), wA = parseFloat(inputs.wA), wB = parseFloat(inputs.wB);
                
                if (!isNaN(qL) && !isNaN(wA) && !isNaN(wB) && inputs.qL && inputs.wA && inputs.wB) {
                    const wtotal = wA + wB;
                    const COP = qL / wtotal;
                    
                    setResult({ wtotal, COP });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üîó Cascade Refrigeration</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        COP_cascade = QÃá_L / (·∫Ü_A + ·∫Ü_B)
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° Two cycles: A (low temp) and B (high temp) connected via heat exchanger
                    </div>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">QÃá_L (kW)</label>
                            <input type="text" inputMode="decimal" value={inputs.qL}
                                onChange={(e) => setInputs({...inputs, qL: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Cooling load" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">·∫Ü_A low cycle (kW)</label>
                            <input type="text" inputMode="decimal" value={inputs.wA}
                                onChange={(e) => setInputs({...inputs, wA: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Low temp compressor" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">·∫Ü_B high cycle (kW)</label>
                            <input type="text" inputMode="decimal" value={inputs.wB}
                                onChange={(e) => setInputs({...inputs, wB: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="High temp compressor" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Results:</div>
                            <div>·∫Ü_total = <strong>{result.wtotal.toPrecision(5)}</strong> kW</div>
                            <div>COP_cascade = <strong>{result.COP.toPrecision(4)}</strong></div>
                        </div>
                    )}
                </div>
            );
        };

        // Gas Refrigeration (Reversed Brayton)
        const GasRefrigeration = () => {
            const [inputs, setInputs] = useState({ T1: '', T2: '', T3: '', T4: '', cp: '1.005', rp: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const T1 = parseFloat(inputs.T1), T2 = parseFloat(inputs.T2);
                const T3 = parseFloat(inputs.T3), T4 = parseFloat(inputs.T4);
                const cp = parseFloat(inputs.cp), rp = parseFloat(inputs.rp);
                
                if (!isNaN(T1) && !isNaN(T3) && !isNaN(cp)) {
                    let calc = {};
                    
                    if (!isNaN(T2) && !isNaN(T4) && inputs.T1 && inputs.T2 && inputs.T3 && inputs.T4) {
                        const wcomp = cp * (T2 - T1);
                        const wturb = cp * (T3 - T4);
                        const wnet = wcomp - wturb;
                        const qL = cp * (T1 - T4);
                        const COP = qL / wnet;
                        
                        calc = { wcomp, wturb, wnet, qL, COP };
                    }
                    
                    if (!isNaN(rp) && rp > 1 && inputs.rp) {
                        const k = 1.4;
                        const COP_ideal = 1 / (Math.pow(rp, (k-1)/k) - 1);
                        calc.COP_ideal = COP_ideal;
                    }
                    
                    setResult(Object.keys(calc).length > 0 ? calc : null);
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üí® Gas Refrigeration (Reversed Brayton)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        COP = q_L / w_net = c‚Çö(T‚ÇÅ-T‚ÇÑ) / [c‚Çö(T‚ÇÇ-T‚ÇÅ) - c‚Çö(T‚ÇÉ-T‚ÇÑ)]
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÅ comp in (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T1}
                                onChange={(e) => setInputs({...inputs, T1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="After heat absorption" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÇ comp out (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T2}
                                onChange={(e) => setInputs({...inputs, T2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="After compression" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÉ turb in (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T3}
                                onChange={(e) => setInputs({...inputs, T3: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="After heat rejection" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÑ turb out (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T4}
                                onChange={(e) => setInputs({...inputs, T4: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Coldest point" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">c‚Çö (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.cp}
                                onChange={(e) => setInputs({...inputs, cp: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="1.005" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">r_p (for ideal COP)</label>
                            <input type="text" inputMode="decimal" value={inputs.rp}
                                onChange={(e) => setInputs({...inputs, rp: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Pressure ratio" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Results:</div>
                            <div className="grid grid-cols-2 gap-2 text-sm">
                                {result.COP && <div>COP = <strong>{result.COP.toPrecision(4)}</strong></div>}
                                {result.COP_ideal && <div>COP_ideal = <strong>{result.COP_ideal.toPrecision(4)}</strong></div>}
                                {result.wcomp && <div>w_comp = <strong>{result.wcomp.toPrecision(5)}</strong> kJ/kg</div>}
                                {result.wturb && <div>w_turb = <strong>{result.wturb.toPrecision(5)}</strong> kJ/kg</div>}
                                {result.wnet && <div>w_net = <strong>{result.wnet.toPrecision(5)}</strong> kJ/kg</div>}
                                {result.qL && <div>q_L = <strong>{result.qL.toPrecision(5)}</strong> kJ/kg</div>}
                            </div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Application:</strong> Aircraft cabin cooling, cryogenic applications
                    </div>
                </div>
            );
        };

        // Absorption Refrigeration
        const AbsorptionRefrigeration = () => {
            const [inputs, setInputs] = useState({ Qdot_L: '', Qdot_gen: '', Wdot_pump: '0' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const Qdot_L = parseFloat(inputs.Qdot_L), Qdot_gen = parseFloat(inputs.Qdot_gen);
                const Wdot_pump = parseFloat(inputs.Wdot_pump) || 0;
                
                if (!isNaN(Qdot_L) && !isNaN(Qdot_gen) && Qdot_gen > 0 && inputs.Qdot_L && inputs.Qdot_gen) {
                    const COP = Qdot_L / (Qdot_gen + Wdot_pump);
                    setResult({ COP });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üî• Absorption Refrigeration</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        COP = QÃá_L / (QÃá_gen + ·∫Ü_pump)
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° Uses heat input instead of compressor work. Common: NH‚ÇÉ-water, LiBr-water systems
                    </div>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">QÃá_L cooling (kW)</label>
                            <input type="text" inputMode="decimal" value={inputs.Qdot_L}
                                onChange={(e) => setInputs({...inputs, Qdot_L: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Cooling capacity" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">QÃá_gen heat input (kW)</label>
                            <input type="text" inputMode="decimal" value={inputs.Qdot_gen}
                                onChange={(e) => setInputs({...inputs, Qdot_gen: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Generator heat" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">·∫Ü_pump (kW)</label>
                            <input type="text" inputMode="decimal" value={inputs.Wdot_pump}
                                onChange={(e) => setInputs({...inputs, Wdot_pump: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Usually small" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            <div>COP = <strong>{result.COP.toPrecision(4)}</strong></div>
                            <div className="text-xs text-gray-500 mt-2">Typical absorption COP: 0.6-1.2</div>
                        </div>
                    )}
                </div>
            );
        };

        // ==================== CHAPTER 12: THERMODYNAMIC RELATIONS ====================

        // Maxwell Relations Reference
        const MaxwellRelations = () => {
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìê Maxwell Relations</h3>
                    <div className="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-800">
                        üí° These relations connect measurable properties to those difficult to measure directly
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="p-4 bg-gray-50 rounded-lg">
                            <div className="font-mono text-center mb-2">(‚àÇT/‚àÇv)_s = -(‚àÇP/‚àÇs)_v</div>
                            <div className="text-xs text-gray-500 text-center">From du = Tds - Pdv</div>
                        </div>
                        <div className="p-4 bg-gray-50 rounded-lg">
                            <div className="font-mono text-center mb-2">(‚àÇT/‚àÇP)_s = (‚àÇv/‚àÇs)_P</div>
                            <div className="text-xs text-gray-500 text-center">From dh = Tds + vdP</div>
                        </div>
                        <div className="p-4 bg-gray-50 rounded-lg">
                            <div className="font-mono text-center mb-2">(‚àÇs/‚àÇv)_T = (‚àÇP/‚àÇT)_v</div>
                            <div className="text-xs text-gray-500 text-center">From da = -sdT - Pdv</div>
                        </div>
                        <div className="p-4 bg-gray-50 rounded-lg">
                            <div className="font-mono text-center mb-2">(‚àÇs/‚àÇP)_T = -(‚àÇv/‚àÇT)_P</div>
                            <div className="text-xs text-gray-500 text-center">From dg = -sdT + vdP</div>
                        </div>
                    </div>
                    <div className="mt-4 p-4 bg-amber-50 rounded-lg border border-amber-200">
                        <div className="text-sm font-medium text-amber-800 mb-2">Thermodynamic Potentials:</div>
                        <div className="grid grid-cols-2 gap-2 text-sm font-mono">
                            <div>u = internal energy</div>
                            <div>h = u + Pv (enthalpy)</div>
                            <div>a = u - Ts (Helmholtz)</div>
                            <div>g = h - Ts (Gibbs)</div>
                        </div>
                    </div>
                </div>
            );
        };

        // Clapeyron Equation
        const ClapeyronEquation = () => {
            const [inputs, setInputs] = useState({ hfg: '', T: '', vfg: '', dPdT: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const hfg = parseFloat(inputs.hfg), T = parseFloat(inputs.T);
                const vfg = parseFloat(inputs.vfg), dPdT = parseFloat(inputs.dPdT);
                let calc = {};
                
                // dP/dT = hfg / (T * vfg)
                if (inputs.dPdT === '' && !isNaN(hfg) && !isNaN(T) && !isNaN(vfg) && T > 0 && vfg !== 0) {
                    calc.dPdT = hfg / (T * vfg);
                }
                if (inputs.hfg === '' && !isNaN(dPdT) && !isNaN(T) && !isNaN(vfg)) {
                    calc.hfg = dPdT * T * vfg;
                }
                if (inputs.vfg === '' && !isNaN(hfg) && !isNaN(T) && !isNaN(dPdT) && T > 0 && dPdT !== 0) {
                    calc.vfg = hfg / (T * dPdT);
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìà Clapeyron Equation</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        (dP/dT)_sat = h_fg / (T ¬∑ v_fg)
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° Relates saturation pressure-temperature slope to phase change properties
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h_fg (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.hfg}
                                onChange={(e) => setInputs({...inputs, hfg: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Enthalpy of vaporization" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T}
                                onChange={(e) => setInputs({...inputs, T: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Saturation temp" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">v_fg (m¬≥/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.vfg}
                                onChange={(e) => setInputs({...inputs, vfg: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="v_g - v_f" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">dP/dT (kPa/K)</label>
                            <input type="text" inputMode="decimal" value={inputs.dPdT}
                                onChange={(e) => setInputs({...inputs, dPdT: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Slope of sat curve" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.dPdT !== undefined && <div>dP/dT = <strong>{result.dPdT.toPrecision(6)}</strong> kPa/K</div>}
                            {result.hfg !== undefined && <div>h_fg = <strong>{result.hfg.toPrecision(6)}</strong> kJ/kg</div>}
                            {result.vfg !== undefined && <div>v_fg = <strong>{result.vfg.toPrecision(6)}</strong> m¬≥/kg</div>}
                        </div>
                    )}
                </div>
            );
        };

        // Clausius-Clapeyron (Approximate)
        const ClausiusClapeyron = () => {
            const [inputs, setInputs] = useState({ P1: '', P2: '', T1: '', T2: '', hfg: '', R: '0.4615' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const P1 = parseFloat(inputs.P1), P2 = parseFloat(inputs.P2);
                const T1 = parseFloat(inputs.T1), T2 = parseFloat(inputs.T2);
                const hfg = parseFloat(inputs.hfg), R = parseFloat(inputs.R);
                
                // ln(P2/P1) = (hfg/R) * (1/T1 - 1/T2)
                let calc = {};
                
                if (inputs.P2 === '' && !isNaN(P1) && !isNaN(T1) && !isNaN(T2) && !isNaN(hfg) && !isNaN(R) && T1 > 0 && T2 > 0) {
                    const lnRatio = (hfg / R) * (1/T1 - 1/T2);
                    calc.P2 = P1 * Math.exp(lnRatio);
                }
                if (inputs.T2 === '' && !isNaN(P1) && !isNaN(P2) && !isNaN(T1) && !isNaN(hfg) && !isNaN(R) && P1 > 0 && P2 > 0) {
                    const lnRatio = Math.log(P2 / P1);
                    calc.T2 = 1 / (1/T1 - lnRatio * R / hfg);
                }
                if (inputs.hfg === '' && !isNaN(P1) && !isNaN(P2) && !isNaN(T1) && !isNaN(T2) && !isNaN(R) && P1 > 0 && P2 > 0) {
                    calc.hfg = R * Math.log(P2/P1) / (1/T1 - 1/T2);
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìä Clausius-Clapeyron (Approximate)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        ln(P‚ÇÇ/P‚ÇÅ) = (h_fg/R) √ó (1/T‚ÇÅ - 1/T‚ÇÇ)
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° Valid when v_g &gt;&gt; v_f and vapor behaves as ideal gas
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÅ (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P1}
                                onChange={(e) => setInputs({...inputs, P1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Initial pressure" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P‚ÇÇ (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P2}
                                onChange={(e) => setInputs({...inputs, P2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Final pressure" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÅ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T1}
                                onChange={(e) => setInputs({...inputs, T1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Initial temp" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÇ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T2}
                                onChange={(e) => setInputs({...inputs, T2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Final temp" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">h_fg (kJ/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.hfg}
                                onChange={(e) => setInputs({...inputs, hfg: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Latent heat" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">R (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.R}
                                onChange={(e) => setInputs({...inputs, R: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0.4615 for water" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.P2 !== undefined && <div>P‚ÇÇ = <strong>{result.P2.toPrecision(6)}</strong> kPa</div>}
                            {result.T2 !== undefined && <div>T‚ÇÇ = <strong>{result.T2.toPrecision(6)}</strong> K</div>}
                            {result.hfg !== undefined && <div>h_fg = <strong>{result.hfg.toPrecision(6)}</strong> kJ/kg</div>}
                        </div>
                    )}
                </div>
            );
        };

        // Joule-Thomson Coefficient
        const JouleThomson = () => {
            const [inputs, setInputs] = useState({ cp: '', T: '', v: '', beta: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const cp = parseFloat(inputs.cp), T = parseFloat(inputs.T);
                const v = parseFloat(inputs.v), beta = parseFloat(inputs.beta);
                
                // Œº_JT = (1/cp) * [T*v*Œ≤ - v] = (v/cp) * [T*Œ≤ - 1]
                if (!isNaN(cp) && !isNaN(T) && !isNaN(v) && !isNaN(beta) && cp > 0) {
                    const mu_JT = (v / cp) * (T * beta - 1);
                    const effect = mu_JT > 0 ? 'Cooling on expansion' : mu_JT < 0 ? 'Heating on expansion' : 'No temperature change';
                    setResult({ mu_JT, effect });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üå°Ô∏è Joule-Thomson Coefficient</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        Œº_JT = (‚àÇT/‚àÇP)_h = (v/c‚Çö)(TŒ≤ - 1)
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° Œ≤ = (1/v)(‚àÇv/‚àÇT)_P is the volume expansivity. For ideal gas, Œº_JT = 0
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">c‚Çö (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.cp}
                                onChange={(e) => setInputs({...inputs, cp: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Specific heat" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T}
                                onChange={(e) => setInputs({...inputs, T: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Temperature" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">v (m¬≥/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.v}
                                onChange={(e) => setInputs({...inputs, v: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Specific volume" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Œ≤ (1/K)</label>
                            <input type="text" inputMode="decimal" value={inputs.beta}
                                onChange={(e) => setInputs({...inputs, beta: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Volume expansivity" />
                        </div>
                    </div>
                    {result && (
                        <div className={`p-4 rounded-lg border ${result.mu_JT > 0 ? 'bg-blue-50 border-blue-200' : 'bg-orange-50 border-orange-200'}`}>
                            <div className="text-sm font-medium mb-2">Result:</div>
                            <div>Œº_JT = <strong>{result.mu_JT.toPrecision(6)}</strong> K/kPa</div>
                            <div className="text-sm mt-2">{result.effect}</div>
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Application:</strong> Gas liquefaction - throttling reduces temperature when Œº_JT &gt; 0
                    </div>
                </div>
            );
        };

        // Compressibility Factor
        const CompressibilityFactor = () => {
            const [mode, setMode] = useState('calculate');
            const [inputs, setInputs] = useState({ P: '', v: '', T: '', R: '0.287', Z: '', Pr: '', Tr: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const P = parseFloat(inputs.P), v = parseFloat(inputs.v), T = parseFloat(inputs.T);
                const R = parseFloat(inputs.R), Z = parseFloat(inputs.Z);
                const Pr = parseFloat(inputs.Pr), Tr = parseFloat(inputs.Tr);
                
                let calc = {};
                
                if (mode === 'calculate') {
                    // Z = Pv / RT
                    if (!isNaN(P) && !isNaN(v) && !isNaN(T) && !isNaN(R) && T > 0) {
                        calc.Z = (P * v) / (R * T);
                        calc.deviation = (calc.Z - 1) * 100;
                    }
                } else if (mode === 'findV') {
                    // v = ZRT / P
                    if (!isNaN(Z) && !isNaN(R) && !isNaN(T) && !isNaN(P) && P > 0) {
                        calc.v = (Z * R * T) / P;
                        calc.v_ideal = (R * T) / P;
                    }
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs, mode]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üî¢ Compressibility Factor (Z)</h3>
                    <div className="flex gap-2 mb-4">
                        <button onClick={() => setMode('calculate')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${mode === 'calculate' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Calculate Z
                        </button>
                        <button onClick={() => setMode('findV')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${mode === 'findV' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Find v from Z
                        </button>
                    </div>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        {mode === 'calculate' ? 'Z = Pv / RT' : 'v = ZRT / P'}
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P}
                                onChange={(e) => setInputs({...inputs, P: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Pressure" />
                        </div>
                        {mode === 'calculate' && (
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">v (m¬≥/kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.v}
                                    onChange={(e) => setInputs({...inputs, v: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Specific volume" />
                            </div>
                        )}
                        {mode === 'findV' && (
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">Z</label>
                                <input type="text" inputMode="decimal" value={inputs.Z}
                                    onChange={(e) => setInputs({...inputs, Z: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="From chart/table" />
                            </div>
                        )}
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T}
                                onChange={(e) => setInputs({...inputs, T: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Temperature" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">R (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.R}
                                onChange={(e) => setInputs({...inputs, R: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0.287 for air" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.Z !== undefined && <>
                                <div>Z = <strong>{result.Z.toPrecision(5)}</strong></div>
                                <div className="text-sm text-gray-500 mt-1">
                                    Deviation from ideal: {result.deviation.toPrecision(3)}% 
                                    {Math.abs(result.deviation) < 1 ? ' (ideal gas assumption valid)' : ''}
                                </div>
                            </>}
                            {result.v !== undefined && <>
                                <div>v_actual = <strong>{result.v.toPrecision(6)}</strong> m¬≥/kg</div>
                                <div>v_ideal = <strong>{result.v_ideal.toPrecision(6)}</strong> m¬≥/kg</div>
                            </>}
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Note:</strong> Z = 1 for ideal gas. Use reduced properties P_r = P/P_cr and T_r = T/T_cr with generalized charts.
                    </div>
                </div>
            );
        };

        // Reduced Properties
        const ReducedProperties = () => {
            const [inputs, setInputs] = useState({ P: '', Pcr: '', T: '', Tcr: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const P = parseFloat(inputs.P), Pcr = parseFloat(inputs.Pcr);
                const T = parseFloat(inputs.T), Tcr = parseFloat(inputs.Tcr);
                
                let calc = {};
                
                if (!isNaN(P) && !isNaN(Pcr) && Pcr > 0 && inputs.P && inputs.Pcr) {
                    calc.Pr = P / Pcr;
                }
                if (!isNaN(T) && !isNaN(Tcr) && Tcr > 0 && inputs.T && inputs.Tcr) {
                    calc.Tr = T / Tcr;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìâ Reduced Properties</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        P_r = P / P_cr &nbsp;|&nbsp; T_r = T / T_cr
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P}
                                onChange={(e) => setInputs({...inputs, P: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Actual pressure" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P_cr (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.Pcr}
                                onChange={(e) => setInputs({...inputs, Pcr: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Critical pressure" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T}
                                onChange={(e) => setInputs({...inputs, T: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Actual temp" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T_cr (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.Tcr}
                                onChange={(e) => setInputs({...inputs, Tcr: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Critical temp" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Reduced Properties:</div>
                            {result.Pr !== undefined && <div>P_r = <strong>{result.Pr.toPrecision(4)}</strong></div>}
                            {result.Tr !== undefined && <div>T_r = <strong>{result.Tr.toPrecision(4)}</strong></div>}
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Common Critical Values:</strong><br/>
                        Water: P_cr = 22,064 kPa, T_cr = 647.1 K<br/>
                        Air: P_cr = 3,769 kPa, T_cr = 132.5 K<br/>
                        CO‚ÇÇ: P_cr = 7,377 kPa, T_cr = 304.1 K
                    </div>
                </div>
            );
        };

        // ==================== CHAPTER 13: GAS MIXTURES ====================

        // Mass and Mole Fractions
        const MassMoleFractions = () => {
            const [inputs, setInputs] = useState({ m1: '', m2: '', m3: '', M1: '28.97', M2: '44.01', M3: '18.02' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const m1 = parseFloat(inputs.m1), m2 = parseFloat(inputs.m2), m3 = parseFloat(inputs.m3) || 0;
                const M1 = parseFloat(inputs.M1), M2 = parseFloat(inputs.M2), M3 = parseFloat(inputs.M3) || 1;
                
                if (!isNaN(m1) && !isNaN(m2) && !isNaN(M1) && !isNaN(M2) && inputs.m1 && inputs.m2) {
                    const m_total = m1 + m2 + m3;
                    const mf1 = m1 / m_total;
                    const mf2 = m2 / m_total;
                    const mf3 = m3 / m_total;
                    
                    const n1 = m1 / M1;
                    const n2 = m2 / M2;
                    const n3 = m3 > 0 ? m3 / M3 : 0;
                    const n_total = n1 + n2 + n3;
                    
                    const y1 = n1 / n_total;
                    const y2 = n2 / n_total;
                    const y3 = n3 / n_total;
                    
                    const M_mix = m_total / n_total;
                    const R_mix = 8.314 / M_mix;
                    
                    setResult({ mf1, mf2, mf3, y1, y2, y3, n_total, m_total, M_mix, R_mix });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚öñÔ∏è Mass & Mole Fractions</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        mf_i = m_i/m_total | y_i = n_i/n_total | n_i = m_i/M_i
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">m‚ÇÅ (kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.m1}
                                onChange={(e) => setInputs({...inputs, m1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mass of gas 1" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">M‚ÇÅ (kg/kmol)</label>
                            <input type="text" inputMode="decimal" value={inputs.M1}
                                onChange={(e) => setInputs({...inputs, M1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="28.97 (air)" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">m‚ÇÇ (kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.m2}
                                onChange={(e) => setInputs({...inputs, m2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mass of gas 2" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">M‚ÇÇ (kg/kmol)</label>
                            <input type="text" inputMode="decimal" value={inputs.M2}
                                onChange={(e) => setInputs({...inputs, M2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="44.01 (CO‚ÇÇ)" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">m‚ÇÉ (kg) - optional</label>
                            <input type="text" inputMode="decimal" value={inputs.m3}
                                onChange={(e) => setInputs({...inputs, m3: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mass of gas 3" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">M‚ÇÉ (kg/kmol)</label>
                            <input type="text" inputMode="decimal" value={inputs.M3}
                                onChange={(e) => setInputs({...inputs, M3: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="18.02 (H‚ÇÇO)" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Results:</div>
                            <div className="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <div className="font-medium mb-1">Mass Fractions:</div>
                                    <div>mf‚ÇÅ = {(result.mf1 * 100).toPrecision(4)}%</div>
                                    <div>mf‚ÇÇ = {(result.mf2 * 100).toPrecision(4)}%</div>
                                    {result.mf3 > 0 && <div>mf‚ÇÉ = {(result.mf3 * 100).toPrecision(4)}%</div>}
                                </div>
                                <div>
                                    <div className="font-medium mb-1">Mole Fractions:</div>
                                    <div>y‚ÇÅ = {(result.y1 * 100).toPrecision(4)}%</div>
                                    <div>y‚ÇÇ = {(result.y2 * 100).toPrecision(4)}%</div>
                                    {result.y3 > 0 && <div>y‚ÇÉ = {(result.y3 * 100).toPrecision(4)}%</div>}
                                </div>
                            </div>
                            <div className="mt-3 pt-3 border-t border-green-200">
                                <div>M_mix = <strong>{result.M_mix.toPrecision(5)}</strong> kg/kmol</div>
                                <div>R_mix = <strong>{result.R_mix.toPrecision(5)}</strong> kJ/kg¬∑K</div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Dalton's Law - Partial Pressures
        const DaltonLaw = () => {
            const [inputs, setInputs] = useState({ P_total: '', y1: '', y2: '', y3: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const P = parseFloat(inputs.P_total);
                const y1 = parseFloat(inputs.y1) / 100, y2 = parseFloat(inputs.y2) / 100;
                const y3 = parseFloat(inputs.y3) / 100 || 0;
                
                if (!isNaN(P) && !isNaN(y1) && !isNaN(y2) && inputs.P_total && inputs.y1 && inputs.y2) {
                    const P1 = y1 * P;
                    const P2 = y2 * P;
                    const P3 = y3 * P;
                    const sum = y1 + y2 + y3;
                    
                    setResult({ P1, P2, P3, sum });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìä Dalton's Law (Partial Pressures)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        P_i = y_i √ó P_total | P_total = Œ£ P_i
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P_total (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P_total}
                                onChange={(e) => setInputs({...inputs, P_total: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Total pressure" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">y‚ÇÅ (%)</label>
                            <input type="text" inputMode="decimal" value={inputs.y1}
                                onChange={(e) => setInputs({...inputs, y1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mole fraction 1" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">y‚ÇÇ (%)</label>
                            <input type="text" inputMode="decimal" value={inputs.y2}
                                onChange={(e) => setInputs({...inputs, y2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mole fraction 2" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">y‚ÇÉ (%) - optional</label>
                            <input type="text" inputMode="decimal" value={inputs.y3}
                                onChange={(e) => setInputs({...inputs, y3: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mole fraction 3" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Partial Pressures:</div>
                            <div>P‚ÇÅ = <strong>{result.P1.toPrecision(5)}</strong> kPa</div>
                            <div>P‚ÇÇ = <strong>{result.P2.toPrecision(5)}</strong> kPa</div>
                            {result.P3 > 0 && <div>P‚ÇÉ = <strong>{result.P3.toPrecision(5)}</strong> kPa</div>}
                            {Math.abs(result.sum - 1) > 0.001 && (
                                <div className="text-amber-600 text-sm mt-2">‚ö†Ô∏è Mole fractions sum to {(result.sum * 100).toFixed(1)}% (should be 100%)</div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        // Amagat's Law - Partial Volumes
        const AmagatLaw = () => {
            const [inputs, setInputs] = useState({ V_total: '', y1: '', y2: '', y3: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const V = parseFloat(inputs.V_total);
                const y1 = parseFloat(inputs.y1) / 100, y2 = parseFloat(inputs.y2) / 100;
                const y3 = parseFloat(inputs.y3) / 100 || 0;
                
                if (!isNaN(V) && !isNaN(y1) && !isNaN(y2) && inputs.V_total && inputs.y1 && inputs.y2) {
                    const V1 = y1 * V;
                    const V2 = y2 * V;
                    const V3 = y3 * V;
                    
                    setResult({ V1, V2, V3 });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üì¶ Amagat's Law (Partial Volumes)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        V_i = y_i √ó V_total | V_total = Œ£ V_i
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">V_total (m¬≥)</label>
                            <input type="text" inputMode="decimal" value={inputs.V_total}
                                onChange={(e) => setInputs({...inputs, V_total: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Total volume" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">y‚ÇÅ (%)</label>
                            <input type="text" inputMode="decimal" value={inputs.y1}
                                onChange={(e) => setInputs({...inputs, y1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mole fraction 1" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">y‚ÇÇ (%)</label>
                            <input type="text" inputMode="decimal" value={inputs.y2}
                                onChange={(e) => setInputs({...inputs, y2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mole fraction 2" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">y‚ÇÉ (%) - optional</label>
                            <input type="text" inputMode="decimal" value={inputs.y3}
                                onChange={(e) => setInputs({...inputs, y3: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mole fraction 3" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Partial Volumes (at P, T of mixture):</div>
                            <div>V‚ÇÅ = <strong>{result.V1.toPrecision(5)}</strong> m¬≥</div>
                            <div>V‚ÇÇ = <strong>{result.V2.toPrecision(5)}</strong> m¬≥</div>
                            {result.V3 > 0 && <div>V‚ÇÉ = <strong>{result.V3.toPrecision(5)}</strong> m¬≥</div>}
                        </div>
                    )}
                </div>
            );
        };

        // Mixture Specific Heats
        const MixtureSpecificHeats = () => {
            const [basis, setBasis] = useState('mass');
            const [inputs, setInputs] = useState({ f1: '', f2: '', f3: '', cp1: '1.005', cp2: '0.846', cp3: '1.872', cv1: '0.718', cv2: '0.657', cv3: '1.411' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const f1 = parseFloat(inputs.f1) / 100, f2 = parseFloat(inputs.f2) / 100;
                const f3 = parseFloat(inputs.f3) / 100 || 0;
                const cp1 = parseFloat(inputs.cp1), cp2 = parseFloat(inputs.cp2), cp3 = parseFloat(inputs.cp3) || 0;
                const cv1 = parseFloat(inputs.cv1), cv2 = parseFloat(inputs.cv2), cv3 = parseFloat(inputs.cv3) || 0;
                
                if (!isNaN(f1) && !isNaN(f2) && !isNaN(cp1) && !isNaN(cp2) && inputs.f1 && inputs.f2) {
                    const cp_mix = f1 * cp1 + f2 * cp2 + f3 * cp3;
                    const cv_mix = f1 * cv1 + f2 * cv2 + f3 * cv3;
                    const k_mix = cp_mix / cv_mix;
                    
                    setResult({ cp_mix, cv_mix, k_mix });
                } else setResult(null);
            }, [inputs, basis]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üî• Mixture Specific Heats</h3>
                    <div className="flex gap-2 mb-4">
                        <button onClick={() => setBasis('mass')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${basis === 'mass' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Mass Basis (mf)
                        </button>
                        <button onClick={() => setBasis('mole')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${basis === 'mole' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Mole Basis (y)
                        </button>
                    </div>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        {basis === 'mass' ? 'c‚Çö,mix = Œ£ mf·µ¢ √ó c‚Çö,·µ¢' : 'cÃÑ‚Çö,mix = Œ£ y·µ¢ √ó cÃÑ‚Çö,·µ¢'}
                    </div>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">{basis === 'mass' ? 'mf‚ÇÅ' : 'y‚ÇÅ'} (%)</label>
                            <input type="text" inputMode="decimal" value={inputs.f1}
                                onChange={(e) => setInputs({...inputs, f1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Fraction 1" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">c‚Çö‚ÇÅ (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.cp1}
                                onChange={(e) => setInputs({...inputs, cp1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="1.005 (air)" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">c·µ•‚ÇÅ (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.cv1}
                                onChange={(e) => setInputs({...inputs, cv1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0.718" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">{basis === 'mass' ? 'mf‚ÇÇ' : 'y‚ÇÇ'} (%)</label>
                            <input type="text" inputMode="decimal" value={inputs.f2}
                                onChange={(e) => setInputs({...inputs, f2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Fraction 2" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">c‚Çö‚ÇÇ (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.cp2}
                                onChange={(e) => setInputs({...inputs, cp2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0.846 (CO‚ÇÇ)" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">c·µ•‚ÇÇ (kJ/kg¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.cv2}
                                onChange={(e) => setInputs({...inputs, cv2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="0.657" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Mixture Properties:</div>
                            <div>c‚Çö,mix = <strong>{result.cp_mix.toPrecision(5)}</strong> kJ/kg¬∑K</div>
                            <div>c·µ•,mix = <strong>{result.cv_mix.toPrecision(5)}</strong> kJ/kg¬∑K</div>
                            <div>k_mix = <strong>{result.k_mix.toPrecision(4)}</strong></div>
                        </div>
                    )}
                </div>
            );
        };

        // Ideal Gas Mixture - PVT
        const GasMixturePVT = () => {
            const [inputs, setInputs] = useState({ P: '', V: '', T: '', n: '', m: '', M_mix: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const P = parseFloat(inputs.P), V = parseFloat(inputs.V), T = parseFloat(inputs.T);
                const n = parseFloat(inputs.n), m = parseFloat(inputs.m), M_mix = parseFloat(inputs.M_mix);
                const Ru = 8.314;
                let calc = {};
                
                // PV = nRuT or PV = mR_mixT
                if (!isNaN(P) && !isNaN(V) && !isNaN(T) && T > 0 && inputs.P && inputs.V && inputs.T) {
                    calc.n = (P * V) / (Ru * T);
                    if (!isNaN(M_mix) && inputs.M_mix) {
                        calc.m = calc.n * M_mix;
                    }
                }
                if (!isNaN(n) && !isNaN(T) && !isNaN(V) && inputs.n && inputs.T && inputs.V) {
                    calc.P = (n * Ru * T) / V;
                }
                if (!isNaN(n) && !isNaN(T) && !isNaN(P) && inputs.n && inputs.T && inputs.P && P > 0) {
                    calc.V = (n * Ru * T) / P;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üå°Ô∏è Ideal Gas Mixture (PVT)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        PV = nRÃÑ·µ§T | RÃÑ·µ§ = 8.314 kJ/kmol¬∑K
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P}
                                onChange={(e) => setInputs({...inputs, P: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Pressure" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">V (m¬≥)</label>
                            <input type="text" inputMode="decimal" value={inputs.V}
                                onChange={(e) => setInputs({...inputs, V: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Volume" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T}
                                onChange={(e) => setInputs({...inputs, T: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Temperature" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">n (kmol)</label>
                            <input type="text" inputMode="decimal" value={inputs.n}
                                onChange={(e) => setInputs({...inputs, n: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Total moles" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">M_mix (kg/kmol)</label>
                            <input type="text" inputMode="decimal" value={inputs.M_mix}
                                onChange={(e) => setInputs({...inputs, M_mix: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="For mass calc" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.n !== undefined && <div>n = <strong>{result.n.toPrecision(5)}</strong> kmol</div>}
                            {result.m !== undefined && <div>m = <strong>{result.m.toPrecision(5)}</strong> kg</div>}
                            {result.P !== undefined && <div>P = <strong>{result.P.toPrecision(5)}</strong> kPa</div>}
                            {result.V !== undefined && <div>V = <strong>{result.V.toPrecision(5)}</strong> m¬≥</div>}
                        </div>
                    )}
                </div>
            );
        };

        // Common Gas Properties Reference
        const GasPropertiesRef = () => {
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìã Common Gas Properties</h3>
                    <div className="overflow-x-auto">
                        <table className="w-full text-sm">
                            <thead className="bg-gray-100">
                                <tr>
                                    <th className="px-3 py-2 text-left">Gas</th>
                                    <th className="px-3 py-2 text-center">M (kg/kmol)</th>
                                    <th className="px-3 py-2 text-center">R (kJ/kg¬∑K)</th>
                                    <th className="px-3 py-2 text-center">c‚Çö (kJ/kg¬∑K)</th>
                                    <th className="px-3 py-2 text-center">c·µ• (kJ/kg¬∑K)</th>
                                    <th className="px-3 py-2 text-center">k</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y">
                                <tr><td className="px-3 py-2">Air</td><td className="text-center">28.97</td><td className="text-center">0.287</td><td className="text-center">1.005</td><td className="text-center">0.718</td><td className="text-center">1.40</td></tr>
                                <tr className="bg-gray-50"><td className="px-3 py-2">N‚ÇÇ</td><td className="text-center">28.01</td><td className="text-center">0.297</td><td className="text-center">1.040</td><td className="text-center">0.743</td><td className="text-center">1.40</td></tr>
                                <tr><td className="px-3 py-2">O‚ÇÇ</td><td className="text-center">32.00</td><td className="text-center">0.260</td><td className="text-center">0.918</td><td className="text-center">0.658</td><td className="text-center">1.39</td></tr>
                                <tr className="bg-gray-50"><td className="px-3 py-2">CO‚ÇÇ</td><td className="text-center">44.01</td><td className="text-center">0.189</td><td className="text-center">0.846</td><td className="text-center">0.657</td><td className="text-center">1.29</td></tr>
                                <tr><td className="px-3 py-2">H‚ÇÇO (vapor)</td><td className="text-center">18.02</td><td className="text-center">0.462</td><td className="text-center">1.872</td><td className="text-center">1.411</td><td className="text-center">1.33</td></tr>
                                <tr className="bg-gray-50"><td className="px-3 py-2">H‚ÇÇ</td><td className="text-center">2.016</td><td className="text-center">4.124</td><td className="text-center">14.31</td><td className="text-center">10.18</td><td className="text-center">1.41</td></tr>
                                <tr><td className="px-3 py-2">He</td><td className="text-center">4.003</td><td className="text-center">2.077</td><td className="text-center">5.193</td><td className="text-center">3.116</td><td className="text-center">1.67</td></tr>
                                <tr className="bg-gray-50"><td className="px-3 py-2">CH‚ÇÑ</td><td className="text-center">16.04</td><td className="text-center">0.518</td><td className="text-center">2.226</td><td className="text-center">1.708</td><td className="text-center">1.30</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div className="mt-3 text-xs text-gray-500">Values at 300 K, low pressure (ideal gas behavior)</div>
                </div>
            );
        };

        // ==================== CHAPTER 14: PSYCHROMETRICS ====================

        // Humidity Ratio
        const HumidityRatio = () => {
            const [inputs, setInputs] = useState({ Pv: '', P: '101.325', phi: '', Pg: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const Pv = parseFloat(inputs.Pv), P = parseFloat(inputs.P);
                const phi = parseFloat(inputs.phi) / 100, Pg = parseFloat(inputs.Pg);
                let calc = {};
                
                // œâ = 0.622 √ó Pv / (P - Pv)
                if (!isNaN(Pv) && !isNaN(P) && P > Pv && inputs.Pv) {
                    calc.omega = 0.622 * Pv / (P - Pv);
                    calc.omega_gpkg = calc.omega * 1000;
                }
                
                // If œÜ and Pg given, find Pv first
                if (!isNaN(phi) && !isNaN(Pg) && !isNaN(P) && inputs.phi && inputs.Pg) {
                    const Pv_calc = phi * Pg;
                    calc.Pv = Pv_calc;
                    calc.omega = 0.622 * Pv_calc / (P - Pv_calc);
                    calc.omega_gpkg = calc.omega * 1000;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üíß Humidity Ratio (œâ)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        œâ = 0.622 √ó P·µ• / (P - P·µ•) = m·µ• / m‚Çê
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° Enter P·µ• directly, OR enter œÜ and Pg to calculate P·µ• first
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P·µ• vapor pressure (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.Pv}
                                onChange={(e) => setInputs({...inputs, Pv: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Partial pressure of vapor" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P total (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P}
                                onChange={(e) => setInputs({...inputs, P: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="101.325" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">œÜ relative humidity (%)</label>
                            <input type="text" inputMode="decimal" value={inputs.phi}
                                onChange={(e) => setInputs({...inputs, phi: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Alternative input" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Pg sat pressure (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.Pg}
                                onChange={(e) => setInputs({...inputs, Pg: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="@ dry bulb T" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Results:</div>
                            {result.Pv && <div>P·µ• = <strong>{result.Pv.toPrecision(5)}</strong> kPa</div>}
                            <div>œâ = <strong>{result.omega.toPrecision(5)}</strong> kg_water/kg_dry_air</div>
                            <div>œâ = <strong>{result.omega_gpkg.toPrecision(4)}</strong> g/kg_dry_air</div>
                        </div>
                    )}
                </div>
            );
        };

        // Relative Humidity
        const RelativeHumidity = () => {
            const [inputs, setInputs] = useState({ Pv: '', Pg: '', omega: '', P: '101.325' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const Pv = parseFloat(inputs.Pv), Pg = parseFloat(inputs.Pg);
                const omega = parseFloat(inputs.omega), P = parseFloat(inputs.P);
                let calc = {};
                
                // œÜ = Pv / Pg
                if (!isNaN(Pv) && !isNaN(Pg) && Pg > 0 && inputs.Pv && inputs.Pg) {
                    calc.phi = (Pv / Pg) * 100;
                }
                
                // From œâ: Pv = œâP / (0.622 + œâ)
                if (!isNaN(omega) && !isNaN(P) && !isNaN(Pg) && inputs.omega && inputs.Pg) {
                    const Pv_calc = (omega * P) / (0.622 + omega);
                    calc.Pv = Pv_calc;
                    calc.phi = (Pv_calc / Pg) * 100;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üí® Relative Humidity (œÜ)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        œÜ = P·µ• / Pg √ó 100%
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P·µ• vapor pressure (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.Pv}
                                onChange={(e) => setInputs({...inputs, Pv: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Actual vapor pressure" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Pg saturation (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.Pg}
                                onChange={(e) => setInputs({...inputs, Pg: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="@ dry bulb temp" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">or œâ (kg/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.omega}
                                onChange={(e) => setInputs({...inputs, omega: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Humidity ratio" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P total (kPa)</label>
                            <input type="text" inputMode="decimal" value={inputs.P}
                                onChange={(e) => setInputs({...inputs, P: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="101.325" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.Pv && <div>P·µ• = <strong>{result.Pv.toPrecision(5)}</strong> kPa</div>}
                            <div>œÜ = <strong>{result.phi.toPrecision(4)}%</strong></div>
                        </div>
                    )}
                </div>
            );
        };

        // Dew Point Temperature
        const DewPoint = () => {
            const [inputs, setInputs] = useState({ Pv: '', Td: '' });
            const [result, setResult] = useState(null);
            
            // Approximate: Td ‚âà (237.3 √ó ln(Pv/0.6113)) / (17.27 - ln(Pv/0.6113)) for Pv in kPa
            useEffect(() => {
                const Pv = parseFloat(inputs.Pv), Td = parseFloat(inputs.Td);
                let calc = {};
                
                if (!isNaN(Pv) && Pv > 0 && inputs.Pv) {
                    // Magnus formula approximation
                    const lnTerm = Math.log(Pv / 0.6113);
                    calc.Td = (237.3 * lnTerm) / (17.27 - lnTerm);
                    calc.Td_K = calc.Td + 273.15;
                }
                
                if (!isNaN(Td) && inputs.Td) {
                    // Reverse: Pv = 0.6113 √ó exp(17.27 √ó Td / (237.3 + Td))
                    calc.Pv = 0.6113 * Math.exp(17.27 * Td / (237.3 + Td));
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üå°Ô∏è Dew Point Temperature</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        T_dew = T_sat @ P·µ• (temperature at which vapor starts to condense)
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">P·µ• (kPa) ‚Üí find Td</label>
                            <input type="text" inputMode="decimal" value={inputs.Pv}
                                onChange={(e) => setInputs({...inputs, Pv: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Vapor pressure" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Td (¬∞C) ‚Üí find P·µ•</label>
                            <input type="text" inputMode="decimal" value={inputs.Td}
                                onChange={(e) => setInputs({...inputs, Td: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Dew point temp" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.Td !== undefined && <>
                                <div>T_dew = <strong>{result.Td.toPrecision(4)}</strong> ¬∞C</div>
                                <div>T_dew = <strong>{result.Td_K.toPrecision(5)}</strong> K</div>
                            </>}
                            {result.Pv !== undefined && <div>P·µ• = <strong>{result.Pv.toPrecision(5)}</strong> kPa</div>}
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Note:</strong> Uses Magnus approximation. For precise values, use steam tables.
                    </div>
                </div>
            );
        };

        // Enthalpy of Moist Air
        const MoistAirEnthalpy = () => {
            const [inputs, setInputs] = useState({ T: '', omega: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const T = parseFloat(inputs.T), omega = parseFloat(inputs.omega);
                
                // h = cp_a √ó T + œâ √ó (hg + cp_v √ó T)
                // Simplified: h ‚âà 1.005T + œâ(2501 + 1.86T) kJ/kg_dry_air
                if (!isNaN(T) && !isNaN(omega) && inputs.T && inputs.omega) {
                    const h_a = 1.005 * T;
                    const h_v = omega * (2501 + 1.86 * T);
                    const h_total = h_a + h_v;
                    
                    setResult({ h_a, h_v, h_total });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üî• Enthalpy of Moist Air</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        h = 1.005T + œâ(2501 + 1.86T) kJ/kg_dry_air
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T (¬∞C)</label>
                            <input type="text" inputMode="decimal" value={inputs.T}
                                onChange={(e) => setInputs({...inputs, T: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Dry bulb temperature" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">œâ (kg/kg)</label>
                            <input type="text" inputMode="decimal" value={inputs.omega}
                                onChange={(e) => setInputs({...inputs, omega: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Humidity ratio" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Results:</div>
                            <div>h_dry_air = <strong>{result.h_a.toPrecision(5)}</strong> kJ/kg</div>
                            <div>h_vapor = <strong>{result.h_v.toPrecision(5)}</strong> kJ/kg_da</div>
                            <div className="mt-2 pt-2 border-t border-green-200">
                                h_total = <strong>{result.h_total.toPrecision(5)}</strong> kJ/kg_dry_air
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Air Conditioning Process
        const ACProcess = () => {
            const [process, setProcess] = useState('sensible');
            const [inputs, setInputs] = useState({ mdot_a: '', T1: '', T2: '', omega1: '', omega2: '', h1: '', h2: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const mdot_a = parseFloat(inputs.mdot_a);
                const T1 = parseFloat(inputs.T1), T2 = parseFloat(inputs.T2);
                const omega1 = parseFloat(inputs.omega1), omega2 = parseFloat(inputs.omega2);
                let calc = {};
                
                if (process === 'sensible' && !isNaN(mdot_a) && !isNaN(T1) && !isNaN(T2) && !isNaN(omega1)) {
                    // Q = mdot_a √ó cp √ó (T2 - T1), œâ constant
                    const Q = mdot_a * 1.005 * (T2 - T1);
                    calc = { Q, type: Q > 0 ? 'Heating' : 'Cooling' };
                }
                
                if (process === 'humidify' && !isNaN(mdot_a) && !isNaN(omega1) && !isNaN(omega2)) {
                    // mdot_w = mdot_a √ó (œâ2 - œâ1)
                    const mdot_w = mdot_a * (omega2 - omega1);
                    calc = { mdot_w };
                }
                
                if (process === 'cooling_dehumid' && !isNaN(mdot_a) && !isNaN(omega1) && !isNaN(omega2) && !isNaN(T1) && !isNaN(T2)) {
                    const h1 = 1.005 * T1 + omega1 * (2501 + 1.86 * T1);
                    const h2 = 1.005 * T2 + omega2 * (2501 + 1.86 * T2);
                    const hw = 4.18 * T2; // condensate at T2
                    const Q = mdot_a * ((h1 - h2) - (omega1 - omega2) * hw);
                    const mdot_w = mdot_a * (omega1 - omega2);
                    calc = { Q, mdot_w, h1, h2 };
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs, process]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚ùÑÔ∏è Air Conditioning Process</h3>
                    <div className="flex gap-2 mb-4 flex-wrap">
                        <button onClick={() => setProcess('sensible')}
                            className={`px-3 py-2 rounded-lg text-sm font-medium ${process === 'sensible' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Sensible Heat
                        </button>
                        <button onClick={() => setProcess('humidify')}
                            className={`px-3 py-2 rounded-lg text-sm font-medium ${process === 'humidify' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Humidification
                        </button>
                        <button onClick={() => setProcess('cooling_dehumid')}
                            className={`px-3 py-2 rounded-lg text-sm font-medium ${process === 'cooling_dehumid' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Cooling + Dehumid
                        </button>
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">·πÅ_air (kg/s)</label>
                            <input type="text" inputMode="decimal" value={inputs.mdot_a}
                                onChange={(e) => setInputs({...inputs, mdot_a: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Dry air flow" />
                        </div>
                        {(process === 'sensible' || process === 'cooling_dehumid') && <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÅ inlet (¬∞C)</label>
                                <input type="text" inputMode="decimal" value={inputs.T1}
                                    onChange={(e) => setInputs({...inputs, T1: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Inlet temp" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÇ outlet (¬∞C)</label>
                                <input type="text" inputMode="decimal" value={inputs.T2}
                                    onChange={(e) => setInputs({...inputs, T2: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Outlet temp" />
                            </div>
                        </>}
                        {(process === 'humidify' || process === 'cooling_dehumid' || process === 'sensible') && <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">œâ‚ÇÅ inlet (kg/kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.omega1}
                                    onChange={(e) => setInputs({...inputs, omega1: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Inlet humidity" />
                            </div>
                        </>}
                        {(process === 'humidify' || process === 'cooling_dehumid') && <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">œâ‚ÇÇ outlet (kg/kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.omega2}
                                    onChange={(e) => setInputs({...inputs, omega2: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Outlet humidity" />
                            </div>
                        </>}
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Results:</div>
                            {result.Q !== undefined && <div>QÃá = <strong>{Math.abs(result.Q).toPrecision(5)}</strong> kW ({result.type || (result.Q > 0 ? 'added' : 'removed')})</div>}
                            {result.mdot_w !== undefined && <div>·πÅ_water = <strong>{Math.abs(result.mdot_w * 1000).toPrecision(4)}</strong> g/s ({result.mdot_w > 0 ? 'added' : 'condensed'})</div>}
                        </div>
                    )}
                </div>
            );
        };

        // Saturation Pressure Table (Water)
        const SatPressureTable = () => {
            const data = [
                { T: 0, Pg: 0.6113 }, { T: 5, Pg: 0.8721 }, { T: 10, Pg: 1.2276 },
                { T: 15, Pg: 1.7051 }, { T: 20, Pg: 2.339 }, { T: 25, Pg: 3.169 },
                { T: 30, Pg: 4.246 }, { T: 35, Pg: 5.628 }, { T: 40, Pg: 7.384 },
                { T: 45, Pg: 9.593 }, { T: 50, Pg: 12.35 }, { T: 60, Pg: 19.94 },
                { T: 70, Pg: 31.19 }, { T: 80, Pg: 47.39 }, { T: 100, Pg: 101.3 }
            ];
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìã Saturation Pressure of Water</h3>
                    <div className="overflow-x-auto">
                        <table className="w-full text-sm">
                            <thead className="bg-gray-100">
                                <tr>
                                    <th className="px-4 py-2 text-center">T (¬∞C)</th>
                                    {data.slice(0, 8).map(d => <th key={d.T} className="px-3 py-2 text-center">{d.T}</th>)}
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td className="px-4 py-2 font-medium">Pg (kPa)</td>
                                    {data.slice(0, 8).map(d => <td key={d.T} className="px-3 py-2 text-center">{d.Pg}</td>)}
                                </tr>
                            </tbody>
                        </table>
                        <table className="w-full text-sm mt-2">
                            <thead className="bg-gray-100">
                                <tr>
                                    <th className="px-4 py-2 text-center">T (¬∞C)</th>
                                    {data.slice(8).map(d => <th key={d.T} className="px-3 py-2 text-center">{d.T}</th>)}
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td className="px-4 py-2 font-medium">Pg (kPa)</td>
                                    {data.slice(8).map(d => <td key={d.T} className="px-3 py-2 text-center">{d.Pg}</td>)}
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div className="mt-3 text-xs text-gray-500">Use for determining Pg at dry-bulb temperature</div>
                </div>
            );
        };

        // ==================== CHAPTER 15: COMBUSTION ====================

        // Air-Fuel Ratio
        const AirFuelRatio = () => {
            const [mode, setMode] = useState('mass');
            const [inputs, setInputs] = useState({ m_air: '', m_fuel: '', n_air: '', n_fuel: '', AF: '', M_fuel: '16.04' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const m_air = parseFloat(inputs.m_air), m_fuel = parseFloat(inputs.m_fuel);
                const n_air = parseFloat(inputs.n_air), n_fuel = parseFloat(inputs.n_fuel);
                const AF = parseFloat(inputs.AF), M_fuel = parseFloat(inputs.M_fuel);
                let calc = {};
                
                if (mode === 'mass') {
                    if (!isNaN(m_air) && !isNaN(m_fuel) && m_fuel > 0 && inputs.m_air && inputs.m_fuel) {
                        calc.AF = m_air / m_fuel;
                    }
                    if (!isNaN(AF) && !isNaN(m_fuel) && inputs.AF && inputs.m_fuel) {
                        calc.m_air = AF * m_fuel;
                    }
                    if (!isNaN(AF) && !isNaN(m_air) && AF > 0 && inputs.AF && inputs.m_air) {
                        calc.m_fuel = m_air / AF;
                    }
                } else {
                    if (!isNaN(n_air) && !isNaN(n_fuel) && n_fuel > 0 && inputs.n_air && inputs.n_fuel) {
                        calc.AF_molar = n_air / n_fuel;
                        if (!isNaN(M_fuel)) {
                            calc.AF_mass = calc.AF_molar * 28.97 / M_fuel;
                        }
                    }
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs, mode]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚öñÔ∏è Air-Fuel Ratio</h3>
                    <div className="flex gap-2 mb-4">
                        <button onClick={() => setMode('mass')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${mode === 'mass' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Mass Basis
                        </button>
                        <button onClick={() => setMode('molar')}
                            className={`px-4 py-2 rounded-lg text-sm font-medium ${mode === 'molar' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                            Molar Basis
                        </button>
                    </div>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        {mode === 'mass' ? 'AF = m_air / m_fuel' : 'AF = n_air / n_fuel'}
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        {mode === 'mass' ? <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">m_air (kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.m_air}
                                    onChange={(e) => setInputs({...inputs, m_air: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mass of air" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">m_fuel (kg)</label>
                                <input type="text" inputMode="decimal" value={inputs.m_fuel}
                                    onChange={(e) => setInputs({...inputs, m_fuel: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Mass of fuel" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">AF ratio</label>
                                <input type="text" inputMode="decimal" value={inputs.AF}
                                    onChange={(e) => setInputs({...inputs, AF: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Air-fuel ratio" />
                            </div>
                        </> : <>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">n_air (kmol)</label>
                                <input type="text" inputMode="decimal" value={inputs.n_air}
                                    onChange={(e) => setInputs({...inputs, n_air: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Moles of air" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">n_fuel (kmol)</label>
                                <input type="text" inputMode="decimal" value={inputs.n_fuel}
                                    onChange={(e) => setInputs({...inputs, n_fuel: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Moles of fuel" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-600 mb-1">M_fuel (kg/kmol)</label>
                                <input type="text" inputMode="decimal" value={inputs.M_fuel}
                                    onChange={(e) => setInputs({...inputs, M_fuel: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="16.04 for CH‚ÇÑ" />
                            </div>
                        </>}
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.AF !== undefined && <div>AF = <strong>{result.AF.toPrecision(5)}</strong> kg_air/kg_fuel</div>}
                            {result.m_air !== undefined && <div>m_air = <strong>{result.m_air.toPrecision(5)}</strong> kg</div>}
                            {result.m_fuel !== undefined && <div>m_fuel = <strong>{result.m_fuel.toPrecision(5)}</strong> kg</div>}
                            {result.AF_molar !== undefined && <div>AF_molar = <strong>{result.AF_molar.toPrecision(5)}</strong> kmol_air/kmol_fuel</div>}
                            {result.AF_mass !== undefined && <div>AF_mass = <strong>{result.AF_mass.toPrecision(5)}</strong> kg_air/kg_fuel</div>}
                        </div>
                    )}
                </div>
            );
        };

        // Theoretical Air for Hydrocarbon
        const TheoreticalAir = () => {
            const [inputs, setInputs] = useState({ C: '', H: '', O: '', S: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                // C‚ÇìH·µßO·µ§S·µ• + a_th(O‚ÇÇ + 3.76N‚ÇÇ) ‚Üí xCO‚ÇÇ + (y/2)H‚ÇÇO + vSO‚ÇÇ + 3.76a_th N‚ÇÇ
                // a_th = x + y/4 + v - z/2
                const x = parseFloat(inputs.C) || 0;
                const y = parseFloat(inputs.H) || 0;
                const z = parseFloat(inputs.O) || 0;
                const v = parseFloat(inputs.S) || 0;
                
                if (x > 0 || y > 0) {
                    const a_th = x + y/4 + v - z/2; // moles O‚ÇÇ per mole fuel
                    const n_air_th = a_th * 4.76; // moles air (O‚ÇÇ + 3.76N‚ÇÇ)
                    const M_fuel = 12*x + 1*y + 16*z + 32*v;
                    const AF_th = (n_air_th * 28.97) / M_fuel;
                    
                    setResult({ a_th, n_air_th, M_fuel, AF_th, 
                        n_CO2: x, n_H2O: y/2, n_SO2: v, n_N2: 3.76 * a_th });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üß™ Theoretical Air (Stoichiometric)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        C‚ÇìH·µßO·µ§S·µ• + a_th(O‚ÇÇ + 3.76N‚ÇÇ) ‚Üí Products
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° Enter atoms per molecule: CH‚ÇÑ ‚Üí C=1, H=4 | C‚ÇàH‚ÇÅ‚Çà ‚Üí C=8, H=18
                    </div>
                    <div className="grid grid-cols-4 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">C atoms</label>
                            <input type="text" inputMode="decimal" value={inputs.C}
                                onChange={(e) => setInputs({...inputs, C: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="x" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">H atoms</label>
                            <input type="text" inputMode="decimal" value={inputs.H}
                                onChange={(e) => setInputs({...inputs, H: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="y" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">O atoms</label>
                            <input type="text" inputMode="decimal" value={inputs.O}
                                onChange={(e) => setInputs({...inputs, O: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="z (optional)" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">S atoms</label>
                            <input type="text" inputMode="decimal" value={inputs.S}
                                onChange={(e) => setInputs({...inputs, S: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="v (optional)" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Stoichiometric Combustion:</div>
                            <div className="grid grid-cols-2 gap-2 text-sm">
                                <div>M_fuel = <strong>{result.M_fuel.toPrecision(5)}</strong> kg/kmol</div>
                                <div>a_th (O‚ÇÇ) = <strong>{result.a_th.toPrecision(4)}</strong> kmol/kmol_fuel</div>
                                <div>n_air,th = <strong>{result.n_air_th.toPrecision(4)}</strong> kmol/kmol_fuel</div>
                                <div>AF_th = <strong>{result.AF_th.toPrecision(4)}</strong> kg_air/kg_fuel</div>
                            </div>
                            <div className="mt-3 pt-3 border-t border-green-200 text-sm">
                                <div className="font-medium mb-1">Products per kmol fuel:</div>
                                <div>CO‚ÇÇ: {result.n_CO2} | H‚ÇÇO: {result.n_H2O} | N‚ÇÇ: {result.n_N2.toPrecision(4)} {result.n_SO2 > 0 ? `| SO‚ÇÇ: ${result.n_SO2}` : ''}</div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Excess Air Calculator
        const ExcessAir = () => {
            const [inputs, setInputs] = useState({ AF_actual: '', AF_th: '', percent_th: '', percent_excess: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const AF_actual = parseFloat(inputs.AF_actual), AF_th = parseFloat(inputs.AF_th);
                const percent_th = parseFloat(inputs.percent_th), percent_excess = parseFloat(inputs.percent_excess);
                let calc = {};
                
                // % theoretical = (AF_actual / AF_th) √ó 100
                // % excess = ((AF_actual - AF_th) / AF_th) √ó 100 = % theoretical - 100
                
                if (!isNaN(AF_actual) && !isNaN(AF_th) && AF_th > 0 && inputs.AF_actual && inputs.AF_th) {
                    calc.percent_th = (AF_actual / AF_th) * 100;
                    calc.percent_excess = calc.percent_th - 100;
                }
                
                if (!isNaN(percent_excess) && !isNaN(AF_th) && inputs.percent_excess && inputs.AF_th) {
                    calc.AF_actual = AF_th * (1 + percent_excess / 100);
                    calc.percent_th = 100 + percent_excess;
                }
                
                if (!isNaN(percent_th) && !isNaN(AF_th) && inputs.percent_th && inputs.AF_th) {
                    calc.AF_actual = AF_th * percent_th / 100;
                    calc.percent_excess = percent_th - 100;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìä Excess Air</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        % excess = [(AF_actual - AF_th) / AF_th] √ó 100
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">AF_actual</label>
                            <input type="text" inputMode="decimal" value={inputs.AF_actual}
                                onChange={(e) => setInputs({...inputs, AF_actual: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Actual AF ratio" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">AF_theoretical</label>
                            <input type="text" inputMode="decimal" value={inputs.AF_th}
                                onChange={(e) => setInputs({...inputs, AF_th: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Stoichiometric AF" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">% theoretical air</label>
                            <input type="text" inputMode="decimal" value={inputs.percent_th}
                                onChange={(e) => setInputs({...inputs, percent_th: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="e.g., 150" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">% excess air</label>
                            <input type="text" inputMode="decimal" value={inputs.percent_excess}
                                onChange={(e) => setInputs({...inputs, percent_excess: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="e.g., 50" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.AF_actual !== undefined && <div>AF_actual = <strong>{result.AF_actual.toPrecision(5)}</strong></div>}
                            {result.percent_th !== undefined && <div>Theoretical air = <strong>{result.percent_th.toPrecision(4)}%</strong></div>}
                            {result.percent_excess !== undefined && <div>Excess air = <strong>{result.percent_excess.toPrecision(4)}%</strong></div>}
                        </div>
                    )}
                </div>
            );
        };

        // Enthalpy of Combustion
        const EnthalpyOfCombustion = () => {
            const [inputs, setInputs] = useState({ hf_fuel: '', hf_products: '', n_fuel: '1' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const hf_fuel = parseFloat(inputs.hf_fuel), hf_products = parseFloat(inputs.hf_products);
                const n_fuel = parseFloat(inputs.n_fuel);
                
                // ŒîHc = Œ£(n√óhf)products - Œ£(n√óhf)reactants
                if (!isNaN(hf_fuel) && !isNaN(hf_products) && inputs.hf_fuel && inputs.hf_products) {
                    const dH = hf_products - hf_fuel;
                    setResult({ dH, dH_per_mol: dH / (n_fuel || 1) });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üî• Enthalpy of Combustion</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        ŒîH_c = Œ£(n¬∑hÃÑf)_products - Œ£(n¬∑hÃÑf)_reactants
                    </div>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Œ£(n¬∑hÃÑf)_reactants (kJ)</label>
                            <input type="text" inputMode="decimal" value={inputs.hf_fuel}
                                onChange={(e) => setInputs({...inputs, hf_fuel: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Fuel + O‚ÇÇ (if any)" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Œ£(n¬∑hÃÑf)_products (kJ)</label>
                            <input type="text" inputMode="decimal" value={inputs.hf_products}
                                onChange={(e) => setInputs({...inputs, hf_products: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="CO‚ÇÇ + H‚ÇÇO + ..." />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">n_fuel (kmol)</label>
                            <input type="text" inputMode="decimal" value={inputs.n_fuel}
                                onChange={(e) => setInputs({...inputs, n_fuel: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="1" />
                        </div>
                    </div>
                    {result && (
                        <div className={`p-4 rounded-lg border ${result.dH < 0 ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'}`}>
                            <div className="text-sm font-medium mb-2">Enthalpy of Combustion:</div>
                            <div>ŒîH_c = <strong>{result.dH.toPrecision(6)}</strong> kJ</div>
                            <div>ŒîH_c = <strong>{result.dH_per_mol.toPrecision(6)}</strong> kJ/kmol_fuel</div>
                            <div className="text-sm mt-2">{result.dH < 0 ? '‚úì Exothermic (heat released)' : '‚ö†Ô∏è Endothermic'}</div>
                        </div>
                    )}
                </div>
            );
        };

        // Common Enthalpy of Formation
        const FormationEnthalpyRef = () => {
            const data = [
                { formula: 'CO‚ÇÇ (g)', hf: -393520 },
                { formula: 'H‚ÇÇO (l)', hf: -285830 },
                { formula: 'H‚ÇÇO (g)', hf: -241820 },
                { formula: 'CO (g)', hf: -110530 },
                { formula: 'CH‚ÇÑ (g)', hf: -74850 },
                { formula: 'C‚ÇÇH‚ÇÜ (g)', hf: -84680 },
                { formula: 'C‚ÇÉH‚Çà (g)', hf: -103850 },
                { formula: 'C‚ÇàH‚ÇÅ‚Çà (l)', hf: -249950 },
                { formula: 'C‚ÇÇH‚ÇÖOH (l)', hf: -277690 },
                { formula: 'O‚ÇÇ, N‚ÇÇ, H‚ÇÇ', hf: 0 },
            ];
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìã Enthalpy of Formation (hÃÑ¬∞f at 25¬∞C)</h3>
                    <div className="overflow-x-auto">
                        <table className="w-full text-sm">
                            <thead className="bg-gray-100">
                                <tr>
                                    <th className="px-4 py-2 text-left">Substance</th>
                                    <th className="px-4 py-2 text-right">hÃÑ¬∞f (kJ/kmol)</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y">
                                {data.map((d, i) => (
                                    <tr key={i} className={i % 2 ? 'bg-gray-50' : ''}>
                                        <td className="px-4 py-2">{d.formula}</td>
                                        <td className="px-4 py-2 text-right font-mono">{d.hf.toLocaleString()}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    <div className="mt-3 text-xs text-gray-500">
                        Elements in stable form (O‚ÇÇ, N‚ÇÇ, H‚ÇÇ, C_graphite) have hÃÑ¬∞f = 0 by definition
                    </div>
                </div>
            );
        };

        // Adiabatic Flame Temperature (Simplified)
        const AdiabaticFlameTemp = () => {
            const [inputs, setInputs] = useState({ H_react: '', n_prod: '', cp_avg: '1.1' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const H_react = parseFloat(inputs.H_react); // kJ (negative for exothermic)
                const n_prod = parseFloat(inputs.n_prod); // kmol products
                const cp_avg = parseFloat(inputs.cp_avg); // kJ/kmol¬∑K average
                
                // H_react + H_products = 0 (adiabatic)
                // -H_react = n_prod √ó cp_avg √ó (T_ad - 298)
                if (!isNaN(H_react) && !isNaN(n_prod) && !isNaN(cp_avg) && n_prod > 0 && cp_avg > 0) {
                    const dT = -H_react / (n_prod * cp_avg * 1000); // divide by 1000 for kJ to match units
                    const T_ad = 298 + (-H_react) / (n_prod * cp_avg);
                    setResult({ T_ad, T_ad_C: T_ad - 273.15 });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üå°Ô∏è Adiabatic Flame Temperature</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        H_react + H_prod = 0 ‚Üí T_ad ‚âà 298 + |ŒîH_c| / (n_prod √ó cÃÑp)
                    </div>
                    <div className="mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        üí° Simplified calculation assuming constant cp. Enter |ŒîH_c| as positive.
                    </div>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">|ŒîH_c| (kJ/kmol_fuel)</label>
                            <input type="text" inputMode="decimal" value={inputs.H_react}
                                onChange={(e) => setInputs({...inputs, H_react: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Heat released" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">n_products (kmol)</label>
                            <input type="text" inputMode="decimal" value={inputs.n_prod}
                                onChange={(e) => setInputs({...inputs, n_prod: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Total moles" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">cÃÑp,avg (kJ/kmol¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.cp_avg}
                                onChange={(e) => setInputs({...inputs, cp_avg: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="~30-35 typical" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Adiabatic Flame Temperature:</div>
                            <div>T_ad ‚âà <strong>{result.T_ad.toPrecision(5)}</strong> K</div>
                            <div>T_ad ‚âà <strong>{result.T_ad_C.toPrecision(5)}</strong> ¬∞C</div>
                        </div>
                    )}
                </div>
            );
        };

        // ==================== CHAPTER 16: CHEMICAL EQUILIBRIUM ====================

        // Gibbs Free Energy
        const GibbsFreeEnergy = () => {
            const [inputs, setInputs] = useState({ dH: '', dS: '', T: '298.15', dG: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const dH = parseFloat(inputs.dH), dS = parseFloat(inputs.dS), T = parseFloat(inputs.T);
                const dG = parseFloat(inputs.dG);
                let calc = {};
                
                // ŒîG = ŒîH - TŒîS
                if (!isNaN(dH) && !isNaN(dS) && !isNaN(T) && inputs.dH && inputs.dS) {
                    calc.dG = dH - T * dS / 1000; // dS in J, dH in kJ
                    calc.spontaneous = calc.dG < 0;
                }
                
                if (!isNaN(dG) && !isNaN(T) && !isNaN(dH) && inputs.dG && inputs.dH) {
                    calc.dS = (dH - dG) * 1000 / T; // J/mol¬∑K
                }
                
                if (!isNaN(dG) && !isNaN(T) && !isNaN(dS) && inputs.dG && inputs.dS) {
                    calc.dH = dG + T * dS / 1000;
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚ö° Gibbs Free Energy</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        ŒîG = ŒîH - TŒîS
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">ŒîH (kJ/mol)</label>
                            <input type="text" inputMode="decimal" value={inputs.dH}
                                onChange={(e) => setInputs({...inputs, dH: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Enthalpy change" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">ŒîS (J/mol¬∑K)</label>
                            <input type="text" inputMode="decimal" value={inputs.dS}
                                onChange={(e) => setInputs({...inputs, dS: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Entropy change" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T}
                                onChange={(e) => setInputs({...inputs, T: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="298.15" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">ŒîG (kJ/mol)</label>
                            <input type="text" inputMode="decimal" value={inputs.dG}
                                onChange={(e) => setInputs({...inputs, dG: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="For reverse calc" />
                        </div>
                    </div>
                    {result && (
                        <div className={`p-4 rounded-lg border ${result.dG < 0 ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'}`}>
                            <div className="text-sm font-medium mb-2">Result:</div>
                            {result.dG !== undefined && <>
                                <div>ŒîG = <strong>{result.dG.toPrecision(6)}</strong> kJ/mol</div>
                                <div className="text-sm mt-2">
                                    {result.dG < 0 ? '‚úì Spontaneous (ŒîG < 0)' : result.dG > 0 ? '‚úó Non-spontaneous (ŒîG > 0)' : '‚öñÔ∏è At equilibrium (ŒîG = 0)'}
                                </div>
                            </>}
                            {result.dS !== undefined && <div>ŒîS = <strong>{result.dS.toPrecision(6)}</strong> J/mol¬∑K</div>}
                            {result.dH !== undefined && <div>ŒîH = <strong>{result.dH.toPrecision(6)}</strong> kJ/mol</div>}
                        </div>
                    )}
                </div>
            );
        };

        // Equilibrium Constant from Gibbs
        const EquilibriumConstantKp = () => {
            const [inputs, setInputs] = useState({ dG: '', T: '298.15', Kp: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const dG = parseFloat(inputs.dG) * 1000; // kJ to J
                const T = parseFloat(inputs.T);
                const Kp = parseFloat(inputs.Kp);
                const R = 8.314; // J/mol¬∑K
                let calc = {};
                
                // ŒîG¬∞ = -RT ln(Kp) ‚Üí Kp = exp(-ŒîG¬∞/RT)
                if (!isNaN(dG) && !isNaN(T) && T > 0 && inputs.dG) {
                    calc.Kp = Math.exp(-dG / (R * T));
                    calc.lnKp = -dG / (R * T);
                }
                
                if (!isNaN(Kp) && !isNaN(T) && Kp > 0 && T > 0 && inputs.Kp) {
                    calc.dG = -R * T * Math.log(Kp) / 1000; // back to kJ
                    calc.lnKp = Math.log(Kp);
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">‚öñÔ∏è Equilibrium Constant (Kp)</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono">
                        Kp = exp(-ŒîG¬∞/RÃÑT) | ŒîG¬∞ = -RÃÑT ln(Kp)
                    </div>
                    <div className="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">ŒîG¬∞ (kJ/mol)</label>
                            <input type="text" inputMode="decimal" value={inputs.dG}
                                onChange={(e) => setInputs({...inputs, dG: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Standard Gibbs" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T}
                                onChange={(e) => setInputs({...inputs, T: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="298.15" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Kp</label>
                            <input type="text" inputMode="decimal" value={inputs.Kp}
                                onChange={(e) => setInputs({...inputs, Kp: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Equilibrium constant" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.Kp !== undefined && <div>Kp = <strong>{result.Kp.toPrecision(6)}</strong></div>}
                            {result.dG !== undefined && <div>ŒîG¬∞ = <strong>{result.dG.toPrecision(6)}</strong> kJ/mol</div>}
                            {result.lnKp !== undefined && <div>ln(Kp) = <strong>{result.lnKp.toPrecision(5)}</strong></div>}
                            <div className="text-sm text-gray-500 mt-2">
                                {result.Kp > 1 ? 'Products favored at equilibrium' : 'Reactants favored at equilibrium'}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Van't Hoff Equation
        const VantHoffEquation = () => {
            const [inputs, setInputs] = useState({ Kp1: '', T1: '', Kp2: '', T2: '', dH: '' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                const Kp1 = parseFloat(inputs.Kp1), T1 = parseFloat(inputs.T1);
                const Kp2 = parseFloat(inputs.Kp2), T2 = parseFloat(inputs.T2);
                const dH = parseFloat(inputs.dH) * 1000; // kJ to J
                const R = 8.314;
                let calc = {};
                
                // ln(Kp2/Kp1) = (ŒîH¬∞/R)(1/T1 - 1/T2)
                if (!isNaN(Kp1) && !isNaN(Kp2) && !isNaN(T1) && !isNaN(T2) && Kp1 > 0 && Kp2 > 0 && T1 > 0 && T2 > 0 && inputs.Kp1 && inputs.Kp2 && inputs.T1 && inputs.T2) {
                    calc.dH = R * Math.log(Kp2/Kp1) / (1/T1 - 1/T2) / 1000; // kJ
                }
                
                if (!isNaN(Kp1) && !isNaN(T1) && !isNaN(T2) && !isNaN(dH) && Kp1 > 0 && T1 > 0 && T2 > 0 && inputs.Kp1 && inputs.T1 && inputs.T2 && inputs.dH) {
                    const lnRatio = (dH / R) * (1/T1 - 1/T2);
                    calc.Kp2 = Kp1 * Math.exp(lnRatio);
                }
                
                setResult(Object.keys(calc).length > 0 ? calc : null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìà Van't Hoff Equation</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        ln(Kp‚ÇÇ/Kp‚ÇÅ) = (ŒîH¬∞/RÃÑ)(1/T‚ÇÅ - 1/T‚ÇÇ)
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Kp‚ÇÅ</label>
                            <input type="text" inputMode="decimal" value={inputs.Kp1}
                                onChange={(e) => setInputs({...inputs, Kp1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="At T‚ÇÅ" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÅ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T1}
                                onChange={(e) => setInputs({...inputs, T1: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Temperature 1" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">Kp‚ÇÇ</label>
                            <input type="text" inputMode="decimal" value={inputs.Kp2}
                                onChange={(e) => setInputs({...inputs, Kp2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="At T‚ÇÇ (or find)" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">T‚ÇÇ (K)</label>
                            <input type="text" inputMode="decimal" value={inputs.T2}
                                onChange={(e) => setInputs({...inputs, T2: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Temperature 2" />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">ŒîH¬∞ (kJ/mol)</label>
                            <input type="text" inputMode="decimal" value={inputs.dH}
                                onChange={(e) => setInputs({...inputs, dH: e.target.value})}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Reaction enthalpy" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            {result.dH !== undefined && <div>ŒîH¬∞ = <strong>{result.dH.toPrecision(5)}</strong> kJ/mol</div>}
                            {result.Kp2 !== undefined && <div>Kp‚ÇÇ = <strong>{result.Kp2.toPrecision(6)}</strong></div>}
                        </div>
                    )}
                    <div className="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        <strong>Note:</strong> Exothermic (ŒîH¬∞ &lt; 0): Kp decreases with T | Endothermic (ŒîH¬∞ &gt; 0): Kp increases with T
                    </div>
                </div>
            );
        };

        // Kp from Partial Pressures
        const KpFromPressures = () => {
            const [inputs, setInputs] = useState({ P_A: '', P_B: '', P_C: '', P_D: '', a: '1', b: '1', c: '1', d: '1' });
            const [result, setResult] = useState(null);
            
            useEffect(() => {
                // aA + bB ‚áå cC + dD
                // Kp = (P_C^c √ó P_D^d) / (P_A^a √ó P_B^b)
                const P_A = parseFloat(inputs.P_A) || 1, P_B = parseFloat(inputs.P_B) || 1;
                const P_C = parseFloat(inputs.P_C), P_D = parseFloat(inputs.P_D) || 1;
                const a = parseFloat(inputs.a) || 1, b = parseFloat(inputs.b) || 0;
                const c = parseFloat(inputs.c) || 1, d = parseFloat(inputs.d) || 0;
                
                if (!isNaN(P_C) && inputs.P_C) {
                    const numerator = Math.pow(P_C, c) * (d > 0 ? Math.pow(P_D, d) : 1);
                    const denominator = Math.pow(P_A, a) * (b > 0 ? Math.pow(P_B, b) : 1);
                    const Kp = numerator / denominator;
                    const dn = (c + d) - (a + b);
                    
                    setResult({ Kp, dn });
                } else setResult(null);
            }, [inputs]);
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üßÆ Kp from Partial Pressures</h3>
                    <div className="p-3 bg-gray-100 rounded-lg mb-4 text-center font-mono text-sm">
                        aA + bB ‚áå cC + dD ‚Üí Kp = (P_C^c ¬∑ P_D^d) / (P_A^a ¬∑ P_B^b)
                    </div>
                    <div className="grid grid-cols-4 gap-3 mb-2">
                        <div className="text-center text-sm font-medium text-gray-500">Reactants</div>
                        <div></div>
                        <div className="text-center text-sm font-medium text-gray-500">Products</div>
                        <div></div>
                    </div>
                    <div className="grid grid-cols-4 gap-3 mb-4">
                        <div>
                            <label className="block text-xs text-gray-600 mb-1">P_A (atm)</label>
                            <input type="text" inputMode="decimal" value={inputs.P_A}
                                onChange={(e) => setInputs({...inputs, P_A: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="1" />
                        </div>
                        <div>
                            <label className="block text-xs text-gray-600 mb-1">coef a</label>
                            <input type="text" inputMode="decimal" value={inputs.a}
                                onChange={(e) => setInputs({...inputs, a: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="1" />
                        </div>
                        <div>
                            <label className="block text-xs text-gray-600 mb-1">P_C (atm)</label>
                            <input type="text" inputMode="decimal" value={inputs.P_C}
                                onChange={(e) => setInputs({...inputs, P_C: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="Product" />
                        </div>
                        <div>
                            <label className="block text-xs text-gray-600 mb-1">coef c</label>
                            <input type="text" inputMode="decimal" value={inputs.c}
                                onChange={(e) => setInputs({...inputs, c: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="1" />
                        </div>
                        <div>
                            <label className="block text-xs text-gray-600 mb-1">P_B (atm)</label>
                            <input type="text" inputMode="decimal" value={inputs.P_B}
                                onChange={(e) => setInputs({...inputs, P_B: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="1" />
                        </div>
                        <div>
                            <label className="block text-xs text-gray-600 mb-1">coef b</label>
                            <input type="text" inputMode="decimal" value={inputs.b}
                                onChange={(e) => setInputs({...inputs, b: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="0" />
                        </div>
                        <div>
                            <label className="block text-xs text-gray-600 mb-1">P_D (atm)</label>
                            <input type="text" inputMode="decimal" value={inputs.P_D}
                                onChange={(e) => setInputs({...inputs, P_D: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="1" />
                        </div>
                        <div>
                            <label className="block text-xs text-gray-600 mb-1">coef d</label>
                            <input type="text" inputMode="decimal" value={inputs.d}
                                onChange={(e) => setInputs({...inputs, d: e.target.value})}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="0" />
                        </div>
                    </div>
                    {result && (
                        <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div className="text-sm font-medium text-green-800 mb-2">Result:</div>
                            <div>Kp = <strong>{result.Kp.toPrecision(6)}</strong></div>
                            <div className="text-sm text-gray-500 mt-1">Œîn = {result.dn} (moles products - moles reactants)</div>
                        </div>
                    )}
                </div>
            );
        };

        // Standard Gibbs of Formation Reference
        const GibbsFormationRef = () => {
            const data = [
                { formula: 'CO‚ÇÇ (g)', gf: -394.4 },
                { formula: 'H‚ÇÇO (l)', gf: -237.1 },
                { formula: 'H‚ÇÇO (g)', gf: -228.6 },
                { formula: 'CO (g)', gf: -137.2 },
                { formula: 'CH‚ÇÑ (g)', gf: -50.5 },
                { formula: 'C‚ÇÇH‚ÇÜ (g)', gf: -32.0 },
                { formula: 'C‚ÇÉH‚Çà (g)', gf: -23.4 },
                { formula: 'NO (g)', gf: 87.6 },
                { formula: 'NO‚ÇÇ (g)', gf: 51.3 },
                { formula: 'NH‚ÇÉ (g)', gf: -16.4 },
                { formula: 'O‚ÇÇ, N‚ÇÇ, H‚ÇÇ', gf: 0 },
            ];
            
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìã Standard Gibbs of Formation (·∏°¬∞f at 25¬∞C)</h3>
                    <div className="overflow-x-auto">
                        <table className="w-full text-sm">
                            <thead className="bg-gray-100">
                                <tr>
                                    <th className="px-4 py-2 text-left">Substance</th>
                                    <th className="px-4 py-2 text-right">·∏°¬∞f (kJ/mol)</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y">
                                {data.map((d, i) => (
                                    <tr key={i} className={i % 2 ? 'bg-gray-50' : ''}>
                                        <td className="px-4 py-2">{d.formula}</td>
                                        <td className="px-4 py-2 text-right font-mono">{d.gf}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    <div className="mt-3 text-xs text-gray-500">
                        ŒîG¬∞_rxn = Œ£(n¬∑·∏°¬∞f)_products - Œ£(n¬∑·∏°¬∞f)_reactants
                    </div>
                </div>
            );
        };

        // Equilibrium Summary / Le Chatelier
        const EquilibriumPrinciples = () => {
            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">üìö Le Chatelier's Principle</h3>
                    <div className="space-y-4">
                        <div className="p-4 bg-blue-50 rounded-lg">
                            <div className="font-medium text-blue-800 mb-2">üå°Ô∏è Temperature Change</div>
                            <div className="text-sm text-blue-700">
                                <div>‚Ä¢ Exothermic (ŒîH &lt; 0): ‚ÜëT shifts left, ‚ÜìT shifts right</div>
                                <div>‚Ä¢ Endothermic (ŒîH &gt; 0): ‚ÜëT shifts right, ‚ÜìT shifts left</div>
                            </div>
                        </div>
                        <div className="p-4 bg-green-50 rounded-lg">
                            <div className="font-medium text-green-800 mb-2">üìä Pressure Change</div>
                            <div className="text-sm text-green-700">
                                <div>‚Ä¢ ‚ÜëP shifts toward fewer moles of gas</div>
                                <div>‚Ä¢ ‚ÜìP shifts toward more moles of gas</div>
                                <div>‚Ä¢ No effect if Œîn_gas = 0</div>
                            </div>
                        </div>
                        <div className="p-4 bg-amber-50 rounded-lg">
                            <div className="font-medium text-amber-800 mb-2">‚öóÔ∏è Concentration Change</div>
                            <div className="text-sm text-amber-700">
                                <div>‚Ä¢ Adding reactant shifts right (more products)</div>
                                <div>‚Ä¢ Adding product shifts left (more reactants)</div>
                                <div>‚Ä¢ Removing species shifts toward that side</div>
                            </div>
                        </div>
                        <div className="p-4 bg-purple-50 rounded-lg">
                            <div className="font-medium text-purple-800 mb-2">üîÑ Catalyst</div>
                            <div className="text-sm text-purple-700">
                                <div>‚Ä¢ Does NOT change equilibrium position</div>
                                <div>‚Ä¢ Only speeds up reaching equilibrium</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App
        const chapters = [
            { id: 1, title: 'Basic Concepts', icon: 'üìê', sub: 'Units, pressure, temperature' },
            { id: 2, title: 'Energy Analysis', icon: '‚ö°', sub: 'Work, heat, energy' },
            { id: 3, title: 'Pure Substances', icon: 'üíß', sub: 'Phase, quality, tables' },
            { id: 4, title: 'Closed Systems', icon: 'üì¶', sub: 'First law, processes' },
            { id: 5, title: 'Open Systems', icon: 'üîÑ', sub: 'Steady flow devices' },
            { id: 6, title: 'Second Law', icon: 'üîí', sub: 'Carnot, COP, efficiency' },
            { id: 7, title: 'Entropy', icon: 'üìä', sub: 'Entropy change, generation' },
            { id: 8, title: 'Exergy', icon: 'üéØ', sub: 'Available energy, destruction' },
            { id: 9, title: 'Gas Power Cycles', icon: 'üî•', sub: 'Otto, Diesel, Brayton' },
            { id: 10, title: 'Vapor Cycles', icon: '‚ô®Ô∏è', sub: 'Rankine, reheat, regen' },
            { id: 11, title: 'Refrigeration', icon: '‚ùÑÔ∏è', sub: 'Vapor compression, absorption' },
            { id: 12, title: 'Thermo Relations', icon: 'üîó', sub: 'Maxwell, Clapeyron, Z' },
            { id: 13, title: 'Gas Mixtures', icon: 'üå´Ô∏è', sub: 'Dalton, Amagat, fractions' },
            { id: 14, title: 'Psychrometrics', icon: 'üí®', sub: 'Humidity, dew point, AC' },
            { id: 15, title: 'Combustion', icon: 'üî•', sub: 'AF ratio, flame temp' },
            { id: 16, title: 'Equilibrium', icon: '‚öñÔ∏è', sub: 'Gibbs, Kp, Le Chatelier' },
        ];

        const App = () => {
            const [ch, setCh] = useState(1);
            const [sidebar, setSidebar] = useState(false);
            
            return (
                <div className="min-h-screen bg-gray-50">
                    <header className="gradient-bg text-white shadow-lg sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <button onClick={() => setSidebar(!sidebar)} className="p-2 hover:bg-white/10 rounded-lg lg:hidden">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                                    </svg>
                                </button>
                                <div>
                                    <h1 className="text-2xl font-bold">ThermoCalculator</h1>
                                    <p className="text-blue-100 text-sm">Thermodynamics Calculator</p>
                                </div>
                            </div>
                            <div className="text-right text-sm hidden sm:block">
                                <div className="text-blue-200">Based on √áengel & Boles</div>
                            </div>
                        </div>
                    </header>
                    
                    <div className="flex">
                        {sidebar && <div className="fixed inset-0 bg-black/50 z-40 lg:hidden" onClick={() => setSidebar(false)} />}
                        
                        <aside className={`${sidebar ? 'translate-x-0' : '-translate-x-full'} lg:translate-x-0 fixed lg:sticky top-[68px] z-40 w-64 bg-white shadow-lg h-[calc(100vh-68px)] overflow-y-auto transition-transform`}>
                            <nav className="p-4">
                                <div className="text-xs font-semibold text-gray-400 uppercase mb-3">Chapters</div>
                                {chapters.map((c) => (
                                    <button key={c.id}
                                        onClick={() => { if (!c.locked) { setCh(c.id); setSidebar(false); } }}
                                        disabled={c.locked}
                                        className={`w-full text-left px-3 py-2 rounded-lg mb-1 flex items-center gap-2 ${
                                            ch === c.id ? 'bg-blue-50 text-blue-700 border-l-4 border-blue-600' :
                                            c.locked ? 'text-gray-400 cursor-not-allowed' : 'hover:bg-gray-50'}`}>
                                        <span>{c.icon}</span>
                                        <div>
                                            <div className="text-sm font-medium">{c.id}. {c.title}</div>
                                            <div className="text-xs text-gray-500">{c.sub}</div>
                                        </div>
                                        {c.locked && <span className="text-xs bg-gray-200 px-1 rounded ml-auto">Soon</span>}
                                    </button>
                                ))}
                            </nav>
                        </aside>
                        
                        <main className="flex-1 p-4 md:p-6 lg:p-8">
                            <div className="max-w-4xl mx-auto space-y-6">
                                {ch === 1 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">üìê Chapter 1: Basic Concepts</h2>
                                    <TemperatureConverter />
                                    <PressureConverter />
                                    <EnergyConverter />
                                    <HydrostaticPressure />
                                </>}
                                {ch === 2 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">‚ö° Chapter 2: Energy Analysis</h2>
                                    <BoundaryWork />
                                    <IdealGas />
                                    <HeatTransfer />
                                </>}
                                {ch === 3 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">üíß Chapter 3: Pure Substances</h2>
                                    <PhaseDetermination />
                                    <QualityCalculator />
                                    <MixtureProperty />
                                    <InternalEnergy />
                                    <Interpolation />
                                </>}
                                {ch === 4 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">üì¶ Chapter 4: Closed Systems</h2>
                                    <FirstLawClosed />
                                    <SpecificHeatEnergy />
                                    <PolytropicWorkClosed />
                                    <IsentropicProcess />
                                </>}
                                {ch === 5 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">üîÑ Chapter 5: Open Systems</h2>
                                    <SteadyFlowEnergy />
                                    <TurbineCalc />
                                    <CompressorCalc />
                                    <NozzleDiffuser />
                                    <HeatExchanger />
                                    <ThrottlingValve />
                                </>}
                                {ch === 6 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">üîí Chapter 6: Second Law</h2>
                                    <HeatEngine />
                                    <CarnotEfficiency />
                                    <Refrigerator />
                                    <HeatPump />
                                    <SecondLawEfficiency />
                                </>}
                                {ch === 7 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">üìä Chapter 7: Entropy</h2>
                                    <EntropyIdealGas />
                                    <EntropyIncompressible />
                                    <IsentropicEfficiencyTurbine />
                                    <IsentropicEfficiencyCompressor />
                                    <EntropyGeneration />
                                </>}
                                {ch === 8 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">üéØ Chapter 8: Exergy</h2>
                                    <DeadState />
                                    <FlowExergy />
                                    <ClosedSystemExergy />
                                    <HeatTransferExergy />
                                    <ExergyDestruction />
                                    <ExergyEfficiency />
                                </>}
                                {ch === 9 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">üî• Chapter 9: Gas Power Cycles</h2>
                                    <OttoCycle />
                                    <DieselCycle />
                                    <BraytonCycle />
                                    <MeanEffectivePressure />
                                </>}
                                {ch === 10 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">‚ô®Ô∏è Chapter 10: Vapor Power Cycles</h2>
                                    <RankineCycle />
                                    <PumpWork />
                                    <RankineReheat />
                                    <FeedwaterHeater />
                                    <TurbineExitQuality />
                                </>}
                                {ch === 11 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">‚ùÑÔ∏è Chapter 11: Refrigeration Cycles</h2>
                                    <VaporCompression />
                                    <RefrigerationEfficiency />
                                    <CascadeRefrigeration />
                                    <GasRefrigeration />
                                    <AbsorptionRefrigeration />
                                </>}
                                {ch === 12 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">üîó Chapter 12: Thermodynamic Relations</h2>
                                    <MaxwellRelations />
                                    <ClapeyronEquation />
                                    <ClausiusClapeyron />
                                    <JouleThomson />
                                    <CompressibilityFactor />
                                    <ReducedProperties />
                                </>}
                                {ch === 13 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">üå´Ô∏è Chapter 13: Gas Mixtures</h2>
                                    <MassMoleFractions />
                                    <DaltonLaw />
                                    <AmagatLaw />
                                    <MixtureSpecificHeats />
                                    <GasMixturePVT />
                                    <GasPropertiesRef />
                                </>}
                                {ch === 14 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">üí® Chapter 14: Psychrometrics</h2>
                                    <HumidityRatio />
                                    <RelativeHumidity />
                                    <DewPoint />
                                    <MoistAirEnthalpy />
                                    <ACProcess />
                                    <SatPressureTable />
                                </>}
                                {ch === 15 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">üî• Chapter 15: Combustion</h2>
                                    <AirFuelRatio />
                                    <TheoreticalAir />
                                    <ExcessAir />
                                    <EnthalpyOfCombustion />
                                    <AdiabaticFlameTemp />
                                    <FormationEnthalpyRef />
                                </>}
                                {ch === 16 && <>
                                    <h2 className="text-2xl font-bold text-gray-800">‚öñÔ∏è Chapter 16: Chemical Equilibrium</h2>
                                    <GibbsFreeEnergy />
                                    <EquilibriumConstantKp />
                                    <VantHoffEquation />
                                    <KpFromPressures />
                                    <GibbsFormationRef />
                                    <EquilibriumPrinciples />
                                </>}
                            </div>
                        </main>
                    </div>
                    
                    <footer className="bg-white border-t py-4 text-center text-sm text-gray-500">
                        ThermoCalculator ¬© 2025 | Free tool for engineering students
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
